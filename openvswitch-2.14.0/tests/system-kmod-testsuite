#! /bin/sh
# Generated from tests/system-kmod-testsuite.at by GNU Autoconf 2.69.
#
# Copyright (C) 2009-2012 Free Software Foundation, Inc.
#
# This test suite is free software; the Free Software Foundation gives
# unlimited permission to copy, distribute and modify it.
#
# Copyright (c) 2015 Nicira, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at:
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
## -------------------- ##
## M4sh Initialization. ##
## -------------------- ##

# Be more Bourne compatible
DUALCASE=1; export DUALCASE # for MKS sh
if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '${1+"$@"}'='"$@"'
  setopt NO_GLOB_SUBST
else
  case `(set -o) 2>/dev/null` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi


as_nl='
'
export as_nl
# Printing a long string crashes Solaris 7 /usr/bin/printf.
as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
# Prefer a ksh shell builtin over an external printf program on Solaris,
# but without wasting forks for bash or zsh.
if test -z "$BASH_VERSION$ZSH_VERSION" \
    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
  as_echo='print -r --'
  as_echo_n='print -rn --'
elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
  as_echo='printf %s\n'
  as_echo_n='printf %s'
else
  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
    as_echo_n='/usr/ucb/echo -n'
  else
    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
    as_echo_n_body='eval
      arg=$1;
      case $arg in #(
      *"$as_nl"*)
	expr "X$arg" : "X\\(.*\\)$as_nl";
	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
      esac;
      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
    '
    export as_echo_n_body
    as_echo_n='sh -c $as_echo_n_body as_echo'
  fi
  export as_echo_body
  as_echo='sh -c $as_echo_body as_echo'
fi

# The user is always right.
if test "${PATH_SEPARATOR+set}" != set; then
  PATH_SEPARATOR=:
  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
      PATH_SEPARATOR=';'
  }
fi


# IFS
# We need space, tab and new line, in precisely that order.  Quoting is
# there to prevent editors from complaining about space-tab.
# (If _AS_PATH_WALK were called with IFS unset, it would disable word
# splitting by setting IFS to empty value.)
IFS=" ""	$as_nl"

# Find who we are.  Look in the path if we contain no directory separator.
as_myself=
case $0 in #((
  *[\\/]* ) as_myself=$0 ;;
  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
  done
IFS=$as_save_IFS

     ;;
esac
# We did not find ourselves, most probably we were run as `sh COMMAND'
# in which case we are not to be found in the path.
if test "x$as_myself" = x; then
  as_myself=$0
fi
if test ! -f "$as_myself"; then
  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
  exit 1
fi

# Unset variables that we do not need and which cause bugs (e.g. in
# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
# suppresses any "Segmentation fault" message there.  '((' could
# trigger a bug in pdksh 5.2.14.
for as_var in BASH_ENV ENV MAIL MAILPATH
do eval test x\${$as_var+set} = xset \
  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
done
PS1='$ '
PS2='> '
PS4='+ '

# NLS nuisances.
LC_ALL=C
export LC_ALL
LANGUAGE=C
export LANGUAGE

# CDPATH.
(unset CDPATH) >/dev/null 2>&1 && unset CDPATH

if test "x$CONFIG_SHELL" = x; then
  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '\${1+\"\$@\"}'='\"\$@\"'
  setopt NO_GLOB_SUBST
else
  case \`(set -o) 2>/dev/null\` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi
"
  as_required="as_fn_return () { (exit \$1); }
as_fn_success () { as_fn_return 0; }
as_fn_failure () { as_fn_return 1; }
as_fn_ret_success () { return 0; }
as_fn_ret_failure () { return 1; }

exitcode=0
as_fn_success || { exitcode=1; echo as_fn_success failed.; }
as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :

else
  exitcode=1; echo positional parameters were not saved.
fi
test x\$exitcode = x0 || exit 1
test -x / || exit 1"
  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
test \$(( 1 + 1 )) = 2 || exit 1"
  if (eval "$as_required") 2>/dev/null; then :
  as_have_required=yes
else
  as_have_required=no
fi
  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :

else
  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
as_found=false
for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
  as_found=:
  case $as_dir in #(
	 /*)
	   for as_base in sh bash ksh sh5; do
	     # Try only shells that exist, to save several forks.
	     as_shell=$as_dir/$as_base
	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
  CONFIG_SHELL=$as_shell as_have_required=yes
		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
  break 2
fi
fi
	   done;;
       esac
  as_found=false
done
$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
  CONFIG_SHELL=$SHELL as_have_required=yes
fi; }
IFS=$as_save_IFS


      if test "x$CONFIG_SHELL" != x; then :
  export CONFIG_SHELL
             # We cannot yet assume a decent shell, so we have to provide a
# neutralization value for shells without unset; and this also
# works around shells that cannot unset nonexistent variables.
# Preserve -v and -x to the replacement shell.
BASH_ENV=/dev/null
ENV=/dev/null
(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
case $- in # ((((
  *v*x* | *x*v* ) as_opts=-vx ;;
  *v* ) as_opts=-v ;;
  *x* ) as_opts=-x ;;
  * ) as_opts= ;;
esac
exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
# Admittedly, this is quite paranoid, since all the known shells bail
# out after a failed `exec'.
$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
exit 255
fi

    if test x$as_have_required = xno; then :
  $as_echo "$0: This script requires a shell more modern than all"
  $as_echo "$0: the shells that I found on your system."
  if test x${ZSH_VERSION+set} = xset ; then
    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
  else
    $as_echo "$0: Please tell bug-autoconf@gnu.org about your system,
$0: including any error possibly output before this
$0: message. Then install a modern shell, or manually run
$0: the script under such a shell if you do have one."
  fi
  exit 1
fi
fi
fi
SHELL=${CONFIG_SHELL-/bin/sh}
export SHELL
# Unset more variables known to interfere with behavior of common tools.
CLICOLOR_FORCE= GREP_OPTIONS=
unset CLICOLOR_FORCE GREP_OPTIONS

## --------------------- ##
## M4sh Shell Functions. ##
## --------------------- ##
# as_fn_unset VAR
# ---------------
# Portably unset VAR.
as_fn_unset ()
{
  { eval $1=; unset $1;}
}
as_unset=as_fn_unset

# as_fn_set_status STATUS
# -----------------------
# Set $? to STATUS, without forking.
as_fn_set_status ()
{
  return $1
} # as_fn_set_status

# as_fn_exit STATUS
# -----------------
# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
as_fn_exit ()
{
  set +e
  as_fn_set_status $1
  exit $1
} # as_fn_exit

# as_fn_mkdir_p
# -------------
# Create "$as_dir" as a directory, including parents if necessary.
as_fn_mkdir_p ()
{

  case $as_dir in #(
  -*) as_dir=./$as_dir;;
  esac
  test -d "$as_dir" || eval $as_mkdir_p || {
    as_dirs=
    while :; do
      case $as_dir in #(
      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
      *) as_qdir=$as_dir;;
      esac
      as_dirs="'$as_qdir' $as_dirs"
      as_dir=`$as_dirname -- "$as_dir" ||
$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
	 X"$as_dir" : 'X\(//\)[^/]' \| \
	 X"$as_dir" : 'X\(//\)$' \| \
	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
$as_echo X"$as_dir" |
    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)[^/].*/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`
      test -d "$as_dir" && break
    done
    test -z "$as_dirs" || eval "mkdir $as_dirs"
  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"


} # as_fn_mkdir_p

# as_fn_executable_p FILE
# -----------------------
# Test if FILE is an executable regular file.
as_fn_executable_p ()
{
  test -f "$1" && test -x "$1"
} # as_fn_executable_p
# as_fn_append VAR VALUE
# ----------------------
# Append the text in VALUE to the end of the definition contained in VAR. Take
# advantage of any shell optimizations that allow amortized linear growth over
# repeated appends, instead of the typical quadratic growth present in naive
# implementations.
if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
  eval 'as_fn_append ()
  {
    eval $1+=\$2
  }'
else
  as_fn_append ()
  {
    eval $1=\$$1\$2
  }
fi # as_fn_append

# as_fn_arith ARG...
# ------------------
# Perform arithmetic evaluation on the ARGs, and store the result in the
# global $as_val. Take advantage of shells that can avoid forks. The arguments
# must be portable across $(()) and expr.
if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
  eval 'as_fn_arith ()
  {
    as_val=$(( $* ))
  }'
else
  as_fn_arith ()
  {
    as_val=`expr "$@" || test $? -eq 1`
  }
fi # as_fn_arith


# as_fn_error STATUS ERROR [LINENO LOG_FD]
# ----------------------------------------
# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
# script with STATUS, using 1 if that was 0.
as_fn_error ()
{
  as_status=$1; test $as_status -eq 0 && as_status=1
  if test "$4"; then
    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
  fi
  $as_echo "$as_me: error: $2" >&2
  as_fn_exit $as_status
} # as_fn_error

if expr a : '\(a\)' >/dev/null 2>&1 &&
   test "X`expr 00001 : '.*\(...\)'`" = X001; then
  as_expr=expr
else
  as_expr=false
fi

if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
  as_basename=basename
else
  as_basename=false
fi

as_me=`$as_basename -- "$0" ||
$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
	 X"$0" : 'X\(//\)$' \| \
	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
$as_echo X/"$0" |
    sed '/^.*\/\([^/][^/]*\)\/*$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`

if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
  as_dirname=dirname
else
  as_dirname=false
fi

# Avoid depending upon Character Ranges.
as_cr_letters='abcdefghijklmnopqrstuvwxyz'
as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
as_cr_Letters=$as_cr_letters$as_cr_LETTERS
as_cr_digits='0123456789'
as_cr_alnum=$as_cr_Letters$as_cr_digits


  as_lineno_1=$LINENO as_lineno_1a=$LINENO
  as_lineno_2=$LINENO as_lineno_2a=$LINENO
  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
  sed -n '
    p
    /[$]LINENO/=
  ' <$as_myself |
    sed '
      s/[$]LINENO.*/&-/
      t lineno
      b
      :lineno
      N
      :loop
      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
      t loop
      s/-\n.*//
    ' >$as_me.lineno &&
  chmod +x "$as_me.lineno" ||
    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }

  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
  # already done that, so ensure we don't try to do so again and fall
  # in an infinite loop.  This has already happened in practice.
  _as_can_reexec=no; export _as_can_reexec
  # Don't try to exec as it changes $[0], causing all sort of problems
  # (the dirname of $[0] is not the place where we might find the
  # original and so on.  Autoconf is especially sensitive to this).
  . "./$as_me.lineno"
  # Exit status is that of the last command.
  exit
}

ECHO_C= ECHO_N= ECHO_T=
case `echo -n x` in #(((((
-n*)
  case `echo 'xy\c'` in
  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
  xy)  ECHO_C='\c';;
  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
       ECHO_T='	';;
  esac;;
*)
  ECHO_N='-n';;
esac

rm -f conf$$ conf$$.exe conf$$.file
if test -d conf$$.dir; then
  rm -f conf$$.dir/conf$$.file
else
  rm -f conf$$.dir
  mkdir conf$$.dir 2>/dev/null
fi
if (echo >conf$$.file) 2>/dev/null; then
  if ln -s conf$$.file conf$$ 2>/dev/null; then
    as_ln_s='ln -s'
    # ... but there are two gotchas:
    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
    # In both cases, we have to default to `cp -pR'.
    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
      as_ln_s='cp -pR'
  elif ln conf$$.file conf$$ 2>/dev/null; then
    as_ln_s=ln
  else
    as_ln_s='cp -pR'
  fi
else
  as_ln_s='cp -pR'
fi
rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
rmdir conf$$.dir 2>/dev/null

if mkdir -p . 2>/dev/null; then
  as_mkdir_p='mkdir -p "$as_dir"'
else
  test -d ./-p && rmdir ./-p
  as_mkdir_p=false
fi

as_test_x='test -x'
as_executable_p=as_fn_executable_p

# Sed expression to map a string onto a valid CPP name.
as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"

# Sed expression to map a string onto a valid variable name.
as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"





SHELL=${CONFIG_SHELL-/bin/sh}

# How were we run?
at_cli_args="$@"


# Not all shells have the 'times' builtin; the subshell is needed to make
# sure we discard the 'times: not found' message from the shell.
at_times_p=false
(times) >/dev/null 2>&1 && at_times_p=:

# CLI Arguments to pass to the debugging scripts.
at_debug_args=
# -e sets to true
at_errexit_p=false
# Shall we be verbose?  ':' means no, empty means yes.
at_verbose=:
at_quiet=
# Running several jobs in parallel, 0 means as many as test groups.
at_jobs=1
at_traceon=:
at_trace_echo=:
at_check_filter_trace=:

# Shall we keep the debug scripts?  Must be `:' when the suite is
# run by a debug script, so that the script doesn't remove itself.
at_debug_p=false
# Display help message?
at_help_p=false
# Display the version message?
at_version_p=false
# List test groups?
at_list_p=false
# --clean
at_clean=false
# Test groups to run
at_groups=
# Whether to rerun failed tests.
at_recheck=
# Whether a write failure occurred
at_write_fail=0

# The directory we run the suite in.  Default to . if no -C option.
at_dir=`pwd`
# An absolute reference to this testsuite script.
case $as_myself in
  [\\/]* | ?:[\\/]* ) at_myself=$as_myself ;;
  * ) at_myself=$at_dir/$as_myself ;;
esac
# Whether -C is in effect.
at_change_dir=false

# Whether to enable colored test results.
at_color=auto
# List of the tested programs.
at_tested='ovs-vswitchd
ovs-vsctl'
# As many question marks as there are digits in the last test group number.
# Used to normalize the test group numbers so that `ls' lists them in
# numerical order.
at_format='???'
# Description of all the test groups.
at_help_all="1;system-traffic.at:3;datapath - ping between two ports;;
2;system-traffic.at:26;datapath - http between two ports;;
3;system-traffic.at:46;datapath - ping between two ports on vlan;;
4;system-traffic.at:72;datapath - ping between two ports on cvlan;;
5;system-traffic.at:104;datapath - ping6 between two ports;;
6;system-traffic.at:132;datapath - ping6 between two ports on vlan;;
7;system-traffic.at:163;datapath - ping6 between two ports on cvlan;;
8;system-traffic.at:195;datapath - ping over bond;;
9;system-traffic.at:220;datapath - ping over vxlan tunnel;;
10;system-traffic.at:261;datapath - ping over vxlan6 tunnel;;
11;system-traffic.at:304;datapath - ping over gre tunnel;;
12;system-traffic.at:345;datapath - ping over ip6gre L2 tunnel;;
13;system-traffic.at:385;datapath - ping over erspan v1 tunnel;;
14;system-traffic.at:421;datapath - ping over erspan v2 tunnel;;
15;system-traffic.at:457;datapath - ping over ip6erspan v1 tunnel;;
16;system-traffic.at:496;datapath - ping over ip6erspan v2 tunnel;;
17;system-traffic.at:536;datapath - ping over geneve tunnel;;
18;system-traffic.at:577;datapath - flow resume with geneve tun_metadata;;
19;system-traffic.at:628;datapath - ping over geneve6 tunnel;;
20;system-traffic.at:671;datapath - ping over gre tunnel by simulated packets;;
21;system-traffic.at:721;datapath - ping over erspan v1 tunnel by simulated packets;;
22;system-traffic.at:773;datapath - ping over erspan v2 tunnel by simulated packets;;
23;system-traffic.at:826;datapath - ping over ip6erspan v1 tunnel by simulated packets;;
24;system-traffic.at:881;datapath - ping over ip6erspan v2 tunnel by simulated packets;;
25;system-traffic.at:935;datapath - clone action;;
26;system-traffic.at:969;datapath - mpls actions;;
27;system-traffic.at:1006;datapath - multiple mpls label pop;;
28;system-traffic.at:1044;datapath - basic truncate action;;
29;system-traffic.at:1159;datapath - truncate and output to gre tunnel by simulated packets;;
30;system-traffic.at:1291;datapath - truncate and output to gre tunnel;;
31;system-traffic.at:1413;conntrack - controller;;
32;system-traffic.at:1459;conntrack - force commit;;
33;system-traffic.at:1522;conntrack - ct flush by 5-tuple;;
34;system-traffic.at:1586;conntrack - IPv4 ping;;
35;system-traffic.at:1625;conntrack - get_nconns and get/set_maxconns;;
36;system-traffic.at:1710;conntrack - IPv6 ping;;
37;system-traffic.at:1759;conntrack - preserve registers;;
38;system-traffic.at:1800;conntrack - invalid;;
39;system-traffic.at:1843;conntrack - zones;;
40;system-traffic.at:1891;conntrack - zones from field;;
41;system-traffic.at:1938;conntrack - multiple bridges;;
42;system-traffic.at:1982;conntrack - multiple zones;;
43;system-traffic.at:2019;conntrack - multiple namespaces, internal ports;;
44;system-traffic.at:2061;conntrack - ct_mark;;
45;system-traffic.at:2107;conntrack - ct_mark bit-fiddling;;
46;system-traffic.at:2143;conntrack - ct_mark from register;;
47;system-traffic.at:2188;conntrack - ct_label;;
48;system-traffic.at:2228;conntrack - ct_label bit-fiddling;;
49;system-traffic.at:2264;conntrack - ct metadata, multiple zones;;
50;system-traffic.at:2303;conntrack - new connections;;
51;system-traffic.at:2344;conntrack - ICMP related;;
52;system-traffic.at:2380;conntrack - ICMP related to original direction;;
53;system-traffic.at:2438;conntrack - ICMP related 2;;
54;system-traffic.at:2489;conntrack - IPv4 fragmentation;;
55;system-traffic.at:2528;conntrack - IPv4 fragmentation expiry;;
56;system-traffic.at:2564;conntrack - IPv4 fragmentation + vlan;;
57;system-traffic.at:2605;conntrack - IPv4 fragmentation + cvlan;;
58;system-traffic.at:2657;conntrack - IPv4 fragmentation incomplete reassembled packet;;
59;system-traffic.at:2681;conntrack - IPv4 fragmentation with fragments specified;;
60;system-traffic.at:2705;conntrack - IPv4 fragmentation out of order;;
61;system-traffic.at:2729;conntrack - IPv4 fragmentation overlapping fragments by 1 octet;;
62;system-traffic.at:2753;conntrack - IPv4 fragmentation overlapping fragments by 1 octet out of order;;
63;system-traffic.at:2777;conntrack - IPv6 fragmentation;;
64;system-traffic.at:2816;conntrack - IPv6 fragmentation expiry;;
65;system-traffic.at:2856;conntrack - IPv6 fragmentation + vlan;;
66;system-traffic.at:2898;conntrack - IPv6 fragmentation + cvlan;;
67;system-traffic.at:2951;conntrack - IPv6 fragmentation incomplete reassembled packet;;
68;system-traffic.at:2973;conntrack - IPv6 fragmentation with fragments specified;;
69;system-traffic.at:2997;conntrack - IPv6 fragmentation out of order;;
70;system-traffic.at:3021;conntrack - IPv6 fragmentation, multiple extension headers;;
71;system-traffic.at:3046;conntrack - IPv6 fragmentation, multiple extension headers + out of order;;
72;system-traffic.at:3071;conntrack - IPv6 fragmentation, multiple extension headers 2;;
73;system-traffic.at:3096;conntrack - IPv6 fragmentation, multiple extension headers 2 + out of order;;
74;system-traffic.at:3121;conntrack - Fragmentation over vxlan;;
75;system-traffic.at:3173;conntrack - IPv6 Fragmentation over vxlan;;
76;system-traffic.at:3233;conntrack - resubmit to ct multiple times;;
77;system-traffic.at:3272;conntrack - zone-based timeout policy;;
78;system-traffic.at:3381;conntrack - fragment reassembly with L3 L4 protocol information;;
79;system-traffic.at:3410;conntrack - IPv4 HTTP;;
80;system-traffic.at:3447;conntrack - IPv6 HTTP;;
81;system-traffic.at:3488;conntrack - commit, recirc;;
82;system-traffic.at:3529;conntrack - multiple zones, local;;
83;system-traffic.at:3578;conntrack - multi-stage pipeline, local;;
84;system-traffic.at:3649;conntrack - limit by zone;;
85;system-traffic.at:3737;FTP - no conntrack;;
86;system-traffic.at:3766;conntrack - FTP;;
87;system-traffic.at:3872;conntrack - FTP over IPv6;;
88;system-traffic.at:3927;conntrack - IPv6 FTP Passive;;
89;system-traffic.at:3986;conntrack - FTP with multiple expectations;;
90;system-traffic.at:4052;conntrack - TFTP;;
91;system-traffic.at:4128;conntrack - simple SNAT;;
92;system-traffic.at:4174;conntrack - SNAT with ct_mark change on reply;;
93;system-traffic.at:4217;conntrack - SNAT with port range;;
94;system-traffic.at:4264;conntrack - SNAT with port range using ICMP;;
95;system-traffic.at:4312;conntrack - SNAT with port range with exhaustion;;
96;system-traffic.at:4363;conntrack - more complex SNAT;;
97;system-traffic.at:4415;conntrack - simple DNAT;;
98;system-traffic.at:4470;conntrack - more complex DNAT;;
99;system-traffic.at:4531;conntrack - ICMP related with NAT;;
100;system-traffic.at:4709;conntrack - FTP SNAT prerecirc ;;
101;system-traffic.at:4720;conntrack - FTP SNAT prerecirc seqadj;;
102;system-traffic.at:4775;conntrack - FTP SNAT postrecirc ;;
103;system-traffic.at:4786;conntrack - FTP SNAT postrecirc seqadj;;
104;system-traffic.at:4906;conntrack - FTP SNAT orig tuple ;;
105;system-traffic.at:4910;conntrack - FTP SNAT orig tuple seqadj;;
106;system-traffic.at:4912;conntrack - IPv4 FTP Passive with SNAT;;
107;system-traffic.at:4972;conntrack - IPv4 FTP Passive with DNAT;;
108;system-traffic.at:5032;conntrack - IPv4 FTP Passive with DNAT 2;;
109;system-traffic.at:5092;conntrack - IPv4 FTP Active with DNAT;;
110;system-traffic.at:5152;conntrack - IPv4 FTP Active with DNAT with reverse skew;;
111;system-traffic.at:5212;conntrack - IPv6 HTTP with SNAT;;
112;system-traffic.at:5256;conntrack - IPv6 HTTP with DNAT;;
113;system-traffic.at:5300;conntrack - IPv6 ICMP6 Related with SNAT;;
114;system-traffic.at:5353;conntrack - IPv6 FTP with SNAT;;
115;system-traffic.at:5413;conntrack - IPv6 FTP Passive with SNAT;;
116;system-traffic.at:5474;conntrack - IPv6 FTP with SNAT - orig tuple;;
117;system-traffic.at:5534;conntrack - IPv4 TFTP with SNAT;;
118;system-traffic.at:5598;conntrack - DNAT load balancing;;
119;system-traffic.at:5685;conntrack - DNAT load balancing with NC;;
120;system-traffic.at:5773;conntrack - floating IP;;
121;system-traffic.at:5846;conntrack - negative test for recirculation optimization;;
122;system-traffic.at:5911;802.1ad - vlan_limit;;
123;system-traffic.at:5940;802.1ad - push/pop outer 802.1ad;;
124;system-traffic.at:5996;802.1ad - push/pop outer 802.1q;;
125;system-traffic.at:6052;802.1ad - 802.1q tunnel;;
126;system-traffic.at:6114;802.1ad - double vlan match;;
127;system-traffic.at:6152;nsh - encap header;;
128;system-traffic.at:6184;nsh - decap header;;
129;system-traffic.at:6214;nsh - replace header;;
130;system-traffic.at:6249;nsh - forward;;
131;system-layer3-tunnels.at:3;layer3 - ping over VXLAN-GPE;;
132;system-layer3-tunnels.at:52;layer3 - ping over GRE;;
133;system-layer3-tunnels.at:101;layer3 - use non-local port as tunnel endpoint;;
134;system-interface.at:5;interface - add delete add same interface;;
135;system-interface.at:30;interface - add route to br and verify clean-up;;
"
# List of the all the test groups.
at_groups_all=`$as_echo "$at_help_all" | sed 's/;.*//'`

# at_fn_validate_ranges NAME...
# -----------------------------
# Validate and normalize the test group number contained in each variable
# NAME. Leading zeroes are treated as decimal.
at_fn_validate_ranges ()
{
  for at_grp
  do
    eval at_value=\$$at_grp
    if test $at_value -lt 1 || test $at_value -gt 135; then
      $as_echo "invalid test group: $at_value" >&2
      exit 1
    fi
    case $at_value in
      0*) # We want to treat leading 0 as decimal, like expr and test, but
	  # AS_VAR_ARITH treats it as octal if it uses $(( )).
	  # With XSI shells, ${at_value#${at_value%%[1-9]*}} avoids the
	  # expr fork, but it is not worth the effort to determine if the
	  # shell supports XSI when the user can just avoid leading 0.
	  eval $at_grp='`expr $at_value + 0`' ;;
    esac
  done
}

at_prev=
for at_option
do
  # If the previous option needs an argument, assign it.
  if test -n "$at_prev"; then
    at_option=$at_prev=$at_option
    at_prev=
  fi

  case $at_option in
  *=?*) at_optarg=`expr "X$at_option" : '[^=]*=\(.*\)'` ;;
  *)    at_optarg= ;;
  esac

  # Accept the important Cygnus configure options, so we can diagnose typos.

  case $at_option in
    --help | -h )
	at_help_p=:
	;;

    --list | -l )
	at_list_p=:
	;;

    --version | -V )
	at_version_p=:
	;;

    --clean | -c )
	at_clean=:
	;;

    --color )
	at_color=always
	;;
    --color=* )
	case $at_optarg in
	no | never | none) at_color=never ;;
	auto | tty | if-tty) at_color=auto ;;
	always | yes | force) at_color=always ;;
	*) at_optname=`echo " $at_option" | sed 's/^ //; s/=.*//'`
	   as_fn_error $? "unrecognized argument to $at_optname: $at_optarg" ;;
	esac
	;;

    --debug | -d )
	at_debug_p=:
	;;

    --errexit | -e )
	at_debug_p=:
	at_errexit_p=:
	;;

    --verbose | -v )
	at_verbose=; at_quiet=:
	;;

    --trace | -x )
	at_traceon='set -x'
	at_trace_echo=echo
	at_check_filter_trace=at_fn_filter_trace
	;;

    [0-9] | [0-9][0-9] | [0-9][0-9][0-9] | [0-9][0-9][0-9][0-9])
	at_fn_validate_ranges at_option
	as_fn_append at_groups "$at_option$as_nl"
	;;

    # Ranges
    [0-9]- | [0-9][0-9]- | [0-9][0-9][0-9]- | [0-9][0-9][0-9][0-9]-)
	at_range_start=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_start
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,$p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    -[0-9] | -[0-9][0-9] | -[0-9][0-9][0-9] | -[0-9][0-9][0-9][0-9])
	at_range_end=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_end
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '1,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    [0-9]-[0-9] | [0-9]-[0-9][0-9] | [0-9]-[0-9][0-9][0-9] | \
    [0-9]-[0-9][0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9] | \
    [0-9][0-9]-[0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] )
	at_range_start=`expr $at_option : '\(.*\)-'`
	at_range_end=`expr $at_option : '.*-\(.*\)'`
	if test $at_range_start -gt $at_range_end; then
	  at_tmp=$at_range_end
	  at_range_end=$at_range_start
	  at_range_start=$at_tmp
	fi
	at_fn_validate_ranges at_range_start at_range_end
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    # Directory selection.
    --directory | -C )
	at_prev=--directory
	;;
    --directory=* )
	at_change_dir=:
	at_dir=$at_optarg
	if test x- = "x$at_dir" ; then
	  at_dir=./-
	fi
	;;

    # Parallel execution.
    --jobs | -j )
	at_jobs=0
	;;
    --jobs=* | -j[0-9]* )
	if test -n "$at_optarg"; then
	  at_jobs=$at_optarg
	else
	  at_jobs=`expr X$at_option : 'X-j\(.*\)'`
	fi
	case $at_jobs in *[!0-9]*)
	  at_optname=`echo " $at_option" | sed 's/^ //; s/[0-9=].*//'`
	  as_fn_error $? "non-numeric argument to $at_optname: $at_jobs" ;;
	esac
	;;

    # Keywords.
    --keywords | -k )
	at_prev=--keywords
	;;
    --keywords=* )
	at_groups_selected=$at_help_all
	at_save_IFS=$IFS
	IFS=,
	set X $at_optarg
	shift
	IFS=$at_save_IFS
	for at_keyword
	do
	  at_invert=
	  case $at_keyword in
	  '!'*)
	    at_invert="-v"
	    at_keyword=`expr "X$at_keyword" : 'X!\(.*\)'`
	    ;;
	  esac
	  # It is on purpose that we match the test group titles too.
	  at_groups_selected=`$as_echo "$at_groups_selected" |
	      grep -i $at_invert "^[1-9][^;]*;.*[; ]$at_keyword[ ;]"`
	done
	# Smash the keywords.
	at_groups_selected=`$as_echo "$at_groups_selected" | sed 's/;.*//'`
	as_fn_append at_groups "$at_groups_selected$as_nl"
	;;
    --recheck)
	at_recheck=:
	;;

    *=*)
	at_envvar=`expr "x$at_option" : 'x\([^=]*\)='`
	# Reject names that are not valid shell variable names.
	case $at_envvar in
	  '' | [0-9]* | *[!_$as_cr_alnum]* )
	    as_fn_error $? "invalid variable name: \`$at_envvar'" ;;
	esac
	at_value=`$as_echo "$at_optarg" | sed "s/'/'\\\\\\\\''/g"`
	# Export now, but save eval for later and for debug scripts.
	export $at_envvar
	as_fn_append at_debug_args " $at_envvar='$at_value'"
	;;

     *) $as_echo "$as_me: invalid option: $at_option" >&2
	$as_echo "Try \`$0 --help' for more information." >&2
	exit 1
	;;
  esac
done

# Verify our last option didn't require an argument
if test -n "$at_prev"; then :
  as_fn_error $? "\`$at_prev' requires an argument"
fi

# The file containing the suite.
at_suite_log=$at_dir/$as_me.log

# Selected test groups.
if test -z "$at_groups$at_recheck"; then
  at_groups=$at_groups_all
else
  if test -n "$at_recheck" && test -r "$at_suite_log"; then
    at_oldfails=`sed -n '
      /^Failed tests:$/,/^Skipped tests:$/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^Unexpected passes:$/,/^## Detailed failed tests/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^## Detailed failed tests/q
      ' "$at_suite_log"`
    as_fn_append at_groups "$at_oldfails$as_nl"
  fi
  # Sort the tests, removing duplicates.
  at_groups=`$as_echo "$at_groups" | sort -nu | sed '/^$/d'`
fi

if test x"$at_color" = xalways \
   || { test x"$at_color" = xauto && test -t 1; }; then
  at_red=`printf '\033[0;31m'`
  at_grn=`printf '\033[0;32m'`
  at_lgn=`printf '\033[1;32m'`
  at_blu=`printf '\033[1;34m'`
  at_std=`printf '\033[m'`
else
  at_red= at_grn= at_lgn= at_blu= at_std=
fi

# Help message.
if $at_help_p; then
  cat <<_ATEOF || at_write_fail=1
Usage: $0 [OPTION]... [VARIABLE=VALUE]... [TESTS]

Run all the tests, or the selected TESTS, given by numeric ranges, and
save a detailed log file.  Upon failure, create debugging scripts.

Do not change environment variables directly.  Instead, set them via
command line arguments.  Set \`AUTOTEST_PATH' to select the executables
to exercise.  Each relative directory is expanded as build and source
directories relative to the top level of this distribution.
E.g., from within the build directory /tmp/foo-1.0, invoking this:

  $ $0 AUTOTEST_PATH=bin

is equivalent to the following, assuming the source directory is /src/foo-1.0:

  PATH=/tmp/foo-1.0/bin:/src/foo-1.0/bin:\$PATH $0
_ATEOF
cat <<_ATEOF || at_write_fail=1

Operation modes:
  -h, --help     print the help message, then exit
  -V, --version  print version number, then exit
  -c, --clean    remove all the files this test suite might create and exit
  -l, --list     describes all the tests, or the selected TESTS
_ATEOF
cat <<_ATEOF || at_write_fail=1

Execution tuning:
  -C, --directory=DIR
                 change to directory DIR before starting
      --color[=never|auto|always]
                 disable colored test results, or enable even without terminal
  -j, --jobs[=N]
                 Allow N jobs at once; infinite jobs with no arg (default 1)
  -k, --keywords=KEYWORDS
                 select the tests matching all the comma-separated KEYWORDS
                 multiple \`-k' accumulate; prefixed \`!' negates a KEYWORD
      --recheck  select all tests that failed or passed unexpectedly last time
  -e, --errexit  abort as soon as a test fails; implies --debug
  -v, --verbose  force more detailed output
                 default for debugging scripts
  -d, --debug    inhibit clean up and top-level logging
                 default for debugging scripts
  -x, --trace    enable tests shell tracing
_ATEOF
cat <<_ATEOF || at_write_fail=1

Report bugs to <bugs@openvswitch.org>.
_ATEOF
  exit $at_write_fail
fi

# List of tests.
if $at_list_p; then
  cat <<_ATEOF || at_write_fail=1
openvswitch 2.14.0 test suite test groups:

 NUM: FILE-NAME:LINE     TEST-GROUP-NAME
      KEYWORDS

_ATEOF
  # Pass an empty line as separator between selected groups and help.
  $as_echo "$at_groups$as_nl$as_nl$at_help_all" |
    awk 'NF == 1 && FS != ";" {
	   selected[$ 1] = 1
	   next
	 }
	 /^$/ { FS = ";" }
	 NF > 0 {
	   if (selected[$ 1]) {
	     printf " %3d: %-18s %s\n", $ 1, $ 2, $ 3
	     if ($ 4) {
	       lmax = 79
	       indent = "     "
	       line = indent
	       len = length (line)
	       n = split ($ 4, a, " ")
	       for (i = 1; i <= n; i++) {
		 l = length (a[i]) + 1
		 if (i > 1 && len + l > lmax) {
		   print line
		   line = indent " " a[i]
		   len = length (line)
		 } else {
		   line = line " " a[i]
		   len += l
		 }
	       }
	       if (n)
		 print line
	     }
	   }
	 }' || at_write_fail=1
  exit $at_write_fail
fi
if $at_version_p; then
  $as_echo "$as_me (openvswitch 2.14.0)" &&
  cat <<\_ATEOF || at_write_fail=1

Copyright (C) 2012 Free Software Foundation, Inc.
This test suite is free software; the Free Software Foundation gives
unlimited permission to copy, distribute and modify it.

Copyright (c) 2015 Nicira, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
_ATEOF
  exit $at_write_fail
fi

# Should we print banners?  Yes if more than one test is run.
case $at_groups in #(
  *$as_nl* )
      at_print_banners=: ;; #(
  * ) at_print_banners=false ;;
esac
# Text for banner N, set to a single space once printed.
# Banner 1. system-traffic.at:1
# Category starts at test group 1.
at_banner_text_1="datapath-sanity"
# Banner 2. system-traffic.at:1411
# Category starts at test group 31.
at_banner_text_2="conntrack"
# Banner 3. system-traffic.at:3408
# Category starts at test group 79.
at_banner_text_3="conntrack - L7"
# Banner 4. system-traffic.at:4126
# Category starts at test group 91.
at_banner_text_4="conntrack - NAT"
# Banner 5. system-traffic.at:5909
# Category starts at test group 122.
at_banner_text_5="802.1ad"
# Banner 6. system-traffic.at:6150
# Category starts at test group 127.
at_banner_text_6="nsh-datapath"
# Banner 7. system-layer3-tunnels.at:1
# Category starts at test group 131.
at_banner_text_7="layer3-tunnels"
# Banner 8. system-interface.at:1
# Category starts at test group 134.
at_banner_text_8="system-inteface"

# Take any -C into account.
if $at_change_dir ; then
  test x != "x$at_dir" && cd "$at_dir" \
    || as_fn_error $? "unable to change directory"
  at_dir=`pwd`
fi

# Load the config files for any default variable assignments.
for at_file in atconfig atlocal
do
  test -r $at_file || continue
  . ./$at_file || as_fn_error $? "invalid content: $at_file"
done

# Autoconf <=2.59b set at_top_builddir instead of at_top_build_prefix:
: "${at_top_build_prefix=$at_top_builddir}"

# Perform any assignments requested during argument parsing.
eval "$at_debug_args"

# atconfig delivers names relative to the directory the test suite is
# in, but the groups themselves are run in testsuite-dir/group-dir.
if test -n "$at_top_srcdir"; then
  builddir=../..
  for at_dir_var in srcdir top_srcdir top_build_prefix
  do
    eval at_val=\$at_$at_dir_var
    case $at_val in
      [\\/$]* | ?:[\\/]* ) at_prefix= ;;
      *) at_prefix=../../ ;;
    esac
    eval "$at_dir_var=\$at_prefix\$at_val"
  done
fi

## -------------------- ##
## Directory structure. ##
## -------------------- ##

# This is the set of directories and files used by this script
# (non-literals are capitalized):
#
# TESTSUITE         - the testsuite
# TESTSUITE.log     - summarizes the complete testsuite run
# TESTSUITE.dir/    - created during a run, remains after -d or failed test
# + at-groups/      - during a run: status of all groups in run
# | + NNN/          - during a run: meta-data about test group NNN
# | | + check-line  - location (source file and line) of current AT_CHECK
# | | + status      - exit status of current AT_CHECK
# | | + stdout      - stdout of current AT_CHECK
# | | + stder1      - stderr, including trace
# | | + stderr      - stderr, with trace filtered out
# | | + test-source - portion of testsuite that defines group
# | | + times       - timestamps for computing duration
# | | + pass        - created if group passed
# | | + xpass       - created if group xpassed
# | | + fail        - created if group failed
# | | + xfail       - created if group xfailed
# | | + skip        - created if group skipped
# + at-stop         - during a run: end the run if this file exists
# + at-source-lines - during a run: cache of TESTSUITE line numbers for extraction
# + 0..NNN/         - created for each group NNN, remains after -d or failed test
# | + TESTSUITE.log - summarizes the group results
# | + ...           - files created during the group

# The directory the whole suite works in.
# Should be absolute to let the user `cd' at will.
at_suite_dir=$at_dir/$as_me.dir
# The file containing the suite ($at_dir might have changed since earlier).
at_suite_log=$at_dir/$as_me.log
# The directory containing helper files per test group.
at_helper_dir=$at_suite_dir/at-groups
# Stop file: if it exists, do not start new jobs.
at_stop_file=$at_suite_dir/at-stop
# The fifo used for the job dispatcher.
at_job_fifo=$at_suite_dir/at-job-fifo

if $at_clean; then
  test -d "$at_suite_dir" &&
    find "$at_suite_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
  rm -f -r "$at_suite_dir" "$at_suite_log"
  exit $?
fi

# Don't take risks: use only absolute directories in PATH.
#
# For stand-alone test suites (ie. atconfig was not found),
# AUTOTEST_PATH is relative to `.'.
#
# For embedded test suites, AUTOTEST_PATH is relative to the top level
# of the package.  Then expand it into build/src parts, since users
# may create executables in both places.
AUTOTEST_PATH=`$as_echo "$AUTOTEST_PATH" | sed "s|:|$PATH_SEPARATOR|g"`
at_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $AUTOTEST_PATH $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -n "$at_path" && as_fn_append at_path $PATH_SEPARATOR
case $as_dir in
  [\\/]* | ?:[\\/]* )
    as_fn_append at_path "$as_dir"
    ;;
  * )
    if test -z "$at_top_build_prefix"; then
      # Stand-alone test suite.
      as_fn_append at_path "$as_dir"
    else
      # Embedded test suite.
      as_fn_append at_path "$at_top_build_prefix$as_dir$PATH_SEPARATOR"
      as_fn_append at_path "$at_top_srcdir/$as_dir"
    fi
    ;;
esac
  done
IFS=$as_save_IFS


# Now build and simplify PATH.
#
# There might be directories that don't exist, but don't redirect
# builtins' (eg., cd) stderr directly: Ultrix's sh hates that.
at_new_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $at_path
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -d "$as_dir" || continue
case $as_dir in
  [\\/]* | ?:[\\/]* ) ;;
  * ) as_dir=`(cd "$as_dir" && pwd) 2>/dev/null` ;;
esac
case $PATH_SEPARATOR$at_new_path$PATH_SEPARATOR in
  *$PATH_SEPARATOR$as_dir$PATH_SEPARATOR*) ;;
  $PATH_SEPARATOR$PATH_SEPARATOR) at_new_path=$as_dir ;;
  *) as_fn_append at_new_path "$PATH_SEPARATOR$as_dir" ;;
esac
  done
IFS=$as_save_IFS

PATH=$at_new_path
export PATH

# Setting up the FDs.



# 5 is the log file.  Not to be overwritten if `-d'.
if $at_debug_p; then
  at_suite_log=/dev/null
else
  : >"$at_suite_log"
fi
exec 5>>"$at_suite_log"

# Banners and logs.
$as_echo "## ------------------------------ ##
## openvswitch 2.14.0 test suite. ##
## ------------------------------ ##"
{
  $as_echo "## ------------------------------ ##
## openvswitch 2.14.0 test suite. ##
## ------------------------------ ##"
  echo

  $as_echo "$as_me: command line was:"
  $as_echo "  \$ $0 $at_cli_args"
  echo

  # If ChangeLog exists, list a few lines in case it might help determining
  # the exact version.
  if test -n "$at_top_srcdir" && test -f "$at_top_srcdir/ChangeLog"; then
    $as_echo "## ---------- ##
## ChangeLog. ##
## ---------- ##"
    echo
    sed 's/^/| /;10q' "$at_top_srcdir/ChangeLog"
    echo
  fi

  {
cat <<_ASUNAME
## --------- ##
## Platform. ##
## --------- ##

hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
uname -m = `(uname -m) 2>/dev/null || echo unknown`
uname -r = `(uname -r) 2>/dev/null || echo unknown`
uname -s = `(uname -s) 2>/dev/null || echo unknown`
uname -v = `(uname -v) 2>/dev/null || echo unknown`

/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`

/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`

_ASUNAME

as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    $as_echo "PATH: $as_dir"
  done
IFS=$as_save_IFS

}
  echo

  # Contents of the config files.
  for at_file in atconfig atlocal
  do
    test -r $at_file || continue
    $as_echo "$as_me: $at_file:"
    sed 's/^/| /' $at_file
    echo
  done
} >&5


## ------------------------- ##
## Autotest shell functions. ##
## ------------------------- ##

# at_fn_banner NUMBER
# -------------------
# Output banner NUMBER, provided the testsuite is running multiple groups and
# this particular banner has not yet been printed.
at_fn_banner ()
{
  $at_print_banners || return 0
  eval at_banner_text=\$at_banner_text_$1
  test "x$at_banner_text" = "x " && return 0
  eval "at_banner_text_$1=\" \""
  if test -z "$at_banner_text"; then
    $at_first || echo
  else
    $as_echo "$as_nl$at_banner_text$as_nl"
  fi
} # at_fn_banner

# at_fn_check_prepare_notrace REASON LINE
# ---------------------------------------
# Perform AT_CHECK preparations for the command at LINE for an untraceable
# command; REASON is the reason for disabling tracing.
at_fn_check_prepare_notrace ()
{
  $at_trace_echo "Not enabling shell tracing (command contains $1)"
  $as_echo "$2" >"$at_check_line_file"
  at_check_trace=: at_check_filter=:
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_trace LINE
# ------------------------------
# Perform AT_CHECK preparations for the command at LINE for a traceable
# command.
at_fn_check_prepare_trace ()
{
  $as_echo "$1" >"$at_check_line_file"
  at_check_trace=$at_traceon at_check_filter=$at_check_filter_trace
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_dynamic COMMAND LINE
# ----------------------------------------
# Decide if COMMAND at LINE is traceable at runtime, and call the appropriate
# preparation function.
at_fn_check_prepare_dynamic ()
{
  case $1 in
    *$as_nl*)
      at_fn_check_prepare_notrace 'an embedded newline' "$2" ;;
    *)
      at_fn_check_prepare_trace "$2" ;;
  esac
}

# at_fn_filter_trace
# ------------------
# Remove the lines in the file "$at_stderr" generated by "set -x" and print
# them to stderr.
at_fn_filter_trace ()
{
  mv "$at_stderr" "$at_stder1"
  grep '^ *+' "$at_stder1" >&2
  grep -v '^ *+' "$at_stder1" >"$at_stderr"
}

# at_fn_log_failure FILE-LIST
# ---------------------------
# Copy the files in the list on stdout with a "> " prefix, and exit the shell
# with a failure exit code.
at_fn_log_failure ()
{
  for file
    do $as_echo "$file:"; sed 's/^/> /' "$file"; done
  echo 1 > "$at_status_file"
  exit 1
}

# at_fn_check_skip EXIT-CODE LINE
# -------------------------------
# Check whether EXIT-CODE is a special exit code (77 or 99), and if so exit
# the test group subshell with that same exit code. Use LINE in any report
# about test failure.
at_fn_check_skip ()
{
  case $1 in
    99) echo 99 > "$at_status_file"; at_failed=:
	$as_echo "$2: hard failure"; exit 99;;
    77) echo 77 > "$at_status_file"; exit 77;;
  esac
}

# at_fn_check_status EXPECTED EXIT-CODE LINE
# ------------------------------------------
# Check whether EXIT-CODE is the EXPECTED exit code, and if so do nothing.
# Otherwise, if it is 77 or 99, exit the test group subshell with that same
# exit code; if it is anything else print an error message referring to LINE,
# and fail the test.
at_fn_check_status ()
{
  case $2 in
    $1 ) ;;
    77) echo 77 > "$at_status_file"; exit 77;;
    99) echo 99 > "$at_status_file"; at_failed=:
	$as_echo "$3: hard failure"; exit 99;;
    *) $as_echo "$3: exit code was $2, expected $1"
      at_failed=:;;
  esac
}

# at_fn_diff_devnull FILE
# -----------------------
# Emit a diff between /dev/null and FILE. Uses "test -s" to avoid useless diff
# invocations.
at_fn_diff_devnull ()
{
  test -s "$1" || return 0
  $at_diff "$at_devnull" "$1"
}

# at_fn_test NUMBER
# -----------------
# Parse out test NUMBER from the tail of this file.
at_fn_test ()
{
  eval at_sed=\$at_sed$1
  sed "$at_sed" "$at_myself" > "$at_test_source"
}

# at_fn_create_debugging_script
# -----------------------------
# Create the debugging script $at_group_dir/run which will reproduce the
# current test group.
at_fn_create_debugging_script ()
{
  {
    echo "#! /bin/sh" &&
    echo 'test "${ZSH_VERSION+set}" = set && alias -g '\''${1+"$@"}'\''='\''"$@"'\''' &&
    $as_echo "cd '$at_dir'" &&
    $as_echo "exec \${CONFIG_SHELL-$SHELL} \"$at_myself\" -v -d $at_debug_args $at_group \${1+\"\$@\"}" &&
    echo 'exit 1'
  } >"$at_group_dir/run" &&
  chmod +x "$at_group_dir/run"
}

## -------------------------------- ##
## End of autotest shell functions. ##
## -------------------------------- ##
{
  $as_echo "## ---------------- ##
## Tested programs. ##
## ---------------- ##"
  echo
} >&5

# Report what programs are being tested.
for at_program in : $at_tested
do
  test "$at_program" = : && continue
  case $at_program in
    [\\/]* | ?:[\\/]* ) $at_program_=$at_program ;;
    * )
    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -f "$as_dir/$at_program" && break
  done
IFS=$as_save_IFS

    at_program_=$as_dir/$at_program ;;
  esac
  if test -f "$at_program_"; then
    {
      $as_echo "$at_srcdir/system-kmod-testsuite.at:1: $at_program_ --version"
      "$at_program_" --version </dev/null
      echo
    } >&5 2>&1
  else
    as_fn_error $? "cannot find $at_program" "$LINENO" 5
  fi
done

{
  $as_echo "## ------------------ ##
## Running the tests. ##
## ------------------ ##"
} >&5

at_start_date=`date`
at_start_time=`date +%s 2>/dev/null`
$as_echo "$as_me: starting at: $at_start_date" >&5


# Set ovs_base to the base directory in which the test is running and
# initialize the OVS_*DIR environment variables to point to this
# directory.
ovs_init() {
    ovs_base=`pwd`
    trap ovs_on_exit 0
    : > cleanup
    ovs_setenv
}

# Catch testsuite error condition and cleanup test environment by tearing down
# all interfaces and processes spawned.
# User has an option to leave the test environment in error state so that system
# can be poked around to get more information. User can enable this option by setting
# environment variable OVS_PAUSE_TEST=1. User needs to press CTRL-D to resume the
# cleanup operation.
ovs_pause() {
    echo "====================================================="
    echo "Set following environment variable to use various ovs utilities"
    echo "export OVS_RUNDIR=$ovs_base"
    echo "Press ENTER to continue: "
    read
}

ovs_on_exit () {
    if [ ! -z "${OVS_PAUSE_TEST}" ] && [ -z $at_verbose ]; then
        trap '' INT
        ovs_pause
    fi
    . "$ovs_base/cleanup"
}

# With no parameter or an empty parameter, sets the OVS_*DIR
# environment variables to point to $ovs_base, the base directory in
# which the test is running.
#
# With a parameter, sets them to $ovs_base/$1.
ovs_setenv() {
    sandbox=$1
    ovs_dir=$ovs_base${1:+/$1}
    OVS_RUNDIR=$ovs_dir; export OVS_RUNDIR
    OVS_LOGDIR=$ovs_dir; export OVS_LOGDIR
    OVS_DBDIR=$ovs_dir; export OVS_DBDIR
    OVS_SYSCONFDIR=$ovs_dir; export OVS_SYSCONFDIR
    OVS_PKGDATADIR=$ovs_dir; export OVS_PKGDATADIR
}

# Prints the integers from $1 to $2, increasing by $3 (default 1) on stdout.
seq () {
    if test $# = 1; then
        set 1 $1
    fi
    while test $1 -le $2; do
        echo $1
        set `expr $1 + ${3-1}` $2 $3
    done
}

if test "$IS_WIN32" = "yes"; then
    pwd () {
        command pwd -W "$@"
    }

    diff () {
        command diff --strip-trailing-cr "$@"
    }

    # tskill is more effective than taskkill but it isn't always installed.
    if (tskill //?) >/dev/null 2>&1; then :; else
        tskill () { taskkill //F //PID $1 >/dev/null; }
    fi

    kill () {
        signal=
        retval=0
        for arg; do
            case $arg in
            -*) signal=$arg ;;
            [1-9][0-9]*)
                # tasklist always returns 0.
                # If pid does exist, there will be a line with the pid.
                if tasklist //fi "PID eq $arg" | grep $arg >/dev/null; then
                    if test "X$signal" != "X-0"; then
                        tskill $arg
                    fi
                else
                    retval=1
                fi
                ;;
            esac
        done
        return $retval
    }
fi

# parent_pid PID
#
# Prints the PID of the parent of process PID.
parent_pid () {
    # Using "ps" is portable to any POSIX system, but busybox "ps" (used in
    # e.g. Alpine Linux) is noncompliant, so we use a Linux-specific approach
    # when it's available.  We check the format of the status file to avoid
    # the NetBSD file with the same name but different contents.
    if egrep '^PPid:[[:space:]]*[0-9]*$' /proc/$1/status > /dev/null 2>&1; then
        sed -n 's/^PPid:	\([0-9]*\)/\1/p' /proc/$1/status
    else
        ps -o ppid= -p $1
    fi
}

# kill_ovs_vswitchd [PID]
#
# Signal the ovs-vswitchd daemon to exit gracefully and wait for it to
# terminate or kill it if that takes too long.
#
# It is used to cleanup all sorts of tests and results. It can't assume
# any state, including the availability of PID file which can be provided.
kill_ovs_vswitchd () {
    # Use provided PID or save the current PID if available.
    TMPPID=$1
    if test -z "$TMPPID"; then
        TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid 2>/dev/null)
    fi

    # Tell the daemon to terminate gracefully
    ovs-appctl -t ovs-vswitchd exit --cleanup 2>/dev/null

    # Nothing else to be done if there is no PID
    test -z "$TMPPID" && return

    for i in 1 2 3 4 5 6 7 8 9; do
        # Check if the daemon is alive.
        kill -0 $TMPPID 2>/dev/null || return

        # Fallback to whole number since POSIX doesn't require
        # fractional times to work.
        sleep 0.1 || sleep 1
    done

    # Make sure it is terminated.
    kill $TMPPID
}

# Normalize the output of 'wc' to match POSIX.
# POSIX says 'wc' should print "%d %d %d", but GNU prints "%7d %7d %7d".
# POSIX says 'wc -l' should print "%d %s", but BSD prints "%8d".
#
# This fixes all of those (it will screw up filenames that contain
# multiple sequential spaces, but that doesn't really matter).
wc () {
   command wc "$@" | tr -s ' ' ' ' | sed 's/^ *//'
}

uuidfilt () {
    $PYTHON3 "$top_srcdir"/tests/uuidfilt.py "$@"
}

# run_as PROGRAM_NAME COMMAND [ARG...]
#
# Runs a command with argv[0] set to PROGRAM_NAME, if possible, in a
# subshell.  Most utilities print argc[0] as part of their messages,
# so this makes it easier to figure out which particular utility
# prints a message if a bunch of identical processes are running.
#
# Not all shells support "exec -a NAME", so test for it.
if (exec -a myname true 2>/dev/null); then
    run_as () {
        (exec -a "$@")
    }
else
    run_as () {
        shift
        (exec "$@")
    }
fi


ovs_cleanup() {
    if test "$(echo asan.*)" != 'asan.*'; then
        echo "Address Sanitizer reported errors in:" asan.*
        cat asan.*
        $as_echo "ovs-macros.at:216" >"$at_check_line_file"
at_fn_check_skip 99 "$at_srcdir/ovs-macros.at:216"
    fi
}

ovs_wait () {
    echo "$1: waiting $2..." >&5

    # First try the condition without waiting.
    if ovs_wait_cond; then echo "$1: wait succeeded immediately" >&5; return 0; fi

    # Try a quick sleep, so that the test completes very quickly
    # in the normal case.  POSIX doesn't require fractional times to
    # work, so this might not work.
    sleep 0.1
    if ovs_wait_cond; then echo "$1: wait succeeded quickly" >&5; return 0; fi

    # Then wait up to OVS_CTL_TIMEOUT seconds.
    local d
    for d in `seq 1 "$OVS_CTL_TIMEOUT"`; do
        sleep 1
        if ovs_wait_cond; then echo "$1: wait succeeded after $d seconds" >&5; return 0; fi
    done

    echo "$1: wait failed after $d seconds" >&5
    ovs_wait_failed
    $as_echo "ovs-macros.at:241" >"$at_check_line_file"
at_fn_check_skip 99 "$at_srcdir/ovs-macros.at:241"
}

   on_exit () {
    (echo "$1"; cat cleanup) > cleanup.tmp
    mv cleanup.tmp cleanup
}


ovsdb_client_wait() {
    ovsdb-client -vconsole:warn -vreconnect:err -vjsonrpc:err -vtimeval:off -vfile -vsyslog:off -vvlog:off wait "$@"
}



# Strips out uninteresting parts of ovs-ofctl output, as well as parts
# that vary from one run to another.
ofctl_strip () {
    sed '
s/ (xid=0x[0-9a-fA-F]*)//
s/ duration=[0-9.]*s,//
s/ cookie=0x0,//
s/ table=0,//
s/ n_packets=0,//
s/ n_bytes=0,//
s/ idle_age=[0-9]*,//
s/ hard_age=[0-9]*,//
s/dp_hash=0x[0-9a-f]*\//dp_hash=0x0\//
s/recirc_id=0x[0-9a-f]*,/recirc_id=0x0,/
s/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]T[0-9][0-9]:[0-9][0-9]:[0-9][0-9]Z|//
s/dir\/[0-9]*\/br0.mgmt/dir\/XXXX\/br0.mgmt/
'
}

# Filter (multiline) vconn debug messages from ovs-vswitchd.log.
# Use with vconn_sub() and ofctl_strip()
print_vconn_debug () { awk -F\| < ovs-vswitchd.log '
BEGIN { prt=0 }
/\|vconn\|DBG\|/ { sub(/[ \t]*$/, ""); print $3 "|" $4 "|" $5; prt=1; next }
$4 != "" { prt=0; next }
prt==1 { sub(/[ \t]*$/, ""); print $0 }
'
}

vconn_sub() {
    sed '
s/tcp:127.0.0.1:[0-9][0-9]*:/unix:/
s/unix#[0-9]*:/unix:/
'
}


# PARSE_LISTENING_PORT LOGFILE VARIABLE
#
# Parses the TCP or SSL port on which a server is listening from
# LOGFILE, given that the server was told to listen on a kernel-chosen
# port, and assigns the port number to shell VARIABLE.  You should
# specify the listening remote as ptcp:0:127.0.0.1 or
# pssl:0:127.0.0.1, or the equivalent with [::1] instead of 127.0.0.1.
#
# Here's an example of how to use this with ovsdb-server:
#
#    ovsdb-server --log-file --remote=ptcp:0:127.0.0.1 ...
#    PARSE_LISTENING_PORT([ovsdb-server.log], [TCP_PORT])
#    # Now $TCP_PORT holds the listening port.


start_daemon () {
    "$@" -vconsole:off --detach --no-chdir --pidfile --log-file
    pidfile="$OVS_RUNDIR"/$1.pid
    on_exit "test -e \"$pidfile\" && kill \`cat \"$pidfile\"\`"
}

# sim_add SANDBOX
#
# Starts a new simulated Open vSwitch instance named SANDBOX.  Files related to
# the instance, such as logs, databases, sockets, and pidfiles, are created in
# a subdirectory of the main test directory also named SANDBOX.  Afterward, the
# "as" command (see below) can be used to run Open vSwitch utilities in the
# context of the new sandbox.
#
# The new sandbox starts out without any bridges.  Use ovs-vsctl in the context
# of the new sandbox to create a bridge, e.g.:
#
#     sim_add hv0           # Create sandbox hv0.
#     as hv0                # Set hv0 as default sandbox.
#     ovs-vsctl add-br br0  # Add bridge br0 inside hv0.
#
# or:
#
#     sim_add hv0
#     as hv0 ovs-vsctl add-br br0
sims=
sim_add () {
   echo "adding simulator '$1'"

   sims="$sims $1"

   # Create sandbox.
   local d="$ovs_base"/$1
   mkdir "$d" || return 1
   ovs_setenv $1

   # Create database and start ovsdb-server.
   : > "$d"/.conf.db.~lock~
   as $1 ovsdb-tool create "$d"/conf.db "$abs_top_srcdir"/vswitchd/vswitch.ovsschema || return 1
   as $1 start_daemon ovsdb-server --remote=punix:"$d"/db.sock || return 1

   # Initialize database.
   as $1 ovs-vsctl --no-wait -- init || return 1

   # Start ovs-vswitchd
   as $1 start_daemon ovs-vswitchd --enable-dummy=system -vvconn -vofproto_dpif -vunixctl
}

# "as $1" sets the OVS_*DIR environment variables to point to $ovs_base/$1.
#
# "as $1 COMMAND..." sets those variables in a subshell and invokes COMMAND
# there.
as() {
    if test "X$2" != X; then
        (ovs_setenv $1; shift; "$@")
    else
        ovs_setenv $1
    fi
}

# Strips 'xid=0x1234' from ovs-ofctl output.
strip_xids () {
    sed 's/ (xid=0x[0-9a-fA-F]*)//'
}

# Changes all 'used:...' to say 'used:0.0', to make output easier to compare.
strip_used () {
    sed 's/used:[0-9]\.[0-9]*/used:0.0/'
}

# Removes all 'duration=...' to make output easier to compare.
strip_duration () {
    sed 's/duration=[0-9]*\.[0-9]*s,//'
}

# Strips 'ufid:...' from output, to make it easier to compare.
# (ufids are random.)
strip_ufid () {
    sed 's/mega_ufid:[-0-9a-f]* //
    s/ufid:[-0-9a-f]* //'
}

check_logs () {
    local logs
    for log in *.log; do
        case ${log} in # (
            '*.log'|testsuite.log) ;; # (
            *) logs="${logs} ${log}" ;;
        esac
    done

    # We most notably ignore 'Broken pipe' warnings.  These often and
    # intermittently appear in ovsdb-server.log, because *ctl commands
    # (e.g. ovs-vsctl) exit right after committing a change to the
    # database.  However, in reaction, some daemon may immediately update the
    # database, and this later update may cause database sending update back to
    # *ctl command if *ctl has not exited yet.  If *ctl command exits before
    # the database calls send, the send fails with 'Broken pipe' or
    # 'not connected' depending on system.  Also removes all 'connection reset'
    # warning logs for similar reasons (EPIPE, ENOTCONN or ECONNRESET can be
    # returned on a send depending on whether the peer had unconsumed data
    # when it closed the socket).
    #
    # We also ignore "Dropped # log messages..." messages.  Otherwise, even if
    # we ignore the messages that were rate-limited, we can end up failing just
    # because of the announcement that rate-limiting happened (and in a racy,
    # timing-dependent way, too).
    sed -n "$1
/reset by peer/d
/Broken pipe/d
/is not connected/d
/timeval.*Unreasonably long [0-9]*ms poll interval/d
/timeval.*faults: [0-9]* minor, [0-9]* major/d
/timeval.*disk: [0-9]* reads, [0-9]* writes/d
/timeval.*context switches: [0-9]* voluntary, [0-9]* involuntary/d
/ovs_rcu.*blocked [0-9]* ms waiting for .* to quiesce/d
/Dropped [0-9]* log messages/d
/|WARN|/p
/|ERR|/p
/|EMER|/p" ${logs}
}

# add_of_br BRNUM [ARG...]
add_of_br () {
    local brnum=$1; shift
    local br=br$brnum
    local dpid=fedcba987654321$brnum
    local mac=aa:55:aa:55:00:0$brnum
    ovs-vsctl \
        -- add-br $br \
        -- set bridge $br datapath-type=dummy \
                          fail-mode=secure \
                          other-config:datapath-id=$dpid \
                          other-config:hwaddr=$mac \
                          protocols="[OpenFlow10,OpenFlow11,OpenFlow12,\
                                       OpenFlow13,OpenFlow14,OpenFlow15]" \
        -- "$@"
}

# add_of_ports__ PORT_TYPE [--pcap] BRIDGE PNUM...
#
# Creates PORT_TYPE interfaces in BRIDGE named pPNUM, OpenFlow port number
# PNUM, and datapath port number PNUM (the latter is a consequence of
# the dummy implementation, which tries to assign datapath port
# numbers based on port names).
#
# If --pcap is supplied then packets received from the interface will
# be written to $port-rx.pcap and those sent to it to $port-tx.pcap.
add_of_ports__ () {
    local args
    local pcap=false
    local ptype=$1
    shift
    if test "$1" = --pcap; then
        pcap=:
    shift
    fi
    local br=$1; shift
    for pnum; do
        as_fn_append args " -- add-port $br p$pnum -- set Interface p$pnum type=$ptype ofport_request=$pnum"
    if $pcap; then
        as_fn_append args " -- set Interface p$pnum options:rxq_pcap=p$pnum-rx.pcap options:tx_pcap=p$pnum-tx.pcap"
    fi
    done
    echo ovs-vsctl $args
    ovs-vsctl $args
}

# add_of_ports [--pcap] BRIDGE PNUM...
#
add_of_ports () {
    add_of_ports__ dummy $@
}

# add_pmd_of_ports [--pcap] BRIDGE PNUM...
#
add_pmd_of_ports () {
    add_of_ports__ dummy-pmd $@
}


# Create the master directory if it doesn't already exist.
as_dir="$at_suite_dir"; as_fn_mkdir_p ||
  as_fn_error $? "cannot create \`$at_suite_dir'" "$LINENO" 5

# Can we diff with `/dev/null'?  DU 5.0 refuses.
if diff /dev/null /dev/null >/dev/null 2>&1; then
  at_devnull=/dev/null
else
  at_devnull=$at_suite_dir/devnull
  >"$at_devnull"
fi

# Use `diff -u' when possible.
if at_diff=`diff -u "$at_devnull" "$at_devnull" 2>&1` && test -z "$at_diff"
then
  at_diff='diff -u'
else
  at_diff=diff
fi

# Get the last needed group.
for at_group in : $at_groups; do :; done

# Extract the start and end lines of each test group at the tail
# of this file
awk '
BEGIN { FS="" }
/^#AT_START_/ {
  start = NR
}
/^#AT_STOP_/ {
  test = substr ($ 0, 10)
  print "at_sed" test "=\"1," start "d;" (NR-1) "q\""
  if (test == "'"$at_group"'") exit
}' "$at_myself" > "$at_suite_dir/at-source-lines" &&
. "$at_suite_dir/at-source-lines" ||
  as_fn_error $? "cannot create test line number cache" "$LINENO" 5
rm -f "$at_suite_dir/at-source-lines"

# Set number of jobs for `-j'; avoid more jobs than test groups.
set X $at_groups; shift; at_max_jobs=$#
if test $at_max_jobs -eq 0; then
  at_jobs=1
fi
if test $at_jobs -ne 1 &&
   { test $at_jobs -eq 0 || test $at_jobs -gt $at_max_jobs; }; then
  at_jobs=$at_max_jobs
fi

# If parallel mode, don't output banners, don't split summary lines.
if test $at_jobs -ne 1; then
  at_print_banners=false
  at_quiet=:
fi

# Set up helper dirs.
rm -rf "$at_helper_dir" &&
mkdir "$at_helper_dir" &&
cd "$at_helper_dir" &&
{ test -z "$at_groups" || mkdir $at_groups; } ||
as_fn_error $? "testsuite directory setup failed" "$LINENO" 5

# Functions for running a test group.  We leave the actual
# test group execution outside of a shell function in order
# to avoid hitting zsh 4.x exit status bugs.

# at_fn_group_prepare
# -------------------
# Prepare for running a test group.
at_fn_group_prepare ()
{
  # The directory for additional per-group helper files.
  at_job_dir=$at_helper_dir/$at_group
  # The file containing the location of the last AT_CHECK.
  at_check_line_file=$at_job_dir/check-line
  # The file containing the exit status of the last command.
  at_status_file=$at_job_dir/status
  # The files containing the output of the tested commands.
  at_stdout=$at_job_dir/stdout
  at_stder1=$at_job_dir/stder1
  at_stderr=$at_job_dir/stderr
  # The file containing the code for a test group.
  at_test_source=$at_job_dir/test-source
  # The file containing dates.
  at_times_file=$at_job_dir/times

  # Be sure to come back to the top test directory.
  cd "$at_suite_dir"

  # Clearly separate the test groups when verbose.
  $at_first || $at_verbose echo

  at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'


  # Create a fresh directory for the next test group, and enter.
  # If one already exists, the user may have invoked ./run from
  # within that directory; we remove the contents, but not the
  # directory itself, so that we aren't pulling the rug out from
  # under the shell's notion of the current directory.
  at_group_dir=$at_suite_dir/$at_group_normalized
  at_group_log=$at_group_dir/$as_me.log
  if test -d "$at_group_dir"; then
  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx {} \;
  rm -fr "$at_group_dir"/* "$at_group_dir"/.[!.] "$at_group_dir"/.??*
fi ||
    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: test directory for $at_group_normalized could not be cleaned" >&5
$as_echo "$as_me: WARNING: test directory for $at_group_normalized could not be cleaned" >&2;}
  # Be tolerant if the above `rm' was not able to remove the directory.
  as_dir="$at_group_dir"; as_fn_mkdir_p

  echo 0 > "$at_status_file"

  # In verbose mode, append to the log file *and* show on
  # the standard output; in quiet mode only write to the log.
  if test -z "$at_verbose"; then
    at_tee_pipe='tee -a "$at_group_log"'
  else
    at_tee_pipe='cat >> "$at_group_log"'
  fi
}

# at_fn_group_banner ORDINAL LINE DESC PAD [BANNER]
# -------------------------------------------------
# Declare the test group ORDINAL, located at LINE with group description DESC,
# and residing under BANNER. Use PAD to align the status column.
at_fn_group_banner ()
{
  at_setup_line="$2"
  test -n "$5" && at_fn_banner $5
  at_desc="$3"
  case $1 in
    [0-9])      at_desc_line="  $1: ";;
    [0-9][0-9]) at_desc_line=" $1: " ;;
    *)          at_desc_line="$1: "  ;;
  esac
  as_fn_append at_desc_line "$3$4"
  $at_quiet $as_echo_n "$at_desc_line"
  echo "#                             -*- compilation -*-" >> "$at_group_log"
}

# at_fn_group_postprocess
# -----------------------
# Perform cleanup after running a test group.
at_fn_group_postprocess ()
{
  # Be sure to come back to the suite directory, in particular
  # since below we might `rm' the group directory we are in currently.
  cd "$at_suite_dir"

  if test ! -f "$at_check_line_file"; then
    sed "s/^ */$as_me: WARNING: /" <<_ATEOF
      A failure happened in a test group before any test could be
      run. This means that test suite is improperly designed.  Please
      report this failure to <bugs@openvswitch.org>.
_ATEOF
    $as_echo "$at_setup_line" >"$at_check_line_file"
    at_status=99
  fi
  $at_verbose $as_echo_n "$at_group. $at_setup_line: "
  $as_echo_n "$at_group. $at_setup_line: " >> "$at_group_log"
  case $at_xfail:$at_status in
    yes:0)
	at_msg="UNEXPECTED PASS"
	at_res=xpass
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    no:0)
	at_msg="ok"
	at_res=pass
	at_errexit=false
	at_color=$at_grn
	;;
    *:77)
	at_msg='skipped ('`cat "$at_check_line_file"`')'
	at_res=skip
	at_errexit=false
	at_color=$at_blu
	;;
    no:* | *:99)
	at_msg='FAILED ('`cat "$at_check_line_file"`')'
	at_res=fail
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    yes:*)
	at_msg='expected failure ('`cat "$at_check_line_file"`')'
	at_res=xfail
	at_errexit=false
	at_color=$at_lgn
	;;
  esac
  echo "$at_res" > "$at_job_dir/$at_res"
  # In parallel mode, output the summary line only afterwards.
  if test $at_jobs -ne 1 && test -n "$at_verbose"; then
    $as_echo "$at_desc_line $at_color$at_msg$at_std"
  else
    # Make sure there is a separator even with long titles.
    $as_echo " $at_color$at_msg$at_std"
  fi
  at_log_msg="$at_group. $at_desc ($at_setup_line): $at_msg"
  case $at_status in
    0|77)
      # $at_times_file is only available if the group succeeded.
      # We're not including the group log, so the success message
      # is written in the global log separately.  But we also
      # write to the group log in case they're using -d.
      if test -f "$at_times_file"; then
	at_log_msg="$at_log_msg     ("`sed 1d "$at_times_file"`')'
	rm -f "$at_times_file"
      fi
      $as_echo "$at_log_msg" >> "$at_group_log"
      $as_echo "$at_log_msg" >&5

      # Cleanup the group directory, unless the user wants the files
      # or the success was unexpected.
      if $at_debug_p || test $at_res = xpass; then
	at_fn_create_debugging_script
	if test $at_res = xpass && $at_errexit; then
	  echo stop > "$at_stop_file"
	fi
      else
	if test -d "$at_group_dir"; then
	  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
	  rm -fr "$at_group_dir"
	fi
	rm -f "$at_test_source"
      fi
      ;;
    *)
      # Upon failure, include the log into the testsuite's global
      # log.  The failure message is written in the group log.  It
      # is later included in the global log.
      $as_echo "$at_log_msg" >> "$at_group_log"

      # Upon failure, keep the group directory for autopsy, and create
      # the debugging script.  With -e, do not start any further tests.
      at_fn_create_debugging_script
      if $at_errexit; then
	echo stop > "$at_stop_file"
      fi
      ;;
  esac
}


## ------------ ##
## Driver loop. ##
## ------------ ##


if (set -m && set +m && set +b) >/dev/null 2>&1; then
  set +b
  at_job_control_on='set -m' at_job_control_off='set +m' at_job_group=-
else
  at_job_control_on=: at_job_control_off=: at_job_group=
fi

for at_signal in 1 2 15; do
  trap 'set +x; set +e
	$at_job_control_off
	at_signal='"$at_signal"'
	echo stop > "$at_stop_file"
	trap "" $at_signal
	at_pgids=
	for at_pgid in `jobs -p 2>/dev/null`; do
	  at_pgids="$at_pgids $at_job_group$at_pgid"
	done
	test -z "$at_pgids" || kill -$at_signal $at_pgids 2>/dev/null
	wait
	if test "$at_jobs" -eq 1 || test -z "$at_verbose"; then
	  echo >&2
	fi
	at_signame=`kill -l $at_signal 2>&1 || echo $at_signal`
	set x $at_signame
	test 0 -gt 2 && at_signame=$at_signal
	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: caught signal $at_signame, bailing out" >&5
$as_echo "$as_me: WARNING: caught signal $at_signame, bailing out" >&2;}
	as_fn_arith 128 + $at_signal && exit_status=$as_val
	as_fn_exit $exit_status' $at_signal
done

rm -f "$at_stop_file"
at_first=:

if test $at_jobs -ne 1 &&
     rm -f "$at_job_fifo" &&
     test -n "$at_job_group" &&
     ( mkfifo "$at_job_fifo" && trap 'exit 1' PIPE STOP TSTP ) 2>/dev/null
then
  # FIFO job dispatcher.

  trap 'at_pids=
	for at_pid in `jobs -p`; do
	  at_pids="$at_pids $at_job_group$at_pid"
	done
	if test -n "$at_pids"; then
	  at_sig=TSTP
	  test "${TMOUT+set}" = set && at_sig=STOP
	  kill -$at_sig $at_pids 2>/dev/null
	fi
	kill -STOP $$
	test -z "$at_pids" || kill -CONT $at_pids 2>/dev/null' TSTP

  echo
  # Turn jobs into a list of numbers, starting from 1.
  at_joblist=`$as_echo "$at_groups" | sed -n 1,${at_jobs}p`

  set X $at_joblist
  shift
  for at_group in $at_groups; do
    $at_job_control_on 2>/dev/null
    (
      # Start one test group.
      $at_job_control_off
      if $at_first; then
	exec 7>"$at_job_fifo"
      else
	exec 6<&-
      fi
      trap 'set +x; set +e
	    trap "" PIPE
	    echo stop > "$at_stop_file"
	    echo >&7
	    as_fn_exit 141' PIPE
      at_fn_group_prepare
      if cd "$at_group_dir" &&
	 at_fn_test $at_group &&
	 . "$at_test_source"
      then :; else
	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
$as_echo "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
	at_failed=:
      fi
      at_fn_group_postprocess
      echo >&7
    ) &
    $at_job_control_off
    if $at_first; then
      at_first=false
      exec 6<"$at_job_fifo" 7>"$at_job_fifo"
    fi
    shift # Consume one token.
    if test $# -gt 0; then :; else
      read at_token <&6 || break
      set x $*
    fi
    test -f "$at_stop_file" && break
  done
  exec 7>&-
  # Read back the remaining ($at_jobs - 1) tokens.
  set X $at_joblist
  shift
  if test $# -gt 0; then
    shift
    for at_job
    do
      read at_token
    done <&6
  fi
  exec 6<&-
  wait
else
  # Run serially, avoid forks and other potential surprises.
  for at_group in $at_groups; do
    at_fn_group_prepare
    if cd "$at_group_dir" &&
       at_fn_test $at_group &&
       . "$at_test_source"; then :; else
      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
$as_echo "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
      at_failed=:
    fi
    at_fn_group_postprocess
    test -f "$at_stop_file" && break
    at_first=false
  done
fi

# Wrap up the test suite with summary statistics.
cd "$at_helper_dir"

# Use ?..???? when the list must remain sorted, the faster * otherwise.
at_pass_list=`for f in */pass; do echo $f; done | sed '/\*/d; s,/pass,,'`
at_skip_list=`for f in */skip; do echo $f; done | sed '/\*/d; s,/skip,,'`
at_xfail_list=`for f in */xfail; do echo $f; done | sed '/\*/d; s,/xfail,,'`
at_xpass_list=`for f in ?/xpass ??/xpass ???/xpass ????/xpass; do
		 echo $f; done | sed '/?/d; s,/xpass,,'`
at_fail_list=`for f in ?/fail ??/fail ???/fail ????/fail; do
		echo $f; done | sed '/?/d; s,/fail,,'`

set X $at_pass_list $at_xpass_list $at_xfail_list $at_fail_list $at_skip_list
shift; at_group_count=$#
set X $at_xpass_list; shift; at_xpass_count=$#; at_xpass_list=$*
set X $at_xfail_list; shift; at_xfail_count=$#
set X $at_fail_list; shift; at_fail_count=$#; at_fail_list=$*
set X $at_skip_list; shift; at_skip_count=$#

as_fn_arith $at_group_count - $at_skip_count && at_run_count=$as_val
as_fn_arith $at_xpass_count + $at_fail_count && at_unexpected_count=$as_val
as_fn_arith $at_xfail_count + $at_fail_count && at_total_fail_count=$as_val

# Back to the top directory.
cd "$at_dir"
rm -rf "$at_helper_dir"

# Compute the duration of the suite.
at_stop_date=`date`
at_stop_time=`date +%s 2>/dev/null`
$as_echo "$as_me: ending at: $at_stop_date" >&5
case $at_start_time,$at_stop_time in
  [0-9]*,[0-9]*)
    as_fn_arith $at_stop_time - $at_start_time && at_duration_s=$as_val
    as_fn_arith $at_duration_s / 60 && at_duration_m=$as_val
    as_fn_arith $at_duration_m / 60 && at_duration_h=$as_val
    as_fn_arith $at_duration_s % 60 && at_duration_s=$as_val
    as_fn_arith $at_duration_m % 60 && at_duration_m=$as_val
    at_duration="${at_duration_h}h ${at_duration_m}m ${at_duration_s}s"
    $as_echo "$as_me: test suite duration: $at_duration" >&5
    ;;
esac

echo
$as_echo "## ------------- ##
## Test results. ##
## ------------- ##"
echo
{
  echo
  $as_echo "## ------------- ##
## Test results. ##
## ------------- ##"
  echo
} >&5

if test $at_run_count = 1; then
  at_result="1 test"
  at_were=was
else
  at_result="$at_run_count tests"
  at_were=were
fi
if $at_errexit_p && test $at_unexpected_count != 0; then
  if test $at_xpass_count = 1; then
    at_result="$at_result $at_were run, one passed"
  else
    at_result="$at_result $at_were run, one failed"
  fi
  at_result="$at_result unexpectedly and inhibited subsequent tests."
  at_color=$at_red
else
  # Don't you just love exponential explosion of the number of cases?
  at_color=$at_red
  case $at_xpass_count:$at_fail_count:$at_xfail_count in
    # So far, so good.
    0:0:0) at_result="$at_result $at_were successful." at_color=$at_grn ;;
    0:0:*) at_result="$at_result behaved as expected." at_color=$at_lgn ;;

    # Some unexpected failures
    0:*:0) at_result="$at_result $at_were run,
$at_fail_count failed unexpectedly." ;;

    # Some failures, both expected and unexpected
    0:*:1) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    0:*:*) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;

    # No unexpected failures, but some xpasses
    *:0:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly." ;;

    # No expected failures, but failures and xpasses
    *:1:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failure)." ;;
    *:*:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failures)." ;;

    # All of them.
    *:*:1) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    *:*:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;
  esac

  if test $at_skip_count = 0 && test $at_run_count -gt 1; then
    at_result="All $at_result"
  fi
fi

# Now put skips in the mix.
case $at_skip_count in
  0) ;;
  1) at_result="$at_result
1 test was skipped." ;;
  *) at_result="$at_result
$at_skip_count tests were skipped." ;;
esac

if test $at_unexpected_count = 0; then
  echo "$at_color$at_result$at_std"
  echo "$at_result" >&5
else
  echo "${at_color}ERROR: $at_result$at_std" >&2
  echo "ERROR: $at_result" >&5
  {
    echo
    $as_echo "## ------------------------ ##
## Summary of the failures. ##
## ------------------------ ##"

    # Summary of failed and skipped tests.
    if test $at_fail_count != 0; then
      echo "Failed tests:"
      $SHELL "$at_myself" $at_fail_list --list
      echo
    fi
    if test $at_skip_count != 0; then
      echo "Skipped tests:"
      $SHELL "$at_myself" $at_skip_list --list
      echo
    fi
    if test $at_xpass_count != 0; then
      echo "Unexpected passes:"
      $SHELL "$at_myself" $at_xpass_list --list
      echo
    fi
    if test $at_fail_count != 0; then
      $as_echo "## ---------------------- ##
## Detailed failed tests. ##
## ---------------------- ##"
      echo
      for at_group in $at_fail_list
      do
	at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'

	cat "$at_suite_dir/$at_group_normalized/$as_me.log"
	echo
      done
      echo
    fi
    if test -n "$at_top_srcdir"; then
      sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## ${at_top_build_prefix}config.log ##
_ASBOX
      sed 's/^/| /' ${at_top_build_prefix}config.log
      echo
    fi
  } >&5

  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## $as_me.log was created. ##
_ASBOX

  echo
  if $at_debug_p; then
    at_msg='per-test log files'
  else
    at_msg="\`${at_testdir+${at_testdir}/}$as_me.log'"
  fi
  $as_echo "Please send $at_msg and all information you think might help:

   To: <bugs@openvswitch.org>
   Subject: [openvswitch 2.14.0] $as_me: $at_fail_list${at_fail_list:+ failed${at_xpass_list:+, }}$at_xpass_list${at_xpass_list:+ passed unexpectedly}

You may investigate any problem if you feel able to do so, in which
case the test suite provides a good starting point.  Its output may
be found below \`${at_testdir+${at_testdir}/}$as_me.dir'.
"
  exit 1
fi

exit 0

## ------------- ##
## Actual tests. ##
## ------------- ##
#AT_START_1
at_fn_group_banner 1 'system-traffic.at:3' \
  "datapath - ping between two ports" "              " 1
at_xfail=no
(
  $as_echo "1. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:4: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:6"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:8: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:8"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:8"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:8: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:8"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:8"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:10"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:10"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:10"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:10"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:10"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:10"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:10"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:10: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:10"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:11"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:11"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:11"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:11"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:11"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:11"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:11"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:11: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:11"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:11"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



 { set +x
$as_echo "$at_srcdir/system-traffic.at:13: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:13"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:16: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:16"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:16"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:19: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:19"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:23: check_logs "
at_fn_check_prepare_trace "system-traffic.at:23"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:23: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:23"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:23: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:23"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:23" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:23: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:23"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:23: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:23"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:23" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:23: :; "
at_fn_check_prepare_trace "system-traffic.at:23"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_1
#AT_START_2
at_fn_group_banner 2 'system-traffic.at:26' \
  "datapath - http between two ports" "              " 1
at_xfail=no
(
  $as_echo "2. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:27: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:27"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:27: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:27"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:27: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:27"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:27: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:27"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:27: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:27"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:27: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:27"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:27: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:27"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:27: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:27"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:27"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:29: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:29"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:29"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:31: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:31"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:31"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:31: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:31"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:31"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:33"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:33"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:33"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:33"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:33"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:33"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:33"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:33: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:33"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:33"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:34"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:34"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:34"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:34"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:34"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:34"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:34"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:34: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:34"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:34"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



 { set +x
$as_echo "$at_srcdir/system-traffic.at:36: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:36"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:36"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:40" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:41: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:41"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:41"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:43: check_logs "
at_fn_check_prepare_trace "system-traffic.at:43"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:43: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:43"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:43: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:43"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:43" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:43: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:43"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:43: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:43"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:43" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:43: :; "
at_fn_check_prepare_trace "system-traffic.at:43"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:43"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_2
#AT_START_3
at_fn_group_banner 3 'system-traffic.at:46' \
  "datapath - ping between two ports on vlan" "      " 1
at_xfail=no
(
  $as_echo "3. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:47: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:47"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:47: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:47"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:47: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:47"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:47: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:47"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:47: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:47"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:47: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:47"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:47: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:47"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:47: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:47"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:47"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:49: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:49"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:51: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:51"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:51: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:51"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:53"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:53"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:53"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:53"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:53"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:53"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:53"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:53: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:53"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:54"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:54"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:54"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:54"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:54"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:54"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:54"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:54: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:54"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:56: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:56"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:56"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:56: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:56"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:56"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:56: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:56"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:56"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:57: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:57"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:57"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:57: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:57"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:57"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:57: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:57"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:57"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:59: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:59"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:59"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:62: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:62"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:65: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:65"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:65"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:69: check_logs "
at_fn_check_prepare_trace "system-traffic.at:69"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:69: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:69"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:69: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:69"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:69" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:69: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:69"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:69: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:69"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:69" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:69: :; "
at_fn_check_prepare_trace "system-traffic.at:69"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:69"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_3
#AT_START_4
at_fn_group_banner 4 'system-traffic.at:72' \
  "datapath - ping between two ports on cvlan" "     " 1
at_xfail=no
(
  $as_echo "4. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:73: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:73"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:73: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:73"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:73: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:73"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:73: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:73"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:73: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:73"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:73: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:73"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:73: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:73"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:73: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:73"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:73"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:74" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:74"
     $as_echo "system-traffic.at:74" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:74"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:76: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:76"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:76"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:78: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:78"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:78"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:78: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:78"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:78"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:80"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:80"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:80"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:80"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:80"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:80"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:80"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:80: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:80"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:81"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:81"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:81"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:81"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:81"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:81"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:81"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:81: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:81"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:83: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:83"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:83"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:83: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:83"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:83"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:83: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"10.255.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:83"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "10.255.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:83"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:83: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:83"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:83"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:84: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:84"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:84"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:84: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:84"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:84"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:84: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"10.255.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:84"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "10.255.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:84"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:84: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:84"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:84"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:86: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:86"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:86: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:86"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:86: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:86"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:86: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:86"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:87: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:87"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:87: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:87"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:87: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:87"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:87: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:87"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:89" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:91: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:91"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:91"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:94: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:94"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:94"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:97: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:97"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:97"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:101: check_logs "
at_fn_check_prepare_trace "system-traffic.at:101"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:101: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:101"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:101: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:101"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:101" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:101: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:101"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:101: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:101"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:101" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:101: :; "
at_fn_check_prepare_trace "system-traffic.at:101"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_4
#AT_START_5
at_fn_group_banner 5 'system-traffic.at:104' \
  "datapath - ping6 between two ports" "             " 1
at_xfail=no
(
  $as_echo "5. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:105: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:105"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:105: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:105"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:105: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:105"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:105: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:105"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:105: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:105"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:105: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:105"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:105: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:105"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:105: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:105"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:107: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:107"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:109: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:109"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:109: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:109"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:111"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:111"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:111"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:111"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:111"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:111"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:111"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:111: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:111"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:112"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:112"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:112"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:112"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:112"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:112"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:112"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:112: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:112"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:117" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:119: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:119"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:119"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:122: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:122"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:122"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:125: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:125"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:125"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:129: check_logs "
at_fn_check_prepare_trace "system-traffic.at:129"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:129: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:129"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:129: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:129"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:129" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:129: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:129"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:129: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:129"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:129" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:129: :; "
at_fn_check_prepare_trace "system-traffic.at:129"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_5
#AT_START_6
at_fn_group_banner 6 'system-traffic.at:132' \
  "datapath - ping6 between two ports on vlan" "     " 1
at_xfail=no
(
  $as_echo "6. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:133: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:133"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:133: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:133"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:133: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:133"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:133: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:133"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:133: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:133"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:133: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:133"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:133: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:133"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:133: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:133"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:135: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:135"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:137: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:137"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:137: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:137"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:139"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:139"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:139"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:139"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:139"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:139"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:139"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:139: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:139"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:140"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:140"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:140"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:140"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:140"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:140"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:140"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:140: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:140"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:142: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:142"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:142"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:142: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:142"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:142"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:142: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 \"fc00:1::1/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:142"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 "fc00:1::1/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:142"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:143: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:143"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:143"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:143: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:143"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:143"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:143: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 \"fc00:1::2/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:143"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 "fc00:1::2/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:143"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00:1::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:148" "until ip netns exec at_ns0 ping6 -c 1 fc00:1::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:150: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:150"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:153: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:153"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:156: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:156"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:156"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:160: check_logs "
at_fn_check_prepare_trace "system-traffic.at:160"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:160: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:160"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:160: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:160"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:160" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:160: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:160"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:160: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:160"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:160" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:160: :; "
at_fn_check_prepare_trace "system-traffic.at:160"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_6
#AT_START_7
at_fn_group_banner 7 'system-traffic.at:163' \
  "datapath - ping6 between two ports on cvlan" "    " 1
at_xfail=no
(
  $as_echo "7. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:164: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:164"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:164: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:164"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:164: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:164"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:164: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:164"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:164: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:164"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:164: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:164"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:164: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:164"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:164: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:164"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:165" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:165"
     $as_echo "system-traffic.at:165" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:165"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:167: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:167"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:169: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:169"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:169"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:169: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:169"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:169"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:171"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:171"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:171"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:171"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:172"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:172"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:172"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:172"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:172"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:172"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:172"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:172: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:172"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:174: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:174"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:174: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:174"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:174: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"fc00:ffff::1/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:174"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "fc00:ffff::1/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:174: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:174"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:175: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:175"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:175"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:175: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:175"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:175"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:175: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"fc00:ffff::2/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:175"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "fc00:ffff::2/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:175"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:175: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:175"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:175"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:177: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:177"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:177: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:177"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:177: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"fc00:1::1/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:177"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "fc00:1::1/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:177: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:177"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:178: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:178"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:178: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:178"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:178: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"fc00:1::2/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:178"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "fc00:1::2/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:178: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:178"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00:1::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:180" "until ip netns exec at_ns0 ping6 -c 1 fc00:1::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:182: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:182"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:182"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:185: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:185"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:188: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:188"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:188"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:192: check_logs "
at_fn_check_prepare_trace "system-traffic.at:192"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:192: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:192"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:192: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:192"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:192" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:192: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:192"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:192: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:192"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:192" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:192: :; "
at_fn_check_prepare_trace "system-traffic.at:192"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_7
#AT_START_8
at_fn_group_banner 8 'system-traffic.at:195' \
  "datapath - ping over bond" "                      " 1
at_xfail=no
(
  $as_echo "8. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:196: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:196"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:196: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:196"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:196: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:196"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:196: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:196"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:196: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:196"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:196: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:196"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:196: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:196"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:196: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:196"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:198: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:198"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:198"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:200: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:200"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:200"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:200: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:200"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:200"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:202"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:202"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:202"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:202"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:202"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:202"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:202"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:202: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:202"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'



      BONDPORTS=""
      for port in p1 p2; do
          { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip link add \$port type veth peer name ovs-\$port"
at_fn_check_prepare_dynamic "ip link add $port type veth peer name ovs-$port" "system-traffic.at:203"
( $at_check_trace; ip link add $port type veth peer name ovs-$port
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


          { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip link set \$port netns at_ns1"
at_fn_check_prepare_dynamic "ip link set $port netns at_ns1" "system-traffic.at:203"
( $at_check_trace; ip link set $port netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

          { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip link set dev ovs-\$port up"
at_fn_check_prepare_dynamic "ip link set dev ovs-$port up" "system-traffic.at:203"
( $at_check_trace; ip link set dev ovs-$port up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

          BONDPORTS="$BONDPORTS ovs-$port"
          on_exit 'ip link del ovs-$port'
      done
       { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add name bond0 type bond
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add name bond0 type bond
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      case "$(echo lacp=active bond_mode=balance-tcp | sed 's/.*lacp=//' | sed 's/ .*//')" in
      active|passive)
           { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
sh -c \"echo 802.3ad > /sys/class/net/bond0/bonding/mode\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
sh -c "echo 802.3ad > /sys/class/net/bond0/bonding/mode"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


           { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
sh -c \"echo 100     > /sys/class/net/bond0/bonding/miimon\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
sh -c "echo 100     > /sys/class/net/bond0/bonding/miimon"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      ;;
      esac
      for port in p1 p2; do
           { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev \$port master bond0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev $port master bond0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      done
       { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev bond0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev bond0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev bond0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:203"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev bond0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:203: ovs-vsctl add-bond br0 ovs-bond0 \$BONDPORTS lacp=active bond_mode=balance-tcp"
at_fn_check_prepare_dynamic "ovs-vsctl add-bond br0 ovs-bond0 $BONDPORTS lacp=active bond_mode=balance-tcp" "system-traffic.at:203"
( $at_check_trace; ovs-vsctl add-bond br0 ovs-bond0 $BONDPORTS lacp=active bond_mode=balance-tcp
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      on_exit 'ip link del ovs-bond0'



ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:205" "until ip netns exec at_ns0 ping -c 1 10.1.1.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:207: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:207"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:207"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:210: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:210"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:213: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:213"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:213"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:217: check_logs "
at_fn_check_prepare_trace "system-traffic.at:217"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:217: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:217"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:217: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:217"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:217" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:217: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:217"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:217: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:217"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:217" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:217: :; "
at_fn_check_prepare_trace "system-traffic.at:217"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_8
#AT_START_9
at_fn_group_banner 9 'system-traffic.at:220' \
  "datapath - ping over vxlan tunnel" "              " 1
at_xfail=no
(
  $as_echo "9. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:221" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep dstport >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:221"
     $as_echo "system-traffic.at:221" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:221"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:223: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:223"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:223: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:223"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:223: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:223"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:223: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:223"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:223: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:223"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:223: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:223"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:223: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:223"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:223: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:223"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:226: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:226"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:227: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:227"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:227"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:229: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:229"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:229"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:232"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:232"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:232"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:232"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:232"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:232"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:232"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:232: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:232"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:233: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:233"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:233"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:234: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:234"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:238: ovs-vsctl add-port br0 at_vxlan0 -- \\
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:238"
( $at_check_trace; ovs-vsctl add-port br0 at_vxlan0 -- \
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:238"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:238: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:238"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:238"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:238: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:238"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:238"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:238: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:238"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:238"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:239: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:239"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:239"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:239: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:239"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:239"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:239: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:239"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:239"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:243: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:243"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:243"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:248: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:248"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:248"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:251: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:251"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:251"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:254: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:254"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:258: check_logs "
at_fn_check_prepare_trace "system-traffic.at:258"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:258: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:258"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:258: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:258"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:258" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:258: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:258"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:258: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:258"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:258" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:258: :; "
at_fn_check_prepare_trace "system-traffic.at:258"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_9
#AT_START_10
at_fn_group_banner 10 'system-traffic.at:261' \
  "datapath - ping over vxlan6 tunnel" "             " 1
at_xfail=no
(
  $as_echo "10. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:262" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep udp6zerocsum >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:262"
     $as_echo "system-traffic.at:262" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:262"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:264: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:264"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:264: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:264"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:264: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:264"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:264: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:264"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:264: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:264"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:264: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:264"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:264: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:264"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:264: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:264"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:267: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:267"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:267"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:268: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:268"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:270: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:270"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:273"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:273"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:273"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:273"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/64\" dev p0 \"nodad\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:273"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/64" dev p0 "nodad"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:273"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:273"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:273: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:273"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:274: ip addr add dev br-underlay \"fc00::100/64\" nodad"
at_fn_check_prepare_trace "system-traffic.at:274"
( $at_check_trace; ip addr add dev br-underlay "fc00::100/64" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:275: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:275"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:275"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:279: ovs-vsctl add-port br0 at_vxlan0 -- \\
              set int at_vxlan0 type=vxlan options:remote_ip=fc00::1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:279"
( $at_check_trace; ovs-vsctl add-port br0 at_vxlan0 -- \
              set int at_vxlan0 type=vxlan options:remote_ip=fc00::1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:279: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:279"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:279: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:279"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:279: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:279"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:279: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:279"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:280: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote fc00::100 id 0 dstport 4789 udp6zerocsumtx udp6zerocsumrx
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:280"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote fc00::100 id 0 dstport 4789 udp6zerocsumtx udp6zerocsumrx
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:280: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:280"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:280: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:280"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




     { set +x
$as_echo "$at_srcdir/system-traffic.at:280: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1430
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:280"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1430
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:283" "until ip netns exec at_ns0 ping6 -c 1 fc00::100"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:286: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:286"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:286"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:291: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:291"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:291"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:294: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:294"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:294"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:297: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:297"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:301: check_logs "
at_fn_check_prepare_trace "system-traffic.at:301"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:301: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:301"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:301: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:301"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:301" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:301: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:301"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:301: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:301"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:301" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:301: :; "
at_fn_check_prepare_trace "system-traffic.at:301"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_10
#AT_START_11
at_fn_group_banner 11 'system-traffic.at:304' \
  "datapath - ping over gre tunnel" "                " 1
at_xfail=no
(
  $as_echo "11. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:305" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:305"

$as_echo "system-traffic.at:306" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:306"
     $as_echo "system-traffic.at:306" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:306"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:308: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:308"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:308: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:308"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:308: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:308"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:308: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:308"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:308: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:308"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:308: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:308"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:308: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:308"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:308: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:308"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:311: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:311"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:312: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:312"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:312"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:314: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:314"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:314"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:317"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:317"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:317"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:317"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:317"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:317"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:317"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:317: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:317"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:318: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:318"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:318"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:319: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:319"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:323: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:323"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=gre options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:323"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:323: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:323"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:323"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:323: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:323"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:323"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:323: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:323"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:323"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:324: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gre0 type gretap remote 172.31.1.100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:324"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gre0 type gretap remote 172.31.1.100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:324"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:324: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gre0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:324"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gre0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:324"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:324: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gre0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:324"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gre0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:324"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:327: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:327"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:327"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:332: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:332"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:332"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:335: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:335"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:335"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:338: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:338"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:338"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:342: check_logs "
at_fn_check_prepare_trace "system-traffic.at:342"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:342: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:342"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:342: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:342"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:342" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:342: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:342"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:342: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:342"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:342" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:342: :; "
at_fn_check_prepare_trace "system-traffic.at:342"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_11
#AT_START_12
at_fn_group_banner 12 'system-traffic.at:345' \
  "datapath - ping over ip6gre L2 tunnel" "          " 1
at_xfail=no
(
  $as_echo "12. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:346" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:346"

$as_echo "system-traffic.at:347" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:347"
     $as_echo "system-traffic.at:347" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:347"
$as_echo "system-traffic.at:348" >"$at_check_line_file"
(! ip link add foo type erspan help 2>&1 | grep erspan >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:348"
     $as_echo "system-traffic.at:348" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:348"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:350: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:350"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:350: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:350"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:350: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:350"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:350: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:350"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:350: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:350"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:350: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:350"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:350: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:350"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:350: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:350"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:353: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:353"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:353"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:354: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:354"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:354"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:356: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:356"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:356"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:359"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:359"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:359"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:359"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00:100::1/96\" dev p0 nodad
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:359"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00:100::1/96" dev p0 nodad
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:359"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:359"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:359: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:359"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:360: ip addr add dev br-underlay \"fc00:100::100/96\" nodad"
at_fn_check_prepare_trace "system-traffic.at:360"
( $at_check_trace; ip addr add dev br-underlay "fc00:100::100/96" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:360"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:361: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:361"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:365: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=ip6gre options:remote_ip=fc00:100::1 options:packet_type=legacy_l2"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:365"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=ip6gre options:remote_ip=fc00:100::1 options:packet_type=legacy_l2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:365: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:365"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:365: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:365"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:365: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:365"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:365: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:365"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:367: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gretap0 type ip6gretap remote fc00:100::100 local fc00:100::1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:367"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gretap0 type ip6gretap remote fc00:100::100 local fc00:100::1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:367: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gretap0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:367"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gretap0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:367: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gretap0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:367"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gretap0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




     { set +x
$as_echo "$at_srcdir/system-traffic.at:367: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gretap0 mtu 1430
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:367"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gretap0 mtu 1430
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 2 fc00:100::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:370" "until ip netns exec at_ns0 ping6 -c 2 fc00:100::100"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:373: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:373"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:373"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:378: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:378"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:378"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:381: check_logs "
at_fn_check_prepare_trace "system-traffic.at:381"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:381: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:381"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:381: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:381"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:381" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:381: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:381"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:381: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:381"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:381" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:381: :; "
at_fn_check_prepare_trace "system-traffic.at:381"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_12
#AT_START_13
at_fn_group_banner 13 'system-traffic.at:385' \
  "datapath - ping over erspan v1 tunnel" "          " 1
at_xfail=no
(
  $as_echo "13. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:386" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:386"

$as_echo "system-traffic.at:387" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:387"
     $as_echo "system-traffic.at:387" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:387"
$as_echo "system-traffic.at:388" >"$at_check_line_file"
(! ip link add foo type erspan help 2>&1 | grep erspan >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:388"
     $as_echo "system-traffic.at:388" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:388"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:390: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:390"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:390: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:390"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:390: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:390"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:390: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:390"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:390: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:390"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:390: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:390"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:390: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:390"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:390: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:390"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:390"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:393: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:393"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:393"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:394: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:394"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:394"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:396: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:396"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:399"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:399"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:399"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:399"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:399"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:399"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:399"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:399: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:399"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:400: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:400"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:400"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:401: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:401"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:401"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:405: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=1 options:erspan_idx=7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:405"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=1 options:erspan_idx=7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:405: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:405"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:405: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:405"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:405: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:405"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:406: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type erspan remote 172.31.1.100 seq key 1 erspan_ver 1 erspan 7
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:406"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type erspan remote 172.31.1.100 seq key 1 erspan_ver 1 erspan 7
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:406"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:406: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:406"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:406"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:406: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:406"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:406"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:409: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:409"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:409"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:415: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1200 -i 0.3 -c 3 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:415"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1200 -i 0.3 -c 3 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:415"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:418: check_logs "
at_fn_check_prepare_trace "system-traffic.at:418"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:418: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:418"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:418: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:418"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:418" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:418: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:418"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:418: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:418"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:418" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:418: :; "
at_fn_check_prepare_trace "system-traffic.at:418"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_13
#AT_START_14
at_fn_group_banner 14 'system-traffic.at:421' \
  "datapath - ping over erspan v2 tunnel" "          " 1
at_xfail=no
(
  $as_echo "14. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:422" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:422"

$as_echo "system-traffic.at:423" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:423"
     $as_echo "system-traffic.at:423" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:423"
$as_echo "system-traffic.at:424" >"$at_check_line_file"
(! ip link add foo type erspan help 2>&1 | grep erspan >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:424"
     $as_echo "system-traffic.at:424" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:424"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:426: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:426"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:426: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:426"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:426: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:426"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:426: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:426"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:426: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:426"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:426: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:426"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:426: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:426"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:426: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:426"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:426"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:429: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:429"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:429"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:430: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:430"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:430"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:432: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:432"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:432"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:435"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:435"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:435"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:435"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:435"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:435"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:435"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:435: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:435"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:436: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:436"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:436"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:437: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:437"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:437"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:441: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=2 options:erspan_dir=1 options:erspan_hwid=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:441"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=2 options:erspan_dir=1 options:erspan_hwid=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:441: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:441"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:441: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:441"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:441: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:441"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:442: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type erspan remote 172.31.1.100 seq key 1 erspan_ver 2 erspan_dir egress erspan_hwid 7
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:442"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type erspan remote 172.31.1.100 seq key 1 erspan_ver 2 erspan_dir egress erspan_hwid 7
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:442: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:442"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:442: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:442"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:445: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:445"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:451: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1200 -i 0.3 -c 3 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:451"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1200 -i 0.3 -c 3 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:451"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:454: check_logs "
at_fn_check_prepare_trace "system-traffic.at:454"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:454: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:454"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:454: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:454"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:454" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:454: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:454"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:454: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:454"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:454" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:454: :; "
at_fn_check_prepare_trace "system-traffic.at:454"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_14
#AT_START_15
at_fn_group_banner 15 'system-traffic.at:457' \
  "datapath - ping over ip6erspan v1 tunnel" "       " 1
at_xfail=no
(
  $as_echo "15. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:458" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:458"

$as_echo "system-traffic.at:459" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:459"
     $as_echo "system-traffic.at:459" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:459"
$as_echo "system-traffic.at:460" >"$at_check_line_file"
(! ip link add foo type erspan help 2>&1 | grep erspan >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:460"
     $as_echo "system-traffic.at:460" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:460"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:462: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:462"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:462: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:462"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:462: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:462"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:462: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:462"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:462: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:462"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:462: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:462"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:462: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:462"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:462: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:462"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:465: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:465"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:465"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:466: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:466"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:468: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:468"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:468"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:471"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:471"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:471"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:471"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00:100::1/96\" dev p0 nodad
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:471"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00:100::1/96" dev p0 nodad
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:471"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:471"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:471: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:471"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:472: ip addr add dev br-underlay \"fc00:100::100/96\" nodad"
at_fn_check_prepare_trace "system-traffic.at:472"
( $at_check_trace; ip addr add dev br-underlay "fc00:100::100/96" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:472"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:473: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:473"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:473"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:477: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=123 options:erspan_ver=1 options:erspan_idx=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:477"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=123 options:erspan_ver=1 options:erspan_idx=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:477: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:477"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:477: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:477"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:477: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:477"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:477: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:477"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:479: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type ip6erspan remote fc00:100::100 local fc00:100::1 seq key 123 erspan_ver 1 erspan 7
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:479"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type ip6erspan remote fc00:100::100 local fc00:100::1 seq key 123 erspan_ver 1 erspan 7
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:479: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:479"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:479: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:479"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




     { set +x
$as_echo "$at_srcdir/system-traffic.at:479: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1430
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:479"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1430
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 2 fc00:100::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:482" "until ip netns exec at_ns0 ping6 -c 2 fc00:100::100"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:485: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:485"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:490: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:490"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:493: check_logs "
at_fn_check_prepare_trace "system-traffic.at:493"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:493: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:493"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:493: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:493"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:493" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:493: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:493"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:493: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:493"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:493" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:493: :; "
at_fn_check_prepare_trace "system-traffic.at:493"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_15
#AT_START_16
at_fn_group_banner 16 'system-traffic.at:496' \
  "datapath - ping over ip6erspan v2 tunnel" "       " 1
at_xfail=no
(
  $as_echo "16. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:497" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:497"

$as_echo "system-traffic.at:498" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:498"
     $as_echo "system-traffic.at:498" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:498"
$as_echo "system-traffic.at:499" >"$at_check_line_file"
(! ip link add foo type erspan help 2>&1 | grep erspan >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:499"
     $as_echo "system-traffic.at:499" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:499"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:501: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:501"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:501: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:501"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:501: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:501"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:501: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:501"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:501: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:501"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:501: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:501"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:501: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:501"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:501: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:501"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:501"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:504: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:504"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:504"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:505: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:505"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:505"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:507: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:507"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:507"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:510"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:510"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:510"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:510"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00:100::1/96\" dev p0 nodad
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:510"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00:100::1/96" dev p0 nodad
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:510"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:510"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:510: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:510"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:510"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:511: ip addr add dev br-underlay \"fc00:100::100/96\" nodad"
at_fn_check_prepare_trace "system-traffic.at:511"
( $at_check_trace; ip addr add dev br-underlay "fc00:100::100/96" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:511"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:512: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:512"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:512"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:516: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=121 options:erspan_ver=2 options:erspan_dir=0 options:erspan_hwid=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:516"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=121 options:erspan_ver=2 options:erspan_dir=0 options:erspan_hwid=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:516"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:516: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:516"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:516"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:516: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:516"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:516"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:516: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:516"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:516"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:516: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:516"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:516"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:518: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type ip6erspan remote fc00:100::100 local fc00:100::1 seq key 121 erspan_ver 2 erspan_dir ingress erspan_hwid 0x7
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:518"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_erspan0 type ip6erspan remote fc00:100::100 local fc00:100::1 seq key 121 erspan_ver 2 erspan_dir ingress erspan_hwid 0x7
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:518: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:518"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_erspan0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:518: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:518"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




     { set +x
$as_echo "$at_srcdir/system-traffic.at:518: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1430
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:518"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_erspan0 mtu 1430
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 2 fc00:100::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:522" "until ip netns exec at_ns0 ping6 -c 2 fc00:100::100"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:525: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:525"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:530: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:530"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:530"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:533: check_logs "
at_fn_check_prepare_trace "system-traffic.at:533"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:533: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:533"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:533: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:533"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:533" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:533: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:533"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:533: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:533"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:533" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:533: :; "
at_fn_check_prepare_trace "system-traffic.at:533"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:533"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_16
#AT_START_17
at_fn_group_banner 17 'system-traffic.at:536' \
  "datapath - ping over geneve tunnel" "             " 1
at_xfail=no
(
  $as_echo "17. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:537" >"$at_check_line_file"
(! ip link add foo type geneve help 2>&1 | grep geneve >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:537"
     $as_echo "system-traffic.at:537" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:537"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:539: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:539"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:539: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:539"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:539: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:539"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:539: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:539"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:539: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:539"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:539: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:539"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:539: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:539"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:539: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:539"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:542: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:542"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:543: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:543"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:543"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:545: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:545"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:545"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:548"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:548"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:548"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:548"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:548"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:548"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:548"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:548: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:548"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:549: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:549"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:549"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:550: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:550"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:550"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:554: ovs-vsctl add-port br0 at_gnv0 -- \\
              set int at_gnv0 type=geneve options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:554"
( $at_check_trace; ovs-vsctl add-port br0 at_gnv0 -- \
              set int at_gnv0 type=geneve options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:554: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:554"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:554: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:554"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:554: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:554"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:555: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote 172.31.1.100 vni 0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:555"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote 172.31.1.100 vni 0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:555"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:555: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:555"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:555"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:555: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:555"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:555"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:559: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:559"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:559"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:564: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:564"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:564"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:567: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:567"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:567"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:570: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:570"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:574: check_logs "
at_fn_check_prepare_trace "system-traffic.at:574"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:574: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:574"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:574: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:574"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:574" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:574: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:574"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:574: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:574"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:574" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:574: :; "
at_fn_check_prepare_trace "system-traffic.at:574"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_17
#AT_START_18
at_fn_group_banner 18 'system-traffic.at:577' \
  "datapath - flow resume with geneve tun_metadata" "" 1
at_xfail=no
(
  $as_echo "18. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:578" >"$at_check_line_file"
(! ip link add foo type geneve help 2>&1 | grep geneve >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:578"
     $as_echo "system-traffic.at:578" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:578"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:580: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:580"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:580: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:580"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:580: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:580"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:580: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:580"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:580: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:580"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:580: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:580"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:580: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:580"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:580: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:580"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:583: ovs-ofctl monitor br0 resume --detach --no-chdir --pidfile 2> /dev/null"
at_fn_check_prepare_trace "system-traffic.at:583"
( $at_check_trace; ovs-ofctl monitor br0 resume --detach --no-chdir --pidfile 2> /dev/null
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:585: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:585"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:585"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:588"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:588"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:588"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:588"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:589: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:589"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:589"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:590: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:590"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:594: ovs-vsctl add-port br0 at_gnv0 -- \\
              set int at_gnv0 type=geneve options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:594"
( $at_check_trace; ovs-vsctl add-port br0 at_gnv0 -- \
              set int at_gnv0 type=geneve options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:594"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:594: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:594"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:594"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:594: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:594"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:594"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:594: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:594"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:594"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:595: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote 172.31.1.100 vni 0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:595"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote 172.31.1.100 vni 0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:595: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:595"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:595: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:595"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
table=0, arp action=NORMAL
table=0, in_port=LOCAL icmp action=output:at_gnv0
table=0, in_port=at_gnv0 icmp action=set_field:0xa->tun_metadata0,resubmit(,1)
table=1, icmp action=controller(pause), resubmit(,2)
table=2, tun_metadata0=0xa, icmp action=output:LOCAL
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:606: ovs-ofctl add-tlv-map br0 \"{class=0xffff,type=0,len=4}->tun_metadata0\""
at_fn_check_prepare_trace "system-traffic.at:606"
( $at_check_trace; ovs-ofctl add-tlv-map br0 "{class=0xffff,type=0,len=4}->tun_metadata0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:607: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:607"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:608: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:608"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:610: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:610"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:610"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:615: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping 10.1.1.100 > /dev/null &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:615"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping 10.1.1.100 > /dev/null &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:617: ovs-ofctl add-tlv-map br0 \"{class=0xffff,type=0x88,len=4}->tun_metadata1\""
at_fn_check_prepare_trace "system-traffic.at:617"
( $at_check_trace; ovs-ofctl add-tlv-map br0 "{class=0xffff,type=0x88,len=4}->tun_metadata1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:617"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 1
{ set +x
$as_echo "$at_srcdir/system-traffic.at:619: ovs-ofctl add-tlv-map br0 \"{class=0xffff,type=0x99,len=4}->tun_metadata2\""
at_fn_check_prepare_trace "system-traffic.at:619"
( $at_check_trace; ovs-ofctl add-tlv-map br0 "{class=0xffff,type=0x99,len=4}->tun_metadata2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 1
{ set +x
$as_echo "$at_srcdir/system-traffic.at:621: ovs-ofctl add-tlv-map br0 \"{class=0xffff,type=0xaa,len=4}->tun_metadata3\""
at_fn_check_prepare_trace "system-traffic.at:621"
( $at_check_trace; ovs-ofctl add-tlv-map br0 "{class=0xffff,type=0xaa,len=4}->tun_metadata3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:621"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 1

{ set +x
$as_echo "$at_srcdir/system-traffic.at:624: test -e \$OVS_RUNDIR/ovs-ofctl.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-ofctl.pid" "system-traffic.at:624"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-ofctl.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:624"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-ofctl.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:624: ovs-appctl -t ovs-ofctl exit"
at_fn_check_prepare_trace "system-traffic.at:624"
( $at_check_trace; ovs-appctl -t ovs-ofctl exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:624"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:624" "while kill -0 \$TMPPID 2>/dev/null"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:625: check_logs "
at_fn_check_prepare_trace "system-traffic.at:625"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:625: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:625"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:625: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:625"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:625" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:625: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:625"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:625: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:625"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:625" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:625: :; "
at_fn_check_prepare_trace "system-traffic.at:625"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_18
#AT_START_19
at_fn_group_banner 19 'system-traffic.at:628' \
  "datapath - ping over geneve6 tunnel" "            " 1
at_xfail=no
(
  $as_echo "19. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:629" >"$at_check_line_file"
(! ip link add foo type geneve help 2>&1 | grep udp6zerocsum >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:629"
     $as_echo "system-traffic.at:629" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:629"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:631: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:631"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:631: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:631"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:631: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:631"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:631: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:631"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:631: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:631"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:631: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:631"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:631: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:631"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:631: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:631"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

{ set +x
$as_echo "$at_srcdir/system-traffic.at:634: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:634"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:635: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:635"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:635"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:637: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:637"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:637"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:640"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:640"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:640"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:640"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/64\" dev p0 \"nodad\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:640"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/64" dev p0 "nodad"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:640"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:640"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:640: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:640"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:641: ip addr add dev br-underlay \"fc00::100/64\" nodad"
at_fn_check_prepare_trace "system-traffic.at:641"
( $at_check_trace; ip addr add dev br-underlay "fc00::100/64" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:641"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:642: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:642"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:642"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:646: ovs-vsctl add-port br0 at_gnv0 -- \\
              set int at_gnv0 type=geneve options:remote_ip=fc00::1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:646"
( $at_check_trace; ovs-vsctl add-port br0 at_gnv0 -- \
              set int at_gnv0 type=geneve options:remote_ip=fc00::1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:646: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:646"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:646: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:646"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:646: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:646"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:646: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:646"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:647: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote fc00::100 vni 0 udp6zerocsumtx udp6zerocsumrx
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:647"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gnv0 type geneve remote fc00::100 vni 0 udp6zerocsumtx udp6zerocsumrx
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:647"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:647: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:647"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gnv0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:647"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:647: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:647"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:647"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




     { set +x
$as_echo "$at_srcdir/system-traffic.at:647: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1430
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:647"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gnv0 mtu 1430
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:647"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:650" "until ip netns exec at_ns0 ping6 -c 1 fc00::100"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:653: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:653"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:653"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:658: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:658"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:658"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:661: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:661"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:661"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:664: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:664"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:664"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:668: check_logs "
at_fn_check_prepare_trace "system-traffic.at:668"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:668: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:668"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:668: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:668"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:668" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:668: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:668"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:668: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:668"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:668" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:668: :; "
at_fn_check_prepare_trace "system-traffic.at:668"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_19
#AT_START_20
at_fn_group_banner 20 'system-traffic.at:671' \
  "datapath - ping over gre tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "20. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:672" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:672"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:674: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:674"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:674: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:674"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:674: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:674"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:674: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:674"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:674: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:674"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:674: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:674"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:674: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:674"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:674: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:674"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:674"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:675: ovs-vsctl -- set bridge br0 other-config:hwaddr=\\\"f2:ff:00:00:00:01\\\""
at_fn_check_prepare_trace "system-traffic.at:675"
( $at_check_trace; ovs-vsctl -- set bridge br0 other-config:hwaddr=\"f2:ff:00:00:00:01\"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:675"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"f2:ff:00:00:00:02\"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:678: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:678"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:678"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:679: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:679"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:679"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:681: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:681"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:684"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:684"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:684"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:684"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:684"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:684"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "f2:ff:00:00:00:03"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:684"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:684: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:684"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:685: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:685"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:685"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:686: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:686"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:686"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:689: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:689"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=gre options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:689: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:689"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:689: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:689"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:689: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:689"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'



iptables -I INPUT 1 -i br-underlay -j ACCEPT
on_exit 'iptables -D INPUT 1'

ip netns exec at_ns0 tcpdump -n -i p0 dst host 172.31.1.1 -l > p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:701: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:701"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:701"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff00000003080045000042ec2c4000402ff3bcac1f0101ac1f016400006558fffffffffffff2ff0000000408060001080006040001f2ff000000040a0101010000000000000a010164 actions=NORMAL"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0, length 46: ARP, Reply 10.1.1.100 is-at f2:ff:00:00:00:01.* length 28" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:712" "until cat p0.pcap | egrep \"IP 172.31.1.100 > 172.31.1.1: GREv0, length 46: ARP, Reply 10.1.1.100 is-at f2:ff:00:00:00:01.* length 28\" 2>&1 1>/dev/null"


ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000308004500007aec8e4000402ff322ac1f0101ac1f016400006558f2ff00000001f2ff00000004080045000054548f40004001cfb30a0101010a0101640800e6e829270003e1a3435b00000000ff1a050000000000101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637 actions=NORMAL"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0, length 102: IP 10.1.1.100 > 10.1.1.1: ICMP echo reply,.* length 64$" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:716" "until cat p0.pcap | egrep \"IP 172.31.1.100 > 172.31.1.1: GREv0, length 102: IP 10.1.1.100 > 10.1.1.1: ICMP echo reply,.* length 64\$\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:718: check_logs "
at_fn_check_prepare_trace "system-traffic.at:718"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:718: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:718"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:718: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:718"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:718" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:718: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:718"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:718: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:718"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:718" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:718: :; "
at_fn_check_prepare_trace "system-traffic.at:718"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_20
#AT_START_21
at_fn_group_banner 21 'system-traffic.at:721' \
  "datapath - ping over erspan v1 tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "21. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:722" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:722"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:724: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:724"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:724: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:724"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:724: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:724"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:724: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:724"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:724: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:724"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:724: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:724"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:724: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:724"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:724: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:724"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:724"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:725: ovs-vsctl -- set bridge br0 other-config:hwaddr=\\\"f2:ff:00:00:00:01\\\""
at_fn_check_prepare_trace "system-traffic.at:725"
( $at_check_trace; ovs-vsctl -- set bridge br0 other-config:hwaddr=\"f2:ff:00:00:00:01\"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:725"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"f2:ff:00:00:00:02\"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:728: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:728"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:728"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:729: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:729"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:729"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:731: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:731"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:731"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:734"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:734"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:734"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:734"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:734"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:734"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "f2:ff:00:00:00:03"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:734"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:734: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:734"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:735: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:735"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:735"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:736: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:736"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:736"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:740: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=1 options:erspan_idx=7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:740"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=1 options:erspan_idx=7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:740"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:740: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:740"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:740"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:740: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:740"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:740"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:740: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:740"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:740"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'



iptables -I INPUT 1 -i br-underlay -j ACCEPT
on_exit 'iptables -D INPUT 1'

ip netns exec at_ns0 tcpdump -n -x -i p0 dst host 172.31.1.1 -l > p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:752: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:752"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:752"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000308004500004e151d4000402fcac0ac1f0101ac1f0164100088be000000061000000100000007fffffffffffff2ff0000000408060001080006040001f2ff000000040a0101010000000000000a010164 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0030:  0806 0001 0800 0604 0002 f2ff 0000 0001" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:760" "until cat p0.pcap | egrep \"0x0030:  0806 0001 0800 0604 0002 f2ff 0000 0001\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0040:  0a01 0164 f2ff 0000 0004 0a01 0101" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:761" "until cat p0.pcap | egrep \"0x0040:  0a01 0164 f2ff 0000 0004 0a01 0101\" 2>&1 1>/dev/null"


$as_echo "system-traffic.at:764" >"$at_check_line_file"
(cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 122" 2>&1 1>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-traffic.at:764"

ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000308004500008e70cb4000402f6ed2ac1f0101ac1f0164100088be000000051000000100000007f2ff00000001f2ff0000000408004500005c4a3340004001da070a0101010a010164080084f238fb0001f36a6b5b0000000021870e0000000000101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 122" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:768" "until cat p0.pcap | egrep \"IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 122\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:770: check_logs "
at_fn_check_prepare_trace "system-traffic.at:770"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:770: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:770"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:770: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:770"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:770" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:770: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:770"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:770: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:770"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:770" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:770: :; "
at_fn_check_prepare_trace "system-traffic.at:770"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_21
#AT_START_22
at_fn_group_banner 22 'system-traffic.at:773' \
  "datapath - ping over erspan v2 tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "22. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:774" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:774"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:776: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:776"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:776: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:776"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:776: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:776"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:776: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:776"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:776: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:776"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:776: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:776"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:776: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:776"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:776: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:776"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:777: ovs-vsctl -- set bridge br0 other-config:hwaddr=\\\"f2:ff:00:00:00:01\\\""
at_fn_check_prepare_trace "system-traffic.at:777"
( $at_check_trace; ovs-vsctl -- set bridge br0 other-config:hwaddr=\"f2:ff:00:00:00:01\"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:777"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"f2:ff:00:00:00:02\"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:780: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:780"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:781: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:781"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:783: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:783"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:786"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:786"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:786"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:786"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "f2:ff:00:00:00:03"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:787: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:787"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:787"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:788: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:788"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:788"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:792: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=2 options:erspan_dir=1 options:erspan_hwid=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:792"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=erspan options:remote_ip=172.31.1.1 options:key=1 options:erspan_ver=2 options:erspan_dir=1 options:erspan_hwid=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:792: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:792"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:792: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:792"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:792: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:792"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'



iptables -I INPUT 1 -i br-underlay -j ACCEPT
on_exit 'iptables -D INPUT 1'

ip netns exec at_ns0 tcpdump -n -x -i p0 dst host 172.31.1.1 -l > p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:804: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:804"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff00000003080045000052373d4000402fa89cac1f0101ac1f0164100088be00000006200000016f54b41700008078fffffffffffff2ff0000000408060001080006040001f2ff000000040a0101010000000000000a010164 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0030:  0000 0001 0806 0001 0800 0604 0002 f2ff" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:811" "until cat p0.pcap | egrep \"0x0030:  0000 0001 0806 0001 0800 0604 0002 f2ff\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0040:  0000 0001 0a01 0164 f2ff 0000 0004 0a01" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:812" "until cat p0.pcap | egrep \"0x0040:  0000 0001 0a01 0164 f2ff 0000 0004 0a01\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0050:  0101" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:813" "until cat p0.pcap | egrep \"0x0050:  0101\" 2>&1 1>/dev/null"


$as_echo "system-traffic.at:817" >"$at_check_line_file"
(cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 126" 2>&1 1>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-traffic.at:817"

ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000308004500009287e14000402f57b8ac1f0101ac1f0164100088be0000000520000001144cd5a400008078f2ff00000001f2ff0000000408004500005c38d640004001eb640a0101010a01016408005e57585f0001df6c6b5b0000000045bc050000000000101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 126" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:821" "until cat p0.pcap | egrep \"IP 172.31.1.100 > 172.31.1.1: GREv0,.* length 126\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:823: check_logs "
at_fn_check_prepare_trace "system-traffic.at:823"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:823: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:823"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:823: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:823"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:823" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:823: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:823"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:823: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:823"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:823" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:823: :; "
at_fn_check_prepare_trace "system-traffic.at:823"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_22
#AT_START_23
at_fn_group_banner 23 'system-traffic.at:826' \
  "datapath - ping over ip6erspan v1 tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "23. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:827" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:827"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:829: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:829"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:829: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:829"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:829: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:829"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:829: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:829"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:829: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:829"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:829: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:829"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:829: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:829"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:829: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:829"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:830: ovs-vsctl -- set bridge br0 other-config:hwaddr=\\\"f2:ff:00:00:00:01\\\""
at_fn_check_prepare_trace "system-traffic.at:830"
( $at_check_trace; ovs-vsctl -- set bridge br0 other-config:hwaddr=\"f2:ff:00:00:00:01\"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:830"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"f2:ff:00:00:00:02\"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:833: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:833"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:833"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:834: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:834"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:834"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:836: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:836"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:836"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:839"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:839"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:839"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:839"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00:100::1/96\" dev p0 nodad
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:839"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00:100::1/96" dev p0 nodad
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:839"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "f2:ff:00:00:00:03"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:839"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:839: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:839"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:840: ip addr add dev br-underlay \"fc00:100::100/96\" nodad"
at_fn_check_prepare_trace "system-traffic.at:840"
( $at_check_trace; ip addr add dev br-underlay "fc00:100::100/96" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:841: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:841"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:841"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:845: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=123 options:erspan_ver=1 options:erspan_idx=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:845"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=123 options:erspan_ver=1 options:erspan_idx=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:845: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:845"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:845: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:845"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:845: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:845"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:845: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:845"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 2 fc00:100::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:848" "until ip netns exec at_ns0 ping6 -c 2 fc00:100::100"


ip6tables -I INPUT 1 -i br-underlay -j ACCEPT
on_exit 'ip6tables -D INPUT 1'

ip netns exec at_ns0 tcpdump -n -x -i p0 dst host fc00:100::1 -l > p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:860: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:860"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:860"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000386dd60008531003a2f40fc000100000000000000000000000001fc000100000000000000000000000100100088be000000051000007b00000007fffffffffffff2ff0000000408060001080006040001f2ff000000040a0101010000000000000a010164 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0040:  0000 0001 0806 0001 0800 0604 0002 f2ff" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:868" "until cat p0.pcap | egrep \"0x0040:  0000 0001 0806 0001 0800 0604 0002 f2ff\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0050:  0000 0001 0a01 0164 f2ff 0000 0004 0a01" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:869" "until cat p0.pcap | egrep \"0x0050:  0000 0001 0a01 0164 f2ff 0000 0004 0a01\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0060:  0101" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:870" "until cat p0.pcap | egrep \"0x0060:  0101\" 2>&1 1>/dev/null"


$as_echo "system-traffic.at:872" >"$at_check_line_file"
(cat p0.pcap | egrep "IP6 fc00:100::100 > fc00:100::1: GREv0,.* length 114" 2>&1 1>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-traffic.at:872"

ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000386dd60008531007a3c40fc000100000000000000000000000001fc0001000000000000000000000001002f00040104010100100088be000000061000407b00000007f2ff00000001f2ff0000000408004500005429b640004001fa8c0a0101010a01016408005c2c7526000118d3685b00000000e4aa020000000000101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP6 fc00:100::100 > fc00:100::1: GREv0,.* length 114" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:876" "until cat p0.pcap | egrep \"IP6 fc00:100::100 > fc00:100::1: GREv0,.* length 114\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:878: check_logs "
at_fn_check_prepare_trace "system-traffic.at:878"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:878: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:878"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:878: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:878"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:878" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:878: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:878"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:878: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:878"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:878" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:878: :; "
at_fn_check_prepare_trace "system-traffic.at:878"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_23
#AT_START_24
at_fn_group_banner 24 'system-traffic.at:881' \
  "datapath - ping over ip6erspan v2 tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "24. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:882" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:882"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:884: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:884"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:884: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:884"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:884: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:884"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:884: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:884"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:884: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:884"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:884: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:884"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:884: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:884"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:884: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:884"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:884"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:885: ovs-vsctl -- set bridge br0 other-config:hwaddr=\\\"f2:ff:00:00:00:01\\\""
at_fn_check_prepare_trace "system-traffic.at:885"
( $at_check_trace; ovs-vsctl -- set bridge br0 other-config:hwaddr=\"f2:ff:00:00:00:01\"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:885"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"f2:ff:00:00:00:02\"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:888: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:888"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:889: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:889"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:889"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:891: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:891"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:891"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:894"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:894"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:894"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:894"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00:100::1/96\" dev p0 nodad
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:894"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00:100::1/96" dev p0 nodad
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:894"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "f2:ff:00:00:00:03"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:894"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address f2:ff:00:00:00:03
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:894: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:894"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:895: ip addr add dev br-underlay \"fc00:100::100/96\" nodad"
at_fn_check_prepare_trace "system-traffic.at:895"
( $at_check_trace; ip addr add dev br-underlay "fc00:100::100/96" nodad
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:896: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:896"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:896"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:900: ovs-vsctl add-port br0 at_erspan0 -- \\
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=121 options:erspan_ver=2 options:erspan_dir=0 options:erspan_hwid=0x7"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:900"
( $at_check_trace; ovs-vsctl add-port br0 at_erspan0 -- \
              set int at_erspan0 type=ip6erspan options:remote_ip=fc00:100::1 options:key=121 options:erspan_ver=2 options:erspan_dir=0 options:erspan_hwid=0x7
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:900: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:900"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:900: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:900"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:900: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:900"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


    { set +x
$as_echo "$at_srcdir/system-traffic.at:900: ip link set dev br0 mtu 1430"
at_fn_check_prepare_trace "system-traffic.at:900"
( $at_check_trace; ip link set dev br0 mtu 1430
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 2 fc00:100::100
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:903" "until ip netns exec at_ns0 ping6 -c 2 fc00:100::100"


ip6tables -I INPUT 1 -i br-underlay -j ACCEPT
on_exit 'ip6tables -D INPUT 1'

ip netns exec at_ns0 tcpdump -n -x -i p0 dst host fc00:100::1 -l > p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:915: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:915"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00:100::100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:915"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000386dd60008531003e2f40fc000100000000000000000000000001fc000100000000000000000000000100100088be0000000620000079af514f9900008070fffffffffffff2ff0000000408060001080006040001f2ff000000040a0101010000000000000a010164 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0040:  0004 f2ff 0000 0001 0806 0001 0800 0604" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:922" "until cat p0.pcap | egrep \"0x0040:  0004 f2ff 0000 0001 0806 0001 0800 0604\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0050:  0002 f2ff 0000 0001 0a01 0164 f2ff 0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:923" "until cat p0.pcap | egrep \"0x0050:  0002 f2ff 0000 0001 0a01 0164 f2ff 0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p0.pcap | egrep "0x0060:  0004 0a01 0101" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:924" "until cat p0.pcap | egrep \"0x0060:  0004 0a01 0101\" 2>&1 1>/dev/null"


$as_echo "system-traffic.at:926" >"$at_check_line_file"
(cat p0.pcap | egrep "IP6 fc00:100::100 > fc00:100::1: GREv0, .* length 118" 2>&1 1>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-traffic.at:926"

ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=f2ff00000002f2ff0000000386dd60008531007e3c40fc000100000000000000000000000001fc0001000000000000000000000001002f00040104010100100088be0000000720004079af514f9b00008070f2ff00000001f2ff00000004080045000054ffcb4000400124770a0101010a0101640800419e23ac000112d7685b000000004caf0c0000000000101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637 actions=normal"

ovs_wait_cond () {
    cat p0.pcap | egrep "IP6 fc00:100::100 > fc00:100::1: GREv0, .* length 118" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:930" "until cat p0.pcap | egrep \"IP6 fc00:100::100 > fc00:100::1: GREv0, .* length 118\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:932: check_logs "
at_fn_check_prepare_trace "system-traffic.at:932"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:932: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:932"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:932: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:932"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:932" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:932: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:932"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:932: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:932"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:932" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:932: :; "
at_fn_check_prepare_trace "system-traffic.at:932"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_24
#AT_START_25
at_fn_group_banner 25 'system-traffic.at:935' \
  "datapath - clone action" "                        " 1
at_xfail=no
(
  $as_echo "25. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:936: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:936"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:936: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:936"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:936: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:936"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:936: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:936"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:936: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:936"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:936: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:936"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:936: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:936"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:936: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:936"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:938: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:938"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:938"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:938: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:938"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:938"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:938: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:938"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:938"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:940"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:940"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:940"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:940"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:940"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:940"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:940"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:940: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:940"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:941"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:941"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:941"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:941"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:941"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:941"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:941"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:941: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:941"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:943: ovs-vsctl -- set interface ovs-p0 ofport_request=1 \\
                    -- set interface ovs-p1 ofport_request=2"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:943"
( $at_check_trace; ovs-vsctl -- set interface ovs-p0 ofport_request=1 \
                    -- set interface ovs-p1 ofport_request=2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:943"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


cat >flows.txt <<'_ATEOF'
priority=1 actions=NORMAL
priority=10 in_port=1,ip,actions=clone(mod_dl_dst(50:54:00:00:00:0a),set_field:192.168.3.3->ip_dst), output:2
priority=10 in_port=2,ip,actions=clone(mod_dl_src(ae:c6:7e:54:8d:4d),mod_dl_dst(50:54:00:00:00:0b),set_field:192.168.4.4->ip_dst, controller), output:1
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:951: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:951"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:953: ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:953"
( $at_check_trace; ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:954: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:954"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:954"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:958: test -e \$OVS_RUNDIR/ovs-ofctl.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-ofctl.pid" "system-traffic.at:958"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-ofctl.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-ofctl.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:958: ovs-appctl -t ovs-ofctl exit"
at_fn_check_prepare_trace "system-traffic.at:958"
( $at_check_trace; ovs-appctl -t ovs-ofctl exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:958" "while kill -0 \$TMPPID 2>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:960: cat ofctl_monitor.log | grep \"csum:\" | sed 's/csum:.*/csum: <skip>/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:960"
( $at_check_trace; cat ofctl_monitor.log | grep "csum:" | sed 's/csum:.*/csum: <skip>/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,vlan_tci=0x0000,dl_src=ae:c6:7e:54:8d:4d,dl_dst=50:54:00:00:00:0b,nw_src=10.1.1.2,nw_dst=192.168.4.4,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=0,icmp_code=0 icmp_csum: <skip>
icmp,vlan_tci=0x0000,dl_src=ae:c6:7e:54:8d:4d,dl_dst=50:54:00:00:00:0b,nw_src=10.1.1.2,nw_dst=192.168.4.4,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=0,icmp_code=0 icmp_csum: <skip>
icmp,vlan_tci=0x0000,dl_src=ae:c6:7e:54:8d:4d,dl_dst=50:54:00:00:00:0b,nw_src=10.1.1.2,nw_dst=192.168.4.4,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=0,icmp_code=0 icmp_csum: <skip>
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:960"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:966: check_logs "
at_fn_check_prepare_trace "system-traffic.at:966"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:966: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:966"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:966: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:966"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:966" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:966: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:966"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:966: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:966"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:966" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:966: :; "
at_fn_check_prepare_trace "system-traffic.at:966"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_25
#AT_START_26
at_fn_group_banner 26 'system-traffic.at:969' \
  "datapath - mpls actions" "                        " 1
at_xfail=no
(
  $as_echo "26. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:970: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:970"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:970: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:970"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:970: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:970"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:970: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:970"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:970: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:970"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:970: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:970"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:970: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:970"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:970: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  "
at_fn_check_prepare_trace "system-traffic.at:970"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:972: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:972"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:972"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:972: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:972"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:972"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:974"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:974"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:974"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:974"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:974"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:974"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:974"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:974: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:974"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:974"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:975"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:975"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:975"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ovs-vsctl add-port br1 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:975"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:975"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:975"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:975"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:975: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:975"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:977: ip link add patch0 type veth peer name patch1"
at_fn_check_prepare_trace "system-traffic.at:977"
( $at_check_trace; ip link add patch0 type veth peer name patch1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:977"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del patch0'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:980: ip link set dev patch0 up"
at_fn_check_prepare_trace "system-traffic.at:980"
( $at_check_trace; ip link set dev patch0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:981: ip link set dev patch1 up"
at_fn_check_prepare_trace "system-traffic.at:981"
( $at_check_trace; ip link set dev patch1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:982: ovs-vsctl add-port br0 patch0"
at_fn_check_prepare_trace "system-traffic.at:982"
( $at_check_trace; ovs-vsctl add-port br0 patch0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:983: ovs-vsctl add-port br1 patch1"
at_fn_check_prepare_trace "system-traffic.at:983"
( $at_check_trace; ovs-vsctl add-port br1 patch1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


cat >flows.txt <<'_ATEOF'
table=0,priority=100,dl_type=0x0800 actions=push_mpls:0x8847,set_mpls_label:3,resubmit(,1)
table=0,priority=100,dl_type=0x8847,mpls_label=3 actions=pop_mpls:0x0800,resubmit(,1)
table=0,priority=10 actions=resubmit(,1)
table=1,priority=10 actions=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:992: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:992"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:993: ovs-ofctl add-flows br1 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:993"
( $at_check_trace; ovs-ofctl add-flows br1 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:993"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:995: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:995"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:999: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:999"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1003: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1003"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1003: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1003"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1003: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1003"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1003" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1003: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1003"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1003: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1003"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1003" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1003: :; "
at_fn_check_prepare_trace "system-traffic.at:1003"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1003"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_26
#AT_START_27
at_fn_group_banner 27 'system-traffic.at:1006' \
  "datapath - multiple mpls label pop" "             " 1
at_xfail=no
(
  $as_echo "27. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1007: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1007"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1007"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1007"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1007"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1007"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1007"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1007"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1007: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  "
at_fn_check_prepare_trace "system-traffic.at:1007"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1007"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1009: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1009"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1009"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1009: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1009"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1009"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1011"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1011"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1011"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1011"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1011"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1011"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1011"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1011: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1011"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1012"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1012"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1012"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ovs-vsctl add-port br1 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1012"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1012"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1012"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1012"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1012: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1012"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1014: ip link add patch0 type veth peer name patch1"
at_fn_check_prepare_trace "system-traffic.at:1014"
( $at_check_trace; ip link add patch0 type veth peer name patch1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1014"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del patch0'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1017: ip link set dev patch0 up"
at_fn_check_prepare_trace "system-traffic.at:1017"
( $at_check_trace; ip link set dev patch0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1017"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1018: ip link set dev patch1 up"
at_fn_check_prepare_trace "system-traffic.at:1018"
( $at_check_trace; ip link set dev patch1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1019: ovs-vsctl add-port br0 patch0"
at_fn_check_prepare_trace "system-traffic.at:1019"
( $at_check_trace; ovs-vsctl add-port br0 patch0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1020: ovs-vsctl add-port br1 patch1"
at_fn_check_prepare_trace "system-traffic.at:1020"
( $at_check_trace; ovs-vsctl add-port br1 patch1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1020"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


cat >flows.txt <<'_ATEOF'
table=0,priority=100,dl_type=0x0800 actions=push_mpls:0x8847,set_mpls_label:3,push_mpls:0x8847,set_mpls_label:2,push_mpls:0x8847,set_mpls_label:1,resubmit(,3)
table=0,priority=100,dl_type=0x8847,mpls_label=1 actions=pop_mpls:0x8847,resubmit(,1)
table=1,priority=100,dl_type=0x8847,mpls_label=2 actions=pop_mpls:0x8847,resubmit(,2)
table=2,priority=100,dl_type=0x8847,mpls_label=3 actions=pop_mpls:0x0800,resubmit(,3)
table=0,priority=10 actions=resubmit(,3)
table=3,priority=10 actions=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1031: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1031"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1031"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1032: ovs-ofctl add-flows br1 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1032"
( $at_check_trace; ovs-ofctl add-flows br1 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1032"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1034: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1034"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1034"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1038: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1038"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1041: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1041"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1041: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1041"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1041: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1041"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1041" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1041: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1041"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1041: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1041"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1041" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1041: :; "
at_fn_check_prepare_trace "system-traffic.at:1041"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_27
#AT_START_28
at_fn_group_banner 28 'system-traffic.at:1044' \
  "datapath - basic truncate action" "               " 1
at_xfail=no
(
  $as_echo "28. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:1045" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1045"
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1046: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1046"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1046"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1046"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1046"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1046"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1046"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1046"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1046: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1046"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1046"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1047: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1047"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1050: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1050"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1050"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1051"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1051"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1051"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1051"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1051"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1051"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1051"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1051: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1051"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1052: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1052"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1052"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1053: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1053"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1056: ip link add p1 type veth peer name ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:1056"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p1'
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1058: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1058"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1058"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1059: ip link set dev p1 up"
at_fn_check_prepare_trace "system-traffic.at:1059"
( $at_check_trace; ip link set dev p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1059"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1060: ovs-vsctl add-port br0 ovs-p1 -- set interface ovs-p1 ofport_request=2"
at_fn_check_prepare_trace "system-traffic.at:1060"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- set interface ovs-p1 ofport_request=2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1062: ovs-vsctl add-port br0 p1 -- set interface p1 ofport_request=3"
at_fn_check_prepare_trace "system-traffic.at:1062"
( $at_check_trace; ovs-vsctl add-port br0 p1 -- set interface p1 ofport_request=3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1062"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1065: ip link add p2 type veth peer name ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:1065"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1065"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1067: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1067"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1068: ip link set dev p2 up"
at_fn_check_prepare_trace "system-traffic.at:1068"
( $at_check_trace; ip link set dev p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1069: ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=4"
at_fn_check_prepare_trace "system-traffic.at:1069"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1071: ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=5"
at_fn_check_prepare_trace "system-traffic.at:1071"
( $at_check_trace; ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=5
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1071"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1074: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1074"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows.txt <<'_ATEOF'
in_port=3 dl_dst=e6:66:c1:22:22:22 actions=drop
in_port=5 dl_dst=e6:66:c1:22:22:22 actions=drop
in_port=1 dl_dst=e6:66:c1:22:22:22 actions=output(port=2,max_len=100),output:4
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1080: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1080"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1080"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1083: dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null"
at_fn_check_prepare_trace "system-traffic.at:1083"
( $at_check_trace; dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1083"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'rm -f payload200.bin'
 { set +x
$as_echo "$at_srcdir/system-traffic.at:1085: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1085"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1085"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1088: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1088"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1088"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1089: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=3\" |  sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1089"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=3" |  sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=100
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1093: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1093"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1094: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=5\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1094"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=5" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=242
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1094"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1099: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1099"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1099"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows.txt <<'_ATEOF'
in_port=3 dl_dst=e6:66:c1:22:22:22 actions=drop
in_port=5 dl_dst=e6:66:c1:22:22:22 actions=drop
in_port=1 dl_dst=e6:66:c1:22:22:22 actions=output(port=2,max_len=100),output:4,output(port=2,max_len=100),output(port=4,max_len=100),output:2,output(port=4,max_len=200),output(port=2,max_len=65535)
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1105: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1105"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1107: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1107"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1110: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1110"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1110"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1111: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=3\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1111"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=3" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=684
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1115: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=5\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1115"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=5" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=542
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1121: ovs-appctl dpif/set-dp-features br0 trunc false"
at_fn_check_prepare_trace "system-traffic.at:1121"
( $at_check_trace; ovs-appctl dpif/set-dp-features br0 trunc false
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1124: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1124"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1125: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1125"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1125"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1127: ovs-appctl ofproto/trace br0 \"in_port=1,dl_type=0x800,dl_src=e6:66:c1:11:11:11,dl_dst=e6:66:c1:22:22:22,nw_src=192.168.0.1,nw_dst=192.168.0.2,nw_proto=6,tp_src=8,tp_dst=9\""
at_fn_check_prepare_trace "system-traffic.at:1127"
( $at_check_trace; ovs-appctl ofproto/trace br0 "in_port=1,dl_type=0x800,dl_src=e6:66:c1:11:11:11,dl_dst=e6:66:c1:22:22:22,nw_src=192.168.0.1,nw_dst=192.168.0.2,nw_proto=6,tp_src=8,tp_dst=9"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1127"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1128: tail -3 stdout"
at_fn_check_prepare_trace "system-traffic.at:1128"
( $at_check_trace; tail -3 stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Datapath actions: trunc(100),3,5,trunc(100),3,trunc(100),5,3,trunc(200),5,trunc(65535),3
This flow is handled by the userspace slow path because it:
  - Uses action(s) not supported by datapath.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1128"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1135: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1135"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1136: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1136"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:1137: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1137"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.2 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1140: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1140"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1141: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=3\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1141"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=3" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=684
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1141"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1146: ovs-ofctl dump-flows br0 table=0 | grep \"in_port=5\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1146"
( $at_check_trace; ovs-ofctl dump-flows br0 table=0 | grep "in_port=5" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=542
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1150: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1150"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1150: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1150"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1150: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1150"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1150" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1150: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1150"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1150: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1150"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1150" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1150: :; "
at_fn_check_prepare_trace "system-traffic.at:1150"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_28
#AT_START_29
at_fn_group_banner 29 'system-traffic.at:1159' \
  "datapath - truncate and output to gre tunnel by simulated packets" "" 1
at_xfail=no
(
  $as_echo "29. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:1160" >"$at_check_line_file"
(test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 )) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1160"

$as_echo "system-traffic.at:1161" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1161"
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1162: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1162"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1162"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1162"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1162"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1162"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1162"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1162"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1162: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1162"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set bridge br-underlay other-config:hwaddr=\"02:90:8c:a8:a1:49\"
ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1165: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1165"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1165"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0



ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1166: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1166"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1166"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1167: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:1167"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1168: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:1168"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1168"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1171"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1171"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1171"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1171"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n "fa:ad:fa:25:05:60"; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address fa:ad:fa:25:05:60
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address fa:ad:fa:25:05:60
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1171: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1171"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1172: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:1172"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1172"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1173: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:1173"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1173"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1177: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1177"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=gre options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1177: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:1177"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1177: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:1177"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1177: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:1177"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1187"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1187"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1187"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1187"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add '10.1.1.2/24' dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1187"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add '10.1.1.2/24' dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1187"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1187"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1187: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1187"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1188: ovs-vsctl -- set interface ovs-p1 ofport_request=2"
at_fn_check_prepare_trace "system-traffic.at:1188"
( $at_check_trace; ovs-vsctl -- set interface ovs-p1 ofport_request=2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1188"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:1189: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1189"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1190: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1190"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1193: ip link add p2 type veth peer name ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:1193"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1193"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1195: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1195"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1196: ip link set dev p2 up"
at_fn_check_prepare_trace "system-traffic.at:1196"
( $at_check_trace; ip link set dev p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1197: ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=3"
at_fn_check_prepare_trace "system-traffic.at:1197"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1198: ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=4"
at_fn_check_prepare_trace "system-traffic.at:1198"
( $at_check_trace; ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1198"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1201: dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null"
at_fn_check_prepare_trace "system-traffic.at:1201"
( $at_check_trace; dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'rm -f payload200.bin'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1204: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1204"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1204"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows.txt <<'_ATEOF'
priority=99,in_port=1,actions=output(port=2,max_len=100),output(port=3,max_len=100)
priority=99,in_port=2,udp,actions=output(port=1,max_len=100)
priority=1,in_port=4,ip,actions=drop
priority=1,actions=drop
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1211: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1211"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1211"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1213: ovs-ofctl del-flows br-underlay"
at_fn_check_prepare_trace "system-traffic.at:1213"
( $at_check_trace; ovs-ofctl del-flows br-underlay
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1213"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows-underlay.txt <<'_ATEOF'
priority=99,dl_type=0x0800,nw_proto=47,in_port=1,actions=LOCAL
priority=99,dl_type=0x0800,nw_proto=47,in_port=LOCAL,ip_dst=172.31.1.1/24,actions=1
priority=1,actions=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1220: ovs-ofctl add-flows br-underlay flows-underlay.txt"
at_fn_check_prepare_trace "system-traffic.at:1220"
( $at_check_trace; ovs-ofctl add-flows br-underlay flows-underlay.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1223: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1223"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1224: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1224"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1227: ovs-ofctl dump-flows br0 | grep \"in_port=2\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1227"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=2" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=242
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1227"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1231: ovs-ofctl dump-flows br-underlay | grep \"in_port=LOCAL\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1231"
( $at_check_trace; ovs-ofctl dump-flows br-underlay | grep "in_port=LOCAL" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=138
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1231"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=02908ca8a149faadfa25056008004500010a9e9d4000402f4084ac1f0101ac1f016400006558e666c1222222e666c11111110800450000e46f8e40004011b4760a0101010a010102e026162e00d016e6a366ebf904c74132c6fed42a9e9e46240b4d9fd13c9b47d9704a388e70a5e77db16934a6188dc01d86aa20007ace2cf9cdb111f208474b88ffc851c871f0e3fb4fff138c1d288d437efff487e2b86a9c99fbf4229a6485e133bcf3e16f6e345207fda0932d9eeb602740456fd077b4847d25481337bd716155cc245be129ccc11bf82b834767b3760b52fe913c0e24f31c0e1b27f88acf7bba6b985fb64ee2cd6fc6bba1a9c1f021e253e1728b046fd4d023307e3296361a37ea2617ebcb2537e0284a81050dd0ee actions=LOCAL"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1240: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1240"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1240"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1241: ovs-ofctl dump-flows br0 | grep \"in_port=4\" | ofctl_strip"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1241"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=4" | ofctl_strip
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=100, priority=1,ip,in_port=4 actions=drop
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1247: ovs-appctl dpif/set-dp-features br0 trunc false"
at_fn_check_prepare_trace "system-traffic.at:1247"
( $at_check_trace; ovs-appctl dpif/set-dp-features br0 trunc false
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1247"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1250: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1250"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1251: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1251"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1251"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1254: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1254"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1255: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1255"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1256: ovs-ofctl del-flows br-underlay"
at_fn_check_prepare_trace "system-traffic.at:1256"
( $at_check_trace; ovs-ofctl del-flows br-underlay
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1257: ovs-ofctl add-flows br-underlay flows-underlay.txt"
at_fn_check_prepare_trace "system-traffic.at:1257"
( $at_check_trace; ovs-ofctl add-flows br-underlay flows-underlay.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1257"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1260: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1260"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1260"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1261: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1261"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1264: ovs-ofctl dump-flows br0 | grep \"in_port=2\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1264"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=2" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=242
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1268: ovs-ofctl dump-flows br-underlay | grep \"in_port=LOCAL\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1268"
( $at_check_trace; ovs-ofctl dump-flows br-underlay | grep "in_port=LOCAL" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=138
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-ofctl -O OpenFlow13 packet-out br-underlay "in_port=1 packet=02908ca8a149faadfa25056008004500010a9e9d4000402f4084ac1f0101ac1f016400006558e666c1222222e666c11111110800450000e46f8e40004011b4760a0101010a010102e026162e00d016e6a366ebf904c74132c6fed42a9e9e46240b4d9fd13c9b47d9704a388e70a5e77db16934a6188dc01d86aa20007ace2cf9cdb111f208474b88ffc851c871f0e3fb4fff138c1d288d437efff487e2b86a9c99fbf4229a6485e133bcf3e16f6e345207fda0932d9eeb602740456fd077b4847d25481337bd716155cc245be129ccc11bf82b834767b3760b52fe913c0e24f31c0e1b27f88acf7bba6b985fb64ee2cd6fc6bba1a9c1f021e253e1728b046fd4d023307e3296361a37ea2617ebcb2537e0284a81050dd0ee actions=LOCAL"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1277: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1277"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1277"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1278: ovs-ofctl dump-flows br0 | grep \"in_port=4\" | ofctl_strip"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1278"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=4" | ofctl_strip
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=100, priority=1,ip,in_port=4 actions=drop
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1278"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1282: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1282"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1282: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1282"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1282: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1282"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1282" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1282: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1282"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1282: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1282"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1282" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1282: :; "
at_fn_check_prepare_trace "system-traffic.at:1282"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_29
#AT_START_30
at_fn_group_banner 30 'system-traffic.at:1291' \
  "datapath - truncate and output to gre tunnel" "   " 1
at_xfail=no
(
  $as_echo "30. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:1292" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1292"

    version=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 1}')
    sublevel=$(uname -r | sed -e 's/\./ /g' | awk '{print $ 2}')
    $as_echo "system-traffic.at:1293" >"$at_check_line_file"
( ! ( test $version -lt 3 || ( test $version -eq 3 && test $sublevel -lt 10 ) || test $version -gt 4 || ( test $version -eq 4 && test $sublevel -gt 15 ) ) ) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1293"

$as_echo "system-traffic.at:1294" >"$at_check_line_file"
(! ip link add foo type gretap help 2>&1 | grep gretap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1294"
     $as_echo "system-traffic.at:1294" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1294"
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1295: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1295"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1295"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1295"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1295"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1295"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1295"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1295"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1295: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1295"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1298: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1298"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1298"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0



ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1299: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1299"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1299"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1300: ovs-ofctl add-flow br0 \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:1300"
( $at_check_trace; ovs-ofctl add-flow br0 "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1301: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:1301"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1304"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1304"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1304"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1304"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1304"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1304"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1304"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1304: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1304"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1305: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:1305"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1306: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:1306"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1306"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1310: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1310"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=gre options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1310: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:1310"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1310: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:1310"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:1310: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:1310"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1311: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gre0 type gretap remote 172.31.1.100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1311"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev ns_gre0 type gretap remote 172.31.1.100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:1311: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gre0 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1311"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev ns_gre0 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:1311: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gre0 mtu 1450 address e6:66:c1:11:11:11 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1311"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev ns_gre0 mtu 1450 address e6:66:c1:11:11:11 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




{ set +x
$as_echo "$at_srcdir/system-traffic.at:1313: ovs-vsctl -- set interface at_gre0 ofport_request=1"
at_fn_check_prepare_trace "system-traffic.at:1313"
( $at_check_trace; ovs-vsctl -- set interface at_gre0 ofport_request=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1313"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:1314: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1314"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1314"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1317"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1317"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1317"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1317"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add '10.1.1.2/24' dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1317"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add '10.1.1.2/24' dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1317"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1317"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1317: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1317"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1318: ovs-vsctl -- set interface ovs-p1 ofport_request=2"
at_fn_check_prepare_trace "system-traffic.at:1318"
( $at_check_trace; ovs-vsctl -- set interface ovs-p1 ofport_request=2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1318"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:1319: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1319"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1320: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1320"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1320"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1323: ip link add p2 type veth peer name ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:1323"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1323"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1325: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1325"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1325"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1326: ip link set dev p2 up"
at_fn_check_prepare_trace "system-traffic.at:1326"
( $at_check_trace; ip link set dev p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1326"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1327: ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=3"
at_fn_check_prepare_trace "system-traffic.at:1327"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- set interface ovs-p2 ofport_request=3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1327"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1328: ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=4"
at_fn_check_prepare_trace "system-traffic.at:1328"
( $at_check_trace; ovs-vsctl add-port br0 p2 -- set interface p2 ofport_request=4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1328"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1331: dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null"
at_fn_check_prepare_trace "system-traffic.at:1331"
( $at_check_trace; dd if=/dev/urandom of=payload200.bin bs=200 count=1 2> /dev/null
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1331"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'rm -f payload200.bin'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1334: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1334"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1334"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows.txt <<'_ATEOF'
priority=99,in_port=1,actions=output(port=2,max_len=100),output(port=3,max_len=100)
priority=99,in_port=2,udp,actions=output(port=1,max_len=100)
priority=1,in_port=4,ip,actions=drop
priority=1,actions=drop
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1341: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1341"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1343: ovs-ofctl del-flows br-underlay"
at_fn_check_prepare_trace "system-traffic.at:1343"
( $at_check_trace; ovs-ofctl del-flows br-underlay
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1343"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

cat >flows-underlay.txt <<'_ATEOF'
priority=99,dl_type=0x0800,nw_proto=47,in_port=1,actions=LOCAL
priority=99,dl_type=0x0800,nw_proto=47,in_port=LOCAL,ip_dst=172.31.1.1/24,actions=1
priority=1,actions=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1350: ovs-ofctl add-flows br-underlay flows-underlay.txt"
at_fn_check_prepare_trace "system-traffic.at:1350"
( $at_check_trace; ovs-ofctl add-flows br-underlay flows-underlay.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1353: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1353"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1353"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1354: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1354"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1354"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1357: ovs-ofctl dump-flows br0 | grep \"in_port=2\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1357"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=2" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=242
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1357"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1361: ovs-ofctl dump-flows br-underlay | grep \"in_port=LOCAL\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1361"
( $at_check_trace; ovs-ofctl dump-flows br-underlay | grep "in_port=LOCAL" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=138
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1366: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.2 5678 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1366"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.2 5678 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1368: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1368"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1368"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1369: ovs-ofctl dump-flows br0 | grep \"in_port=4\" | ofctl_strip"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1369"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=4" | ofctl_strip
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=100, priority=1,ip,in_port=4 actions=drop
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1369"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1375: ovs-appctl dpif/set-dp-features br0 trunc false"
at_fn_check_prepare_trace "system-traffic.at:1375"
( $at_check_trace; ovs-appctl dpif/set-dp-features br0 trunc false
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1375"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1378: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1378"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1378"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1379: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1379"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1379"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1382: ovs-ofctl del-flows br0"
at_fn_check_prepare_trace "system-traffic.at:1382"
( $at_check_trace; ovs-ofctl del-flows br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1383: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1383"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1383"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1384: ovs-ofctl del-flows br-underlay"
at_fn_check_prepare_trace "system-traffic.at:1384"
( $at_check_trace; ovs-ofctl del-flows br-underlay
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1384"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1385: ovs-ofctl add-flows br-underlay flows-underlay.txt"
at_fn_check_prepare_trace "system-traffic.at:1385"
( $at_check_trace; ovs-ofctl add-flows br-underlay flows-underlay.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1385"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1388: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1388"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.1 1234 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1389: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1389"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1389"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1392: ovs-ofctl dump-flows br0 | grep \"in_port=2\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1392"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=2" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=242
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1392"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1396: ovs-ofctl dump-flows br-underlay | grep \"in_port=LOCAL\" | sed -n 's/.*\\(n\\_bytes=[0-9]*\\).*/\\1/p'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1396"
( $at_check_trace; ovs-ofctl dump-flows br-underlay | grep "in_port=LOCAL" | sed -n 's/.*\(n\_bytes=[0-9]*\).*/\1/p'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "n_bytes=138
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1401: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc \$NC_EOF_OPT -u 10.1.1.2 5678 < payload200.bin
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1401"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
nc $NC_EOF_OPT -u 10.1.1.2 5678 < payload200.bin
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1401"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1403: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1403"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1403"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1404: ovs-ofctl dump-flows br0 | grep \"in_port=4\" | ofctl_strip"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1404"
( $at_check_trace; ovs-ofctl dump-flows br0 | grep "in_port=4" | ofctl_strip
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=100, priority=1,ip,in_port=4 actions=drop
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1404"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1408: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1408"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1408: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1408"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1408: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1408"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1408" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1408: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1408"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1408: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1408"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1408" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1408: :; "
at_fn_check_prepare_trace "system-traffic.at:1408"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_30
#AT_START_31
at_fn_group_banner 31 'system-traffic.at:1413' \
  "conntrack - controller" "                         " 2
at_xfail=no
(
  $as_echo "31. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1415: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1415"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1415"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1415"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1415"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1415"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1415"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1415"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1415: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1415"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1415"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1416: ovs-appctl vlog/set dpif:dbg dpif_netdev:dbg ofproto_dpif_upcall:dbg"
at_fn_check_prepare_trace "system-traffic.at:1416"
( $at_check_trace; ovs-appctl vlog/set dpif:dbg dpif_netdev:dbg ofproto_dpif_upcall:dbg
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1418: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1418"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1418: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1418"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1420"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1420"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1420"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1420"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1420"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1420"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1420"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1420: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1420"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1421"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1421"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1421"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1421"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1421"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1421"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1421"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1421: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1421"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,udp,action=ct(commit),controller
priority=100,in_port=2,ct_state=-trk,udp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk+est,udp,action=controller
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1432: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1432"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1432"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1435: ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:1435"
( $at_check_trace; ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1438: ovs-ofctl -O OpenFlow13 packet-out br0 2 ct\\(table=0\\) '50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000'"
at_fn_check_prepare_trace "system-traffic.at:1438"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 ct\(table=0\) '50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1438"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1441: ovs-ofctl -O OpenFlow13 packet-out br0 1 ct\\(commit\\),controller '50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000'"
at_fn_check_prepare_trace "system-traffic.at:1441"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 1 ct\(commit\),controller '50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1444: ovs-ofctl -O OpenFlow13 packet-out br0 2 ct\\(table=0\\) '50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000'"
at_fn_check_prepare_trace "system-traffic.at:1444"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 ct\(table=0\) '50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1446: test -e \$OVS_RUNDIR/ovs-ofctl.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-ofctl.pid" "system-traffic.at:1446"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-ofctl.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1446"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-ofctl.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1446: ovs-appctl -t ovs-ofctl exit"
at_fn_check_prepare_trace "system-traffic.at:1446"
( $at_check_trace; ovs-appctl -t ovs-ofctl exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1446"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1446" "while kill -0 \$TMPPID 2>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1449: cat ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:1449"
( $at_check_trace; cat ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "NXT_PACKET_IN2 (xid=0x0): total_len=42 in_port=1 (via action) data_len=42 (unbuffered)
udp,vlan_tci=0x0000,dl_src=50:54:00:00:00:09,dl_dst=50:54:00:00:00:0a,nw_src=10.1.1.1,nw_dst=10.1.1.2,nw_tos=0,nw_ecn=0,nw_ttl=0,tp_src=1,tp_dst=2 udp_csum:0
NXT_PACKET_IN2 (xid=0x0): cookie=0x0 total_len=42 ct_state=est|rpl|trk,ct_nw_src=10.1.1.1,ct_nw_dst=10.1.1.2,ct_nw_proto=17,ct_tp_src=1,ct_tp_dst=2,ip,in_port=2 (via action) data_len=42 (unbuffered)
udp,vlan_tci=0x0000,dl_src=50:54:00:00:00:09,dl_dst=50:54:00:00:00:0a,nw_src=10.1.1.2,nw_dst=10.1.1.1,nw_tos=0,nw_ecn=0,nw_ttl=0,tp_src=2,tp_dst=1 udp_csum:0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1449"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1456: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1456"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1456: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1456"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1456: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1456"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1456" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1456: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1456"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1456: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1456"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1456" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1456: :; "
at_fn_check_prepare_trace "system-traffic.at:1456"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_31
#AT_START_32
at_fn_group_banner 32 'system-traffic.at:1459' \
  "conntrack - force commit" "                       " 2
at_xfail=no
(
  $as_echo "32. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1461: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1461"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1461"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1461"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1461"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1461"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1461"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1461"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1461: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1461"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1461"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1462: ovs-appctl vlog/set dpif:dbg dpif_netdev:dbg ofproto_dpif_upcall:dbg"
at_fn_check_prepare_trace "system-traffic.at:1462"
( $at_check_trace; ovs-appctl vlog/set dpif:dbg dpif_netdev:dbg ofproto_dpif_upcall:dbg
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1464: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1464"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1464"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1464: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1464"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1464"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1466"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1466"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1466"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1466"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1466"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1466"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1466"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1466: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1466"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1467"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1467"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1467"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1467"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1467"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1467"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1467"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1467: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1467"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,udp,action=ct(force,commit),controller
priority=100,in_port=2,ct_state=-trk,udp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk+est,udp,action=ct(force,commit,table=1)
table=1,in_port=2,ct_state=+trk,udp,action=controller
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1478: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1478"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1481: ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:1481"
( $at_check_trace; ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1481"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1484: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1484"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1484"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1487: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1487"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1487"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1490: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1490"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1492: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1492"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1492"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1494: test -e \$OVS_RUNDIR/ovs-ofctl.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-ofctl.pid" "system-traffic.at:1494"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-ofctl.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-ofctl.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1494: ovs-appctl -t ovs-ofctl exit"
at_fn_check_prepare_trace "system-traffic.at:1494"
( $at_check_trace; ovs-appctl -t ovs-ofctl exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1494" "while kill -0 \$TMPPID 2>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1497: cat ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:1497"
( $at_check_trace; cat ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "NXT_PACKET_IN2 (xid=0x0): cookie=0x0 total_len=42 in_port=1 (via action) data_len=42 (unbuffered)
udp,vlan_tci=0x0000,dl_src=50:54:00:00:00:09,dl_dst=50:54:00:00:00:0a,nw_src=10.1.1.1,nw_dst=10.1.1.2,nw_tos=0,nw_ecn=0,nw_ttl=0,tp_src=1,tp_dst=2 udp_csum:0
NXT_PACKET_IN2 (xid=0x0): table_id=1 cookie=0x0 total_len=42 ct_state=new|trk,ct_nw_src=10.1.1.2,ct_nw_dst=10.1.1.1,ct_nw_proto=17,ct_tp_src=2,ct_tp_dst=1,ip,in_port=2 (via action) data_len=42 (unbuffered)
udp,vlan_tci=0x0000,dl_src=50:54:00:00:00:09,dl_dst=50:54:00:00:00:0a,nw_src=10.1.1.2,nw_dst=10.1.1.1,nw_tos=0,nw_ecn=0,nw_ttl=0,tp_src=2,tp_dst=1 udp_csum:0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1507: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.2,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1507"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.2,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=2,dport=1),reply=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=2)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1507"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1512: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1512"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1512"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1513: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:1513"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1513"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1515: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.1,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1515"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.1,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=2),reply=(src=10.1.1.2,dst=10.1.1.1,sport=2,dport=1)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1515"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1519: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1519"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1519: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1519"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1519: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1519"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1519" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1519: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1519"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1519: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1519"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1519" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1519: :; "
at_fn_check_prepare_trace "system-traffic.at:1519"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_32
#AT_START_33
at_fn_group_banner 33 'system-traffic.at:1522' \
  "conntrack - ct flush by 5-tuple" "                " 2
at_xfail=no
(
  $as_echo "33. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1524: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1524"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1524"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1524"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1524"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1524"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1524"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1524"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1524: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1524"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1526: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1526"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1526: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1526"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1528"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1528"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1528"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1528"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1528"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1528"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1528"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1528: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1528"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1529"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1529"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1529"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1529"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1529"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1529"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1529"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1529: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1529"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1529"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,udp,action=ct(commit),2
priority=100,in_port=2,udp,action=ct(zone=5,commit),1
priority=100,in_port=1,icmp,action=ct(commit),2
priority=100,in_port=2,icmp,action=ct(zone=5,commit),1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1540: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1540"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1543: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1543"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1543"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1545: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.1,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1545"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.1,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=2),reply=(src=10.1.1.2,dst=10.1.1.1,sport=2,dport=1)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1545"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1549: ovs-appctl dpctl/flush-conntrack 'ct_nw_src=10.1.1.2,ct_nw_dst=10.1.1.1,ct_nw_proto=17,ct_tp_src=2,ct_tp_dst=1'"
at_fn_check_prepare_trace "system-traffic.at:1549"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack 'ct_nw_src=10.1.1.2,ct_nw_dst=10.1.1.1,ct_nw_proto=17,ct_tp_src=2,ct_tp_dst=1'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1549"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1551: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.1,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1551"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.1,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:1551"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1555: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:1555"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101020a0101010002000100080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1555"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1557: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.2,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1557"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.2,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=2,dport=1),reply=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=2),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1557"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1561: ovs-appctl dpctl/flush-conntrack zone=5 'ct_nw_src=10.1.1.1,ct_nw_dst=10.1.1.2,ct_nw_proto=17,ct_tp_src=1,ct_tp_dst=2'"
at_fn_check_prepare_trace "system-traffic.at:1561"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack zone=5 'ct_nw_src=10.1.1.1,ct_nw_dst=10.1.1.2,ct_nw_proto=17,ct_tp_src=1,ct_tp_dst=2'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1563: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1563"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1567: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1567"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1567"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1571: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.2,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1571"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.2,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1572: cat stdout | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1572"
( $at_check_trace; cat stdout | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=8,code=0),reply=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=0,code=0),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1572"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ICMP_ID=`cat stdout | cut -d ',' -f4 | cut -d '=' -f2`
ICMP_TUPLE=ct_nw_src=10.1.1.2,ct_nw_dst=10.1.1.1,ct_nw_proto=1,icmp_id=$ICMP_ID,icmp_type=8,icmp_code=0
{ set +x
$as_echo "$at_srcdir/system-traffic.at:1578: ovs-appctl dpctl/flush-conntrack zone=5 \$ICMP_TUPLE"
at_fn_check_prepare_dynamic "ovs-appctl dpctl/flush-conntrack zone=5 $ICMP_TUPLE" "system-traffic.at:1578"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack zone=5 $ICMP_TUPLE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1578"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1580: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.2,\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1580"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.2,"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:1580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1583: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1583"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1583: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1583"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1583: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1583"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1583" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1583: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1583"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1583: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1583"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1583" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1583: :; "
at_fn_check_prepare_trace "system-traffic.at:1583"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_33
#AT_START_34
at_fn_group_banner 34 'system-traffic.at:1586' \
  "conntrack - IPv4 ping" "                          " 2
at_xfail=no
(
  $as_echo "34. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1588: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1588"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1588"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1588"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1588"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1588"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1588"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1588"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1588: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1588"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1590: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1590"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1590: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1590"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1592"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1592"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1592"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1592"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1592"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1592"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1592"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1592: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1592"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1593"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1593"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1593"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1593"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1593"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1593"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1593"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1593: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1593"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1593"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit),2
priority=100,in_port=2,icmp,ct_state=-trk,action=ct(table=0)
priority=100,in_port=2,icmp,ct_state=+trk+est,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1604: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1604"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1604"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1607: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1607"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1611: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1611"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1611"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1615: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:1615"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1618: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1618"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.1 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "7 packets transmitted, 0 received, 100% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1618"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1622: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1622"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1622: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1622"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1622: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1622"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1622" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1622: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1622"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1622: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1622"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1622" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1622: :; "
at_fn_check_prepare_trace "system-traffic.at:1622"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1622"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_34
#AT_START_35
at_fn_group_banner 35 'system-traffic.at:1625' \
  "conntrack - get_nconns and get/set_maxconns" "    " 2
at_xfail=no
(
  $as_echo "35. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



    $as_echo "system-traffic.at:1627" >"$at_check_line_file"
at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1627"


    $as_echo "system-traffic.at:1628" >"$at_check_line_file"
at_fn_check_skip 77 "$at_srcdir/system-traffic.at:1628"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1629: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1629"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1629"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1629"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1629"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1629"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1629"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1629"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1629: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1629"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1629"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1631: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1631"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1631: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1631"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1631"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1633"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1633"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1633"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1633"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1633"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1633"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1633"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1633: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1633"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1633"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1634"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1634"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1634"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1634"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1634"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1634"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1634"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1634: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1634"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit),2
priority=100,in_port=2,icmp,ct_state=-trk,action=ct(table=0)
priority=100,in_port=2,icmp,ct_state=+trk+est,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1645: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1645"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1645"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1648: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1648"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1648"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1652: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1652"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1652"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1656: ovs-appctl dpctl/ct-set-maxconns one-bad-dp"
at_fn_check_prepare_trace "system-traffic.at:1656"
( $at_check_trace; ovs-appctl dpctl/ct-set-maxconns one-bad-dp
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "ovs-vswitchd: maxconns missing or malformed (Invalid argument)
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-traffic.at:1656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1661: ovs-appctl dpctl/ct-set-maxconns a"
at_fn_check_prepare_trace "system-traffic.at:1661"
( $at_check_trace; ovs-appctl dpctl/ct-set-maxconns a
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "ovs-vswitchd: maxconns missing or malformed (Invalid argument)
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-traffic.at:1661"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1666: ovs-appctl dpctl/ct-set-maxconns one-bad-dp 10"
at_fn_check_prepare_trace "system-traffic.at:1666"
( $at_check_trace; ovs-appctl dpctl/ct-set-maxconns one-bad-dp 10
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "ovs-vswitchd: datapath not found (Invalid argument)
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-traffic.at:1666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1671: ovs-appctl dpctl/ct-get-maxconns one-bad-dp"
at_fn_check_prepare_trace "system-traffic.at:1671"
( $at_check_trace; ovs-appctl dpctl/ct-get-maxconns one-bad-dp
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "ovs-vswitchd: datapath not found (Invalid argument)
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-traffic.at:1671"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1676: ovs-appctl dpctl/ct-get-nconns one-bad-dp"
at_fn_check_prepare_trace "system-traffic.at:1676"
( $at_check_trace; ovs-appctl dpctl/ct-get-nconns one-bad-dp
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "ovs-vswitchd: datapath not found (Invalid argument)
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-traffic.at:1676"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1681: ovs-appctl dpctl/ct-get-nconns"
at_fn_check_prepare_trace "system-traffic.at:1681"
( $at_check_trace; ovs-appctl dpctl/ct-get-nconns
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1685: ovs-appctl dpctl/ct-get-maxconns"
at_fn_check_prepare_trace "system-traffic.at:1685"
( $at_check_trace; ovs-appctl dpctl/ct-get-maxconns
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3000000
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1685"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1689: ovs-appctl dpctl/ct-set-maxconns 10"
at_fn_check_prepare_trace "system-traffic.at:1689"
( $at_check_trace; ovs-appctl dpctl/ct-set-maxconns 10
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "setting maxconns successful
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1693: ovs-appctl dpctl/ct-get-maxconns"
at_fn_check_prepare_trace "system-traffic.at:1693"
( $at_check_trace; ovs-appctl dpctl/ct-get-maxconns
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "10
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1697: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:1697"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1699: ovs-appctl dpctl/ct-get-nconns"
at_fn_check_prepare_trace "system-traffic.at:1699"
( $at_check_trace; ovs-appctl dpctl/ct-get-nconns
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1699"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1703: ovs-appctl dpctl/ct-get-maxconns"
at_fn_check_prepare_trace "system-traffic.at:1703"
( $at_check_trace; ovs-appctl dpctl/ct-get-maxconns
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "10
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1703"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1707: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1707"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1707: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1707"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1707: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1707"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1707" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1707: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1707"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1707: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1707"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1707" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1707: :; "
at_fn_check_prepare_trace "system-traffic.at:1707"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_35
#AT_START_36
at_fn_group_banner 36 'system-traffic.at:1710' \
  "conntrack - IPv6 ping" "                          " 2
at_xfail=no
(
  $as_echo "36. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1712: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1712"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1712"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1712"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1712"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1712"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1712"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1712"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1712: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1712"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1714: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1714"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1714"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1714: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1714"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1714"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1716"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1716"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1716"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1716"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1716"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1716"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1716"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1716: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1716"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1717"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1717"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1717"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1717"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1717"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1717"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1717"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1717: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1717"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'

table=0,priority=10,icmp6,icmp_type=128,action=goto_table:1
table=0,priority=10,icmp6,icmp_type=129,action=goto_table:1
table=0,priority=1,action=normal

table=1,priority=100,in_port=1,icmp6,action=ct(commit),2
table=1,priority=100,in_port=2,icmp6,ct_state=-trk,action=ct(table=0)
table=1,priority=100,in_port=2,icmp6,ct_state=+trk+est,action=1
table=1,priority=1,action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1734: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1734"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1736" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1740: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:1740"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1740"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1743: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::1 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1743"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::1 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "7 packets transmitted, 0 received, 100% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1748: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1748"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1748"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1752: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1752"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmpv6,orig=(src=fc00::1,dst=fc00::2,id=<cleared>,type=128,code=0),reply=(src=fc00::2,dst=fc00::1,id=<cleared>,type=129,code=0)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1752"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1756: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1756"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1756: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1756"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1756: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1756"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1756" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1756: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1756"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1756: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1756"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1756" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1756: :; "
at_fn_check_prepare_trace "system-traffic.at:1756"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_36
#AT_START_37
at_fn_group_banner 37 'system-traffic.at:1759' \
  "conntrack - preserve registers" "                 " 2
at_xfail=no
(
  $as_echo "37. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1761: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1761"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1761"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1761"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1761"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1761"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1761"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1761"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1761: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1761"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1763: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1763"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1763: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1763"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1763: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1763"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1763: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1763"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1765"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1765"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1765"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1765"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1765"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1765"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1765"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1765: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1765"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1765"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1766"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1766"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1766"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1766"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1766"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1766"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1766"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1766: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1766"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1766"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1767"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:1767"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1767"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1767"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1767"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1767"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1767"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1767: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1767"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1767"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1768"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:1768"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:1768"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1768"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1768"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1768"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1768"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1768: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1768"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1768"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,ct_state=-trk,action=ct(commit,table=0)
priority=100,in_port=1,tcp,ct_state=+trk,action=2
priority=100,in_port=2,tcp,ct_state=-trk,action=ct(table=0)
priority=100,in_port=2,tcp,ct_state=+trk,action=1
priority=100,in_port=3,tcp,ct_state=-trk,action=load:0->NXM_NX_REG0[],ct(table=0)
priority=100,in_port=3,tcp,ct_state=+trk,reg0=0,action=load:1->NXM_NX_REG0[],ct(commit,table=0)
priority=100,in_port=3,tcp,ct_state=+trk,reg0=1,action=4
priority=100,in_port=4,tcp,ct_state=-trk,action=ct(commit,table=0)
priority=100,in_port=4,tcp,ct_state=+trk,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1786: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1786"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1788" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1789" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1792: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1792"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1795: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1795"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1795"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1797: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1797"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1797: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1797"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1797: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1797"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1797" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1797: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1797"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1797: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1797"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1797" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1797: :; "
at_fn_check_prepare_trace "system-traffic.at:1797"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_37
#AT_START_38
at_fn_group_banner 38 'system-traffic.at:1800' \
  "conntrack - invalid" "                            " 2
at_xfail=no
(
  $as_echo "38. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1802: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1802"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1802"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1802"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1802"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1802"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1802"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1802"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1802: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1802"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1804: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1804"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1804: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1804"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1804: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1804"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1804: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1804"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1806"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1806"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1806"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1806"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1806"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1806"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1806"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1806: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1806"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1806"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1807"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1807"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1807"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1807"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1807"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1807"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1807"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1807: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1807"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1807"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1808"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:1808"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1808"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1808"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1808"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1808"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1808"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1808: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1808"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1808"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1809"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:1809"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:1809"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1809"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1809"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1809"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1809"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1809: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1809"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk+new,tcp,action=1
priority=100,in_port=3,tcp,action=ct(),4
priority=100,in_port=4,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=4,ct_state=+trk+inv,tcp,action=3
priority=100,in_port=4,ct_state=+trk+new,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1828: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1828"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1828"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1833" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1834" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1835: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1835"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:1835"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1838: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1838"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1838"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1840: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1840"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1840: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1840"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1840: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1840"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1840" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1840: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1840"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1840: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1840"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1840" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1840: :; "
at_fn_check_prepare_trace "system-traffic.at:1840"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_38
#AT_START_39
at_fn_group_banner 39 'system-traffic.at:1843' \
  "conntrack - zones" "                              " 2
at_xfail=no
(
  $as_echo "39. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1845: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1845"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1845"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1845"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1845"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1845"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1845"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1845"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1845: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1845"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1847: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1847"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1847"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1847: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1847"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1847"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1847: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1847"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1847"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1847: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1847"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1847"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1849"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1849"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1849"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1849"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1849"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1849"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1849"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1849: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1849"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1849"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1850"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1850"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1850"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1850"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1850"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1850"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1850"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1850: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1850"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1850"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1851"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:1851"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1851"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1851"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1851"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1851"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1851"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1851: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1851"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1852"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:1852"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:1852"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1852"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1852"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1852"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1852"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1852: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1852"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1852"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(commit,zone=1),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0,zone=1)
priority=100,in_port=2,ct_state=+trk,ct_zone=1,tcp,action=1
priority=100,in_port=3,tcp,action=ct(commit,zone=2),4
priority=100,in_port=4,ct_state=-trk,tcp,action=ct(table=0,zone=2)
priority=100,in_port=4,ct_state=+trk,ct_zone=1,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1868: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1868"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1868"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1870" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1871" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1874: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1874"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1874"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1876: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1876"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1876"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1882: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1882"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:1882"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1884: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.4\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1884"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.4" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.4,dst=10.1.1.3,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1884"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1888: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1888"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1888: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1888"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1888: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1888"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1888" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1888: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1888"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1888: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1888"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1888" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1888: :; "
at_fn_check_prepare_trace "system-traffic.at:1888"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1888"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_39
#AT_START_40
at_fn_group_banner 40 'system-traffic.at:1891' \
  "conntrack - zones from field" "                   " 2
at_xfail=no
(
  $as_echo "40. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1893: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1893"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1893"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1893"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1893"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1893"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1893"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1893"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1893: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1893"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1893"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1895: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1895"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1895: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1895"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1895: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1895"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1895: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1895"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1897"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1897"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1897"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1897"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1897"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1897"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1897"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1897: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1897"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1898"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1898"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1898"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1898"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1898"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1898"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1898"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1898: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1898"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1898"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1899"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:1899"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:1899"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1899"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1899"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1899"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1899"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1899: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1899"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1900"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:1900"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:1900"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1900"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1900"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1900"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1900"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1900: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1900"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=load:0x1001->NXM_NX_REG0[0..15],ct(commit,zone=NXM_NX_REG0[0..15]),2
priority=100,in_port=2,ct_state=-trk,tcp,action=load:0x1001->NXM_NX_REG0[0..15],ct(table=0,zone=NXM_NX_REG0[0..15])
priority=100,in_port=2,ct_state=+trk,ct_zone=0x1001,tcp,action=1
priority=100,in_port=3,tcp,action=load:0x1002->NXM_NX_REG0[0..15],ct(commit,zone=NXM_NX_REG0[0..15]),4
priority=100,in_port=4,ct_state=-trk,tcp,action=load:0x1002->NXM_NX_REG0[0..15],ct(table=0,zone=NXM_NX_REG0[0..15])
priority=100,in_port=4,ct_state=+trk,ct_zone=0x1001,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1915: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:1915"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1915"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1917" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1918" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1921: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1921"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1923: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1923"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=4097,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1929: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1929"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:1929"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1931: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.4\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:1931"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.4" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.4,dst=10.1.1.3,sport=<cleared>,dport=<cleared>),zone=4098,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1935: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1935"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1935: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1935"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1935: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1935"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1935" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1935: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1935"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1935: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1935"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1935" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1935: :; "
at_fn_check_prepare_trace "system-traffic.at:1935"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_40
#AT_START_41
at_fn_group_banner 41 'system-traffic.at:1938' \
  "conntrack - multiple bridges" "                   " 2
at_xfail=no
(
  $as_echo "41. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1940: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1940"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1940"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1940"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1940"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1940"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1940"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1940"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1940: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --\\
    add-port br0 patch+ -- set int patch+ type=patch options:peer=patch- --\\
    add-port br1 patch- -- set int patch- type=patch options:peer=patch+ -- "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1940"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --\
    add-port br0 patch+ -- set int patch+ type=patch options:peer=patch- --\
    add-port br1 patch- -- set int patch- type=patch options:peer=patch+ --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1945: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1945"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1945"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1945: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1945"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1945"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1947"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1947"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1947"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1947"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1947"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1947"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1947"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1947: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1947"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1947"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1948"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1948"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1948"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ovs-vsctl add-port br1 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1948"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1948"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1948"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1948"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1948: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1948"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows-br0.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=2,tcp,ct_state=-trk,action=ct(commit,zone=1),1
priority=100,in_port=1,tcp,ct_state=-trk,action=ct(table=0,zone=1)
priority=100,in_port=1,tcp,ct_state=+trk+est,ct_zone=1,action=2
_ATEOF


cat >flows-br1.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,ct_state=-trk,action=ct(table=0,zone=2)
priority=100,in_port=1,tcp,ct_state=+trk+new,ct_zone=2,action=ct(commit,zone=2),2
priority=100,in_port=1,tcp,ct_state=+trk+est,ct_zone=2,action=2
priority=100,in_port=2,tcp,ct_state=-trk,action=ct(table=0,zone=2)
priority=100,in_port=2,tcp,ct_state=+trk+est,ct_zone=2,action=ct(commit,zone=2),1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1972: ovs-ofctl --bundle add-flows br0 flows-br0.txt"
at_fn_check_prepare_trace "system-traffic.at:1972"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows-br0.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1972"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:1973: ovs-ofctl --bundle add-flows br1 flows-br1.txt"
at_fn_check_prepare_trace "system-traffic.at:1973"
( $at_check_trace; ovs-ofctl --bundle add-flows br1 flows-br1.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1973"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1976" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:1977: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1977"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1977"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:1979: check_logs "
at_fn_check_prepare_trace "system-traffic.at:1979"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1979: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:1979"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1979: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:1979"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1979" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1979: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:1979"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1979: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:1979"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:1979" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:1979: :; "
at_fn_check_prepare_trace "system-traffic.at:1979"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_41
#AT_START_42
at_fn_group_banner 42 'system-traffic.at:1982' \
  "conntrack - multiple zones" "                     " 2
at_xfail=no
(
  $as_echo "42. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:1984: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:1984"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:1984"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:1984"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1984"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:1984"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:1984"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1984"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1984: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:1984"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1986: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1986"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1986"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:1986: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1986"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1986"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1988"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:1988"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:1988"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1988"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1988"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1988"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1988"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1988: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1988"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:1989"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:1989"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:1989"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1989"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1989"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1989"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1989"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:1989: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:1989"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:1989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(commit,zone=1),ct(commit,zone=2),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0,zone=2)
priority=100,in_port=2,ct_state=+trk,ct_zone=2,tcp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2001: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2001"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2001"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2003" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2006: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2006"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2006"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2009: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2009"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2009"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2011: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2011"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2016: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2016"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2016: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2016"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2016: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2016"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2016" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2016: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2016"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2016: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2016"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2016" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2016: :; "
at_fn_check_prepare_trace "system-traffic.at:2016"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2016"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_42
#AT_START_43
at_fn_group_banner 43 'system-traffic.at:2019' \
  "conntrack - multiple namespaces, internal ports" "" 2
at_xfail=no
(
  $as_echo "43. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2022: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2022"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2022"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2022"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2022"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2022"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2022"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2022"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2022: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set-fail-mode br0 secure --  "
at_fn_check_prepare_trace "system-traffic.at:2022"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set-fail-mode br0 secure --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2022"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2025: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2025"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2025"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2025: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2025"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2025"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2027: ovs-vsctl add-port br0 p0 -- set int p0 type=internal"
at_fn_check_prepare_trace "system-traffic.at:2027"
( $at_check_trace; ovs-vsctl add-port br0 p0 -- set int p0 type=internal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2027"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2027: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2027"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2027"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2027: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2027"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2027"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2027: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2027"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2027"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2028: ovs-vsctl add-port br0 p1 -- set int p1 type=internal"
at_fn_check_prepare_trace "system-traffic.at:2028"
( $at_check_trace; ovs-vsctl add-port br0 p1 -- set int p1 type=internal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2028: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2028"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2028: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2028"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2028: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2028"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,ct_state=-trk,action=ct(commit,zone=1),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0,zone=1)
priority=100,in_port=2,ct_state=+trk,ct_zone=1,tcp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2042: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2042"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2044" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2047: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2047"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2050: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2050"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2050"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2052: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2052"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2052"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2056: check_logs \"/ioctl(SIOCGIFINDEX) on .* device failed: No such device/d
/removing policing failed: No such device/d\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2056"
( $at_check_trace; check_logs "/ioctl(SIOCGIFINDEX) on .* device failed: No such device/d
/removing policing failed: No such device/d"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2056: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2056"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2056: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2056"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2056" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2056: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2056"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2056: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2056"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2056" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2056: :; "
at_fn_check_prepare_trace "system-traffic.at:2056"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_43
#AT_START_44
at_fn_group_banner 44 'system-traffic.at:2061' \
  "conntrack - ct_mark" "                            " 2
at_xfail=no
(
  $as_echo "44. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2063: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2063"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2063"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2063"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2063"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2063"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2063"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2063"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2063: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2063"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2063"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2065: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2065"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2065"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2065: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2065"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2065"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2065: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2065"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2065"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2065: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2065"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2065"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2067"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2067"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2067"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2067"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2067"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2067"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2067"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2067: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2067"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2068"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2068"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2068"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2068"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2068"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2068"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2068"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2068: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2068"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2069"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:2069"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:2069"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2069"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2069"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2069"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2069"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2069: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2069"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2070"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:2070"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:2070"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2070"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2070"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2070"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2070"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2070: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2070"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(commit,exec(set_field:1->ct_mark)),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk,ct_mark=1,tcp,action=1
priority=100,in_port=3,tcp,action=ct(commit,exec(set_field:2->ct_mark)),4
priority=100,in_port=4,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=4,ct_state=+trk,ct_mark=1,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2086: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2086"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2086"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2088" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2089" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2092: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2092"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2092"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2093: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2093"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),mark=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2099: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2099"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:2099"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2100: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.4\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2100"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.4" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.4,dst=10.1.1.3,sport=<cleared>,dport=<cleared>),mark=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2100"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2104: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2104"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2104: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2104"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2104: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2104"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2104" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2104: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2104"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2104: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2104"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2104" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2104: :; "
at_fn_check_prepare_trace "system-traffic.at:2104"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_44
#AT_START_45
at_fn_group_banner 45 'system-traffic.at:2107' \
  "conntrack - ct_mark bit-fiddling" "               " 2
at_xfail=no
(
  $as_echo "45. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2109: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2109"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2109"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2109"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2109"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2109"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2109"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2109"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2109: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2109"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2111: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2111"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2111: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2111"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2111: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2111"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2111: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2111"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2113"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2113"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2113"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2113"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2113"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2113"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2113"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2113: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2113"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2114"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2114"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2114"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2114"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2114"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2114"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2114"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2114: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2114"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,tcp,action=ct(table=1)
table=0,priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=1,commit,exec(set_field:0x2/0x6->ct_mark))
table=1,in_port=1,ct_state=+new,tcp,action=ct(commit,exec(set_field:0x5/0x5->ct_mark)),2
table=1,in_port=1,ct_state=-new,tcp,action=2
table=1,in_port=2,ct_state=+trk,ct_mark=3,tcp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2129: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2129"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2131" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2134: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2134"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2134"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2136: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2136"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),mark=3,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2140: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2140"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2140: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2140"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2140: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2140"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2140" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2140: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2140"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2140: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2140"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2140" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2140: :; "
at_fn_check_prepare_trace "system-traffic.at:2140"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_45
#AT_START_46
at_fn_group_banner 46 'system-traffic.at:2143' \
  "conntrack - ct_mark from register" "              " 2
at_xfail=no
(
  $as_echo "46. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2145: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2145"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2145"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2145"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2145"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2145"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2145"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2145"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2145: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2145"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2147: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2147"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2147"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2147: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2147"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2147"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2147: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2147"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2147"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2147: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2147"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2147"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2149"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2149"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2149"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2149"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2149"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2149"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2149"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2149: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2149"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2150"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2150"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2150"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2150"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2150"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2150"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2150"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2150: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2150"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2151"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:2151"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:2151"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2151"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2151"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2151"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2151"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2151: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2151"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2152"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:2152"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:2152"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2152"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2152"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2152"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2152"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2152: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2152"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2152"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=load:1->NXM_NX_REG0[0..31],ct(commit,exec(move:NXM_NX_REG0[0..31]->NXM_NX_CT_MARK[])),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk,ct_mark=1,tcp,action=1
priority=100,in_port=3,tcp,action=load:2->NXM_NX_REG0[0..31],ct(commit,exec(move:NXM_NX_REG0[0..31]->NXM_NX_CT_MARK[])),4
priority=100,in_port=4,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=4,ct_state=+trk,ct_mark=1,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2167: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2167"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2169" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2170" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2173: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2173"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2173"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2174: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2174"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),mark=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2180: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2180"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:2180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2181: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.4\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2181"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.4" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.4,dst=10.1.1.3,sport=<cleared>,dport=<cleared>),mark=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2185: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2185"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2185: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2185"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2185: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2185"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2185" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2185: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2185"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2185: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2185"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2185" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2185: :; "
at_fn_check_prepare_trace "system-traffic.at:2185"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_46
#AT_START_47
at_fn_group_banner 47 'system-traffic.at:2188' \
  "conntrack - ct_label" "                           " 2
at_xfail=no
(
  $as_echo "47. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2190: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2190"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2190"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2190"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2190"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2190"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2190"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2190"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2190: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2190"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2192: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2192"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2192: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2192"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2192: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2192"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2192: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2192"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2192"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2194"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2194"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2194"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2194"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2194"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2194"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2194"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2194: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2194"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2195"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2195"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2195"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2195"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2195"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2195"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2195"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2195: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2195"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2196"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:2196"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:2196"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2196"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2196"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2196"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2196"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2196: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2196"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2197"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:2197"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:2197"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2197"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2197"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2197"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2197"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2197: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2197"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(commit,exec(set_field:0x0a000d000005000001->ct_label)),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk,ct_label=0x0a000d000005000001,tcp,action=1
priority=100,in_port=3,tcp,action=ct(commit,exec(set_field:0x2->ct_label)),4
priority=100,in_port=4,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=4,ct_state=+trk,ct_label=0x0a000d000005000001,tcp,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2213: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2213"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2213"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2215" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2216" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2223: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2223"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:2223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2225: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2225"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2225: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2225"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2225: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2225"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2225" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2225: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2225"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2225: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2225"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2225" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2225: :; "
at_fn_check_prepare_trace "system-traffic.at:2225"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_47
#AT_START_48
at_fn_group_banner 48 'system-traffic.at:2228' \
  "conntrack - ct_label bit-fiddling" "              " 2
at_xfail=no
(
  $as_echo "48. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2230: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2230"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2230"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2230"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2230"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2230"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2230"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2230"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2230: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2230"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2232: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2232"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2232: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2232"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2232: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2232"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2232: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2232"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2232"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2234"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2234"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2234"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2234"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2234"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2234"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2234"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2234: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2234"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2235"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2235"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2235"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2235"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2235"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2235"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2235"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2235: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2235"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,tcp,action=ct(table=1)
table=0,priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=1,commit,exec(set_field:0x200000000/0x200000004->ct_label))
table=1,in_port=1,tcp,ct_state=+new,action=ct(commit,exec(set_field:0x5/0x5->ct_label)),2
table=1,in_port=1,tcp,ct_state=-new,action=2
table=1,in_port=2,ct_state=+trk,ct_label=0x200000001,tcp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2250: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2250"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2252" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2255: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2255"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2257: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2257"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),labels=0x200000001,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2257"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2261: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2261"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2261: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2261"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2261: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2261"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2261" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2261: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2261"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2261: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2261"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2261" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2261: :; "
at_fn_check_prepare_trace "system-traffic.at:2261"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_48
#AT_START_49
at_fn_group_banner 49 'system-traffic.at:2264' \
  "conntrack - ct metadata, multiple zones" "        " 2
at_xfail=no
(
  $as_echo "49. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2266: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2266"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2266"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2266"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2266"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2266"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2266"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2266"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2266: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2266"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2266"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2268: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2268"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2268: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2268"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2268: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2268"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2268: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2268"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2270"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2270"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2270"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2270"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2270"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2270"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2270"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2270: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2270"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2271"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2271"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2271"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2271"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2271"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2271"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2271"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2271: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2271"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2271"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,tcp,action=ct(zone=1,table=1)
table=0,priority=100,in_port=2,ct_state=-trk,tcp,action=ct(zone=1,table=1,commit,exec(set_field:0x200000000/0x200000004->ct_label,set_field:0x2/0x6->ct_mark))
table=1,in_port=1,tcp,ct_state=+new,action=ct(zone=1,commit,exec(set_field:0x5/0x5->ct_label,set_field:0x5/0x5->ct_mark)),ct(commit,zone=2),2
table=1,in_port=1,tcp,ct_state=-new,action=ct(zone=2),2
table=1,in_port=2,tcp,action=ct(zone=2),1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2288: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2288"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2288"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2290" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2293: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2293"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2293"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2295: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2295"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,mark=3,labels=0x200000001,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2300: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2300"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2300: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2300"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2300: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2300"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2300" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2300: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2300"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2300: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2300"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2300" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2300: :; "
at_fn_check_prepare_trace "system-traffic.at:2300"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_49
#AT_START_50
at_fn_group_banner 50 'system-traffic.at:2303' \
  "conntrack - new connections" "                    " 2
at_xfail=no
(
  $as_echo "50. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2305: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2305"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2305"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2305"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2305"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2305"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2305"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2305"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2305: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2305"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2307: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2307"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2307"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2307: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2307"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2307"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2309"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2309"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2309"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2309"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2309"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2309"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2309"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2309: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2309"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2310"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2310"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2310"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2310"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2310"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2310"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2310"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2310: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2310"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows1.txt <<'_ATEOF'
table=0, priority=1,action=drop
table=0, priority=10,arp,action=normal
table=0, priority=100,tcp,action=ct(table=1)
table=0, priority=100,udp,action=ct(table=1)
table=1, priority=100,in_port=1,tcp,ct_state=+trk+new,action=ct(commit)
table=1, priority=100,in_port=1,udp,ct_state=+trk+new,action=ct(commit)
table=1, priority=100,in_port=1,ct_state=+trk+est,action=2
table=1, priority=100,in_port=2,ct_state=+trk+est,action=1
_ATEOF


ovs-appctl vlog/set dbg

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2325: ovs-ofctl --bundle add-flows br0 flows1.txt"
at_fn_check_prepare_trace "system-traffic.at:2325"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows1.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2325"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2328" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2329: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2329"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:2329"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2332: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:2332"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2332"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2333: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:2333"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2333"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2336: ovs-ofctl dump-flows br0 \"table=1 in_port=1,ct_state=+trk+est\" | ofctl_strip"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2336"
( $at_check_trace; ovs-ofctl dump-flows br0 "table=1 in_port=1,ct_state=+trk+est" | ofctl_strip
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "NXST_FLOW reply:
 table=1, priority=100,ct_state=+est+trk,in_port=1 actions=output:2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2336"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2341: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2341"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2341: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2341"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2341: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2341"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2341" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2341: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2341"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2341: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2341"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2341" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2341: :; "
at_fn_check_prepare_trace "system-traffic.at:2341"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_50
#AT_START_51
at_fn_group_banner 51 'system-traffic.at:2344' \
  "conntrack - ICMP related" "                       " 2
at_xfail=no
(
  $as_echo "51. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:2345" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2345"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2347: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2347"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2347"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2347"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2347"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2347"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2347"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2347"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2347: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2347"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2347"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2349: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2349"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2349"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2349: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2349"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2349"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2351"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2351"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2351"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2351"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2351"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2351"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2351"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2351: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2351"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2351"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2352"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2352"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2352"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2352"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2352"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2352"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2352"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2352: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2352"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,udp,action=ct(commit,exec(set_field:1->ct_mark)),2
priority=100,in_port=2,icmp,ct_state=-trk,action=ct(table=0)
priority=100,in_port=2,icmp,ct_state=+trk+rel,ct_mark=1,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2363: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2363"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2366: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c \"echo a | nc \$NC_EOF_OPT -u 10.1.1.2 10000\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2366"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c "echo a | nc $NC_EOF_OPT -u 10.1.1.2 10000"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2368: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:2368"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2368"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2369: ovs-ofctl dump-flows br0 | ofctl_strip | sort | grep -v drop"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2369"
( $at_check_trace; ovs-ofctl dump-flows br0 | ofctl_strip | sort | grep -v drop
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=44, priority=100,udp,in_port=1 actions=ct(commit,exec(load:0x1->NXM_NX_CT_MARK[])),output:2
 n_packets=1, n_bytes=72, priority=100,ct_state=+rel+trk,ct_mark=0x1,icmp,in_port=2 actions=output:1
 n_packets=1, n_bytes=72, priority=100,ct_state=-trk,icmp,in_port=2 actions=ct(table=0)
 n_packets=2, n_bytes=84, priority=10,arp actions=NORMAL
NXST_FLOW reply:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2369"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2377: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2377"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2377: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2377"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2377: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2377"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2377" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2377: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2377"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2377: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2377"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2377" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2377: :; "
at_fn_check_prepare_trace "system-traffic.at:2377"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_51
#AT_START_52
at_fn_group_banner 52 'system-traffic.at:2380' \
  "conntrack - ICMP related to original direction" " " 2
at_xfail=no
(
  $as_echo "52. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:2381" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2381"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2383: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2383"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2383"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2383"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2383"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2383"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2383"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2383"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2383: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2383"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2383"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2385: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2385"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2385"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2385: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2385"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2385"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2387"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2387"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2387"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2387"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2387"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2387"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2387"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2387: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2387"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2387"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2388"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2388"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2388"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2388"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2388"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2388"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2388"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2388: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2388"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2388"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1000,arp,action=normal
priority=100,ip,action=ct(table=1)
priority=1,action=drop
table=1,ip,action=ct(zone=34673,table=2)
table=2,in_port=2,udp,action=ct(commit,zone=34673),1
table=2,in_port=1,udp,action=ct(commit,zone=34673),2
table=2,in_port=2,ct_state=+rel,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2401: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2401"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2401"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2404: ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\\(,0\\) '00010200020400232211223308004500001c000100004011f6fac0640108c06402050035003500087b9e'"
at_fn_check_prepare_trace "system-traffic.at:2404"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\(,0\) '00010200020400232211223308004500001c000100004011f6fac0640108c06402050035003500087b9e'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2404"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2407: ovs-ofctl -O OpenFlow13 packet-out br0 1 resubmit\\(,0\\) '00232211223300010200020408004500001c000100004011f6fac0640205c06401080035003500087b9e'"
at_fn_check_prepare_trace "system-traffic.at:2407"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 1 resubmit\(,0\) '00232211223300010200020408004500001c000100004011f6fac0640205c06401080035003500087b9e'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2407"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2412: ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\\(,0\\) '000102000204002322112233080045000038000100003f01f7eec0640108c0640205030a80e5ffffffff4500001c000100003f11f7fac0640205c06401080035003500087b9e'"
at_fn_check_prepare_trace "system-traffic.at:2412"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\(,0\) '000102000204002322112233080045000038000100003f01f7eec0640108c0640205030a80e5ffffffff4500001c000100003f11f7fac0640205c06401080035003500087b9e'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2414: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:2414"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2414"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2417: ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\\(,0\\) '000102000204002322112233080045000038000100003f01f7eec0640108c0640205030a80e5ffffffff4500001c000100003f11f7fac0640205c06401080035003500087b9e'"
at_fn_check_prepare_trace "system-traffic.at:2417"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\(,0\) '000102000204002322112233080045000038000100003f01f7eec0640108c0640205030a80e5ffffffff4500001c000100003f11f7fac0640205c06401080035003500087b9e'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2419: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:2419"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2419"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2421: ovs-ofctl dump-flows br0 | ofctl_strip | sort | grep -v drop"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2421"
( $at_check_trace; ovs-ofctl dump-flows br0 | ofctl_strip | sort | grep -v drop
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=4, n_bytes=224, priority=100,ip actions=ct(table=1)
 priority=1000,arp actions=NORMAL
 table=1, n_packets=4, n_bytes=224, ip actions=ct(table=2,zone=34673)
 table=2, n_packets=1, n_bytes=42, udp,in_port=1 actions=ct(commit,zone=34673),output:2
 table=2, n_packets=1, n_bytes=42, udp,in_port=2 actions=ct(commit,zone=34673),output:1
 table=2, n_packets=2, n_bytes=140, ct_state=+rel,icmp,in_port=2 actions=output:1
NXST_FLOW reply:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2431: ovs-appctl dpctl/dump-conntrack | grep \"dst=192.100.1.8\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2431"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=192.100.1.8" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=192.100.1.8,dst=192.100.2.5,sport=<cleared>,dport=<cleared>),reply=(src=192.100.2.5,dst=192.100.1.8,sport=<cleared>,dport=<cleared>),zone=34673
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2431"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2435: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2435"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2435: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2435"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2435: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2435"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2435" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2435: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2435"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2435: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2435"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2435" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2435: :; "
at_fn_check_prepare_trace "system-traffic.at:2435"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_52
#AT_START_53
at_fn_group_banner 53 'system-traffic.at:2438' \
  "conntrack - ICMP related 2" "                     " 2
at_xfail=no
(
  $as_echo "53. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2440: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2440"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2440"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2440"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2440"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2440"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2440"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2440"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2440: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2440"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2440"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2442: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2442"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2442: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2442"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2444"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2444"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2444"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2444"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.16.0.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2444"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.16.0.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2444"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2444"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2444: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2444"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2445"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2445"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2445"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2445"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"172.16.0.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2445"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "172.16.0.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2445"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2445"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2445: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2445"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2445"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,ip,action=ct(commit,table=1)
table=1,ip,action=controller
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2453: ovs-ofctl --bundle replace-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2453"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2456: ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log"
at_fn_check_prepare_trace "system-traffic.at:2456"
( $at_check_trace; ovs-ofctl monitor br0 65534 invalid_ttl --detach --no-chdir --pidfile 2> ofctl_monitor.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2459: ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\\(,0\\) 'f64c473528c9c6f54ecb72db080045c0003d2e8700004001f351ac100004ac1000030303da490000000045000021317040004011b138ac100003ac10000411112222000d20966369616f0a'"
at_fn_check_prepare_trace "system-traffic.at:2459"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\(,0\) 'f64c473528c9c6f54ecb72db080045c0003d2e8700004001f351ac100004ac1000030303da490000000045000021317040004011b138ac100003ac10000411112222000d20966369616f0a'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2459"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2462: ovs-ofctl -O OpenFlow13 packet-out br0 1 resubmit\\(,0\\) 'c6f94ecb72dbe64c473528c9080045000021317040004011b138ac100001ac100002a28e15b3000d20966369616f0a'"
at_fn_check_prepare_trace "system-traffic.at:2462"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 1 resubmit\(,0\) 'c6f94ecb72dbe64c473528c9080045000021317040004011b138ac100001ac100002a28e15b3000d20966369616f0a'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2462"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2465: ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\\(,0\\) 'e64c473528c9c6f94ecb72db080045c0003d2e8700004001f354ac100003ac1000010303553f0000000045000021317040004011b138ac100001ac100002a28e15b3000d20966369616f0a'"
at_fn_check_prepare_trace "system-traffic.at:2465"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 2 resubmit\(,0\) 'e64c473528c9c6f94ecb72db080045c0003d2e8700004001f354ac100003ac1000010303553f0000000045000021317040004011b138ac100001ac100002a28e15b3000d20966369616f0a'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2465"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2467: test -e \$OVS_RUNDIR/ovs-ofctl.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-ofctl.pid" "system-traffic.at:2467"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-ofctl.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-ofctl.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2467: ovs-appctl -t ovs-ofctl exit"
at_fn_check_prepare_trace "system-traffic.at:2467"
( $at_check_trace; ovs-appctl -t ovs-ofctl exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2467" "while kill -0 \$TMPPID 2>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2470: cat ofctl_monitor.log | grep -v ff02 | grep -v fe80 | grep -v no_match"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2470"
( $at_check_trace; cat ofctl_monitor.log | grep -v ff02 | grep -v fe80 | grep -v no_match
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "NXT_PACKET_IN2 (xid=0x0): table_id=1 cookie=0x0 total_len=75 ct_state=inv|trk,ip,in_port=2 (via action) data_len=75 (unbuffered)
icmp,vlan_tci=0x0000,dl_src=c6:f5:4e:cb:72:db,dl_dst=f6:4c:47:35:28:c9,nw_src=172.16.0.4,nw_dst=172.16.0.3,nw_tos=192,nw_ecn=0,nw_ttl=64,icmp_type=3,icmp_code=3 icmp_csum:da49
NXT_PACKET_IN2 (xid=0x0): table_id=1 cookie=0x0 total_len=47 ct_state=new|trk,ct_nw_src=172.16.0.1,ct_nw_dst=172.16.0.2,ct_nw_proto=17,ct_tp_src=41614,ct_tp_dst=5555,ip,in_port=1 (via action) data_len=47 (unbuffered)
udp,vlan_tci=0x0000,dl_src=e6:4c:47:35:28:c9,dl_dst=c6:f9:4e:cb:72:db,nw_src=172.16.0.1,nw_dst=172.16.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=41614,tp_dst=5555 udp_csum:2096
NXT_PACKET_IN2 (xid=0x0): table_id=1 cookie=0x0 total_len=75 ct_state=rel|rpl|trk,ct_nw_src=172.16.0.1,ct_nw_dst=172.16.0.2,ct_nw_proto=17,ct_tp_src=41614,ct_tp_dst=5555,ip,in_port=2 (via action) data_len=75 (unbuffered)
icmp,vlan_tci=0x0000,dl_src=c6:f9:4e:cb:72:db,dl_dst=e6:4c:47:35:28:c9,nw_src=172.16.0.3,nw_dst=172.16.0.1,nw_tos=192,nw_ecn=0,nw_ttl=64,icmp_type=3,icmp_code=3 icmp_csum:553f
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2470"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2479: ovs-appctl dpctl/dump-conntrack | grep \"dst=172.16.0.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2479"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=172.16.0.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=172.16.0.1,dst=172.16.0.2,sport=<cleared>,dport=<cleared>),reply=(src=172.16.0.2,dst=172.16.0.1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2483: ovs-appctl dpctl/dump-conntrack | grep \"dst=172.16.0.3\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2483"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=172.16.0.3" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2486: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2486"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2486: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2486"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2486: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2486"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2486" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2486: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2486"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2486: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2486"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2486" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2486: :; "
at_fn_check_prepare_trace "system-traffic.at:2486"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2486"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log" \
"ofctl_monitor.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_53
#AT_START_54
at_fn_group_banner 54 'system-traffic.at:2489' \
  "conntrack - IPv4 fragmentation" "                 " 2
at_xfail=no
(
  $as_echo "54. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2491: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2491"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2491"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2491"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2491"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2491"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2491"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2491"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2491: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2491"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2491"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2493: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2493"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2493: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2493"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2493"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2495"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2495"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2495"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2495"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2495"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2495"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2495"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2495: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2495"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2496"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2496"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2496"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2496"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2496"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2496"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2496"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2496: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2496"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit,zone=9),2
priority=100,in_port=2,ct_state=-trk,icmp,action=ct(table=0,zone=9)
priority=100,in_port=2,ct_state=+trk+est-new,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2507: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2507"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2507"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






 { set +x
$as_echo "$at_srcdir/system-traffic.at:2513: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2513"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2513"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2518: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2518"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }







{ set +x
$as_echo "$at_srcdir/system-traffic.at:2525: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2525"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2525: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2525"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2525: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2525"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2525" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2525: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2525"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2525: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2525"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2525" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2525: :; "
at_fn_check_prepare_trace "system-traffic.at:2525"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2525"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_54
#AT_START_55
at_fn_group_banner 55 'system-traffic.at:2528' \
  "conntrack - IPv4 fragmentation expiry" "          " 2
at_xfail=no
(
  $as_echo "55. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2530: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2530"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2530"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2530"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2530"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2530"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2530"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2530"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2530: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2530"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2530"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2532: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2532"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2532: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2532"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2534"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2534"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2534"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2534"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2534"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2534"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2534"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2534: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2534"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2535"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2535"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2535"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2535"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2535"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2535"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2535"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2535: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2535"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2535"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal

priority=100,in_port=1,icmp,ip_frag=no,action=ct(commit,zone=9),2
priority=100,in_port=1,icmp,ip_frag=firstaction=ct(commit,zone=9),2
priority=100,in_port=2,ct_state=-trk,icmp,action=ct(table=0,zone=9)
priority=100,in_port=2,ct_state=+trk+est-new,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2548: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2548"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






 { set +x
$as_echo "$at_srcdir/system-traffic.at:2554: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 1 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2554"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 1 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "7 packets transmitted, 0 received, 100% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }







{ set +x
$as_echo "$at_srcdir/system-traffic.at:2561: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2561"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2561: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2561"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2561: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2561"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2561" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2561: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2561"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2561: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2561"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2561" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2561: :; "
at_fn_check_prepare_trace "system-traffic.at:2561"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2561"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_55
#AT_START_56
at_fn_group_banner 56 'system-traffic.at:2564' \
  "conntrack - IPv4 fragmentation + vlan" "          " 2
at_xfail=no
(
  $as_echo "56. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2566: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2566"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2566"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2566"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2566"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2566"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2566"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2566"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2566: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2566"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2566"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2568: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2568"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2568"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2568: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2568"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2568"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2570"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2570"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2570"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2570"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2570"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2570"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2570"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2570: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2570"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2570"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2571"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2571"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2571"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2571"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2571"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2571"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2571"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2571: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2571"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2571"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


  { set +x
$as_echo "$at_srcdir/system-traffic.at:2572: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2572"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2572"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2572: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2572"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2572"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2572: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2572"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2572"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:2573: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2573"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2573"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2573: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2573"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2573"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2573: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2573"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2573"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit,zone=9),2
priority=100,in_port=2,ct_state=-trk,icmp,action=ct(table=0,zone=9)
priority=100,in_port=2,ct_state=+trk+est-new,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2584: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2584"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2584"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






 { set +x
$as_echo "$at_srcdir/system-traffic.at:2590: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2590"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2595: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2595"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }







{ set +x
$as_echo "$at_srcdir/system-traffic.at:2602: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2602"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2602: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2602"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2602: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2602"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2602" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2602: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2602"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2602: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2602"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2602" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2602: :; "
at_fn_check_prepare_trace "system-traffic.at:2602"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2602"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_56
#AT_START_57
at_fn_group_banner 57 'system-traffic.at:2605' \
  "conntrack - IPv4 fragmentation + cvlan" "         " 2
at_xfail=no
(
  $as_echo "57. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2607: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2607"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2607"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2607"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2607"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2607"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2607"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2607"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2607: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:2607"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:2608" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2608"
     $as_echo "system-traffic.at:2608" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2608"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2610: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2610"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2610"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2610: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2610"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2610"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2612"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2612"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2612"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2612"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2612"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2612"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2612"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2612: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2612"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2613"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2613"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2613"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2613"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2613"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2613"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2613"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2613: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2613"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2613"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:2615: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2615"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2615: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2615"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2615: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"10.255.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2615"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "10.255.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2615: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2615"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2615"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:2616: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2616"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2616"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2616: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2616"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2616"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2616: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"10.255.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2616"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "10.255.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2616"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2616: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2616"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2616"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:2618: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2618"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2618"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2618: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2618"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2618"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2618: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2618"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2618"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:2618: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2618"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2618"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:2619: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2619"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2619: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2619"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2619: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2619"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:2619: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2619"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit,zone=9),2
priority=100,in_port=2,ct_state=-trk,icmp,action=ct(table=0,zone=9)
priority=100,in_port=2,ct_state=+trk+est-new,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2630: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2630"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2630"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2632" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2635: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2635"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2635"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2640: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.255.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2640"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.255.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2645: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2645"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2645"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2650: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.255.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2650"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.255.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2650"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2654: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2654"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2654: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2654"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2654: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2654"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2654" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2654: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2654"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2654: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2654"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2654" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2654: :; "
at_fn_check_prepare_trace "system-traffic.at:2654"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2654"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_57
#AT_START_58
at_fn_group_banner 58 'system-traffic.at:2657' \
  "conntrack - IPv4 fragmentation incomplete reassembled packet" "" 2
at_xfail=no
(
  $as_echo "58. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2659: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2659"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2659"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2659"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2659"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2659"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2659"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2659"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2659: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2659"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2659"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }







ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2663: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2663"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2663"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2663: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2663"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2663"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2665"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2665"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2665"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2665"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2665"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2665"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2665"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2665: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2665"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2666"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2666"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2666"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2666"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2666"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2666"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2666"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2666: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2666"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a5054000000090800450001a400012000001183440a0101010a01010200010002000800000304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2672: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2672"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2672"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2674: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2674"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2674"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2677: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2677"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2677: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2677"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2677: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2677"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2677" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2677: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2677"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2677: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2677"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2677" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2677: :; "
at_fn_check_prepare_trace "system-traffic.at:2677"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_58
#AT_START_59
at_fn_group_banner 59 'system-traffic.at:2681' \
  "conntrack - IPv4 fragmentation with fragments specified" "" 2
at_xfail=no
(
  $as_echo "59. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2683: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2683"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2683"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2683"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2683"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2683"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2683"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2683"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2683: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2683"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2683"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2686: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2686"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2686"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2686: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2686"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2686"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2688"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2688"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2688"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2688"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2688"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2688"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2688"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2688: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2688"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2689"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2689"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2689"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2689"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2689"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2689"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2689"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2689: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2689"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a5054000000090800450001a400012000001183440a0101010a01010200010002000800000304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809,  actions=ct(commit)
packet-out in_port=1, packet=50540000000a505400000009080045000030000100320011a4860a0101010a01010200010002000800000010203040506070809000010203040506070809, actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2696: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2696"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2698: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2698"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2698"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2702: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2702"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2702: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2702"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2702: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2702"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2702" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2702: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2702"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2702: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2702"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2702" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2702: :; "
at_fn_check_prepare_trace "system-traffic.at:2702"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_59
#AT_START_60
at_fn_group_banner 60 'system-traffic.at:2705' \
  "conntrack - IPv4 fragmentation out of order" "    " 2
at_xfail=no
(
  $as_echo "60. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2707: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2707"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2707"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2707"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2707"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2707"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2707"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2707"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2707: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2707"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2707"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2710: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2710"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2710"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2710: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2710"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2710"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2712"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2712"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2712"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2712"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2712"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2712"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2712"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2712: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2712"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2712"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2713"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2713"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2713"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2713"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2713"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2713"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2713"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2713: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2713"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2713"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a505400000009080045000030000100320011a4860a0101010a01010200010002000800000010203040506070809000010203040506070809, actions=ct(commit)
packet-out in_port=1, packet=50540000000a5054000000090800450001a400012000001183440a0101010a01010200010002000800000304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2720: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2720"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2722: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2722"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2722"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2726: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2726"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2726: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2726"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2726: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2726"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2726" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2726: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2726"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2726: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2726"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2726" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2726: :; "
at_fn_check_prepare_trace "system-traffic.at:2726"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_60
#AT_START_61
at_fn_group_banner 61 'system-traffic.at:2729' \
  "conntrack - IPv4 fragmentation overlapping fragments by 1 octet" "" 2
at_xfail=no
(
  $as_echo "61. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



    $as_echo "system-traffic.at:2731" >"$at_check_line_file"
at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2731"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2732: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2732"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2732"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2732"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2732"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2732"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2732"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2732"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2732: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2732"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2735: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2735"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2735"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2735: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2735"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2735"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2737"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2737"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2737"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2737"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2737"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2737"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2737"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2737: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2737"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2737"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2738"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2738"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2738"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2738"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2738"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2738"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2738"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2738: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2738"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2738"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a5054000000090800450001a400012000001183440a0101010a01010200010002000800000304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809,  actions=ct(commit)
packet-out in_port=1, packet=50540000000a505400000009080045000030000100310011a4870a0101010a01010200010002000800000010203040506070809000010203040506070809, actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2745: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2745"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2745"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2747: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2747"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2747"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2750: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2750"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2750: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2750"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2750: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2750"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2750" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2750: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2750"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2750: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2750"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2750" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2750: :; "
at_fn_check_prepare_trace "system-traffic.at:2750"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_61
#AT_START_62
at_fn_group_banner 62 'system-traffic.at:2753' \
  "conntrack - IPv4 fragmentation overlapping fragments by 1 octet out of order" "" 2
at_xfail=no
(
  $as_echo "62. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



    $as_echo "system-traffic.at:2755" >"$at_check_line_file"
at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2755"

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2756: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2756"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2756"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2756"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2756"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2756"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2756"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2756"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2756: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2756"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2756"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2759: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2759"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2759"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2759: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2759"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2759"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2761"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2761"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2761"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2761"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2761"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2761"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2761"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2761: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2761"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2762"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2762"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2762"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2762"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2762"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2762"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2762"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2762: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2762"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a505400000009080045000030000100310011a4870a0101010a01010200010002000800000010203040506070809000010203040506070809, actions=ct(commit)
packet-out in_port=1, packet=50540000000a5054000000090800450001a400012000001183440a0101010a01010200010002000800000304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2769: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2769"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2769"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:2771: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2771"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2771"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2774: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2774"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2774: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2774"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2774: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2774"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2774" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2774: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2774"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2774: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2774"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2774" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2774: :; "
at_fn_check_prepare_trace "system-traffic.at:2774"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_62
#AT_START_63
at_fn_group_banner 63 'system-traffic.at:2777' \
  "conntrack - IPv6 fragmentation" "                 " 2
at_xfail=no
(
  $as_echo "63. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2779: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2779"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2779"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2779"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2779"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2779"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2779"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2779"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2779: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2779"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2781: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2781"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2781: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2781"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2783"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2783"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2783"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2783"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2783"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2783"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2783"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2783: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2783"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2783"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2784"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2784"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2784"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2784"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2784"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2784"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2784"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2784: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2784"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,in_port=1,ipv6,action=ct(commit,zone=9),2
priority=10,in_port=2,ct_state=-trk,ipv6,action=ct(table=0,zone=9)
priority=10,in_port=2,ct_state=+trk+est-new,ipv6,action=1
priority=100,icmp6,icmp_type=135,action=normal
priority=100,icmp6,icmp_type=136,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2796: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2796"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2796"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2801" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2804: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2804"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2804"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2809: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2809"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2809"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2813: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2813"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2813: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2813"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2813: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2813"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2813" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2813: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2813"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2813: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2813"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2813" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2813: :; "
at_fn_check_prepare_trace "system-traffic.at:2813"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2813"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_63
#AT_START_64
at_fn_group_banner 64 'system-traffic.at:2816' \
  "conntrack - IPv6 fragmentation expiry" "          " 2
at_xfail=no
(
  $as_echo "64. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2818: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2818"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2818"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2818"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2818"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2818"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2818"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2818"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2818: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2818"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2818"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2820: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2820"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2820"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2820: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2820"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2820"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2822"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2822"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2822"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2822"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2822"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2822"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2822"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2822: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2822"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2823"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2823"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2823"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2823"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2823"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2823"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2823"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2823: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2823"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop

priority=10,in_port=1,ipv6,ip_frag=first,action=ct(commit,zone=9),2
priority=10,in_port=1,ipv6,ip_frag=no,action=ct(commit,zone=9),2
priority=10,in_port=2,ct_state=-trk,ipv6,action=ct(table=0,zone=9)
priority=10,in_port=2,ct_state=+trk+est-new,ipv6,action=1

priority=100,icmp6,icmp_type=135,action=normal
priority=100,icmp6,icmp_type=136,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2839: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2839"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2839"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2844" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2847: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 1 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2847"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 1 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "7 packets transmitted, 0 received, 100% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2847"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




{ set +x
$as_echo "$at_srcdir/system-traffic.at:2853: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2853"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2853: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2853"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2853: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2853"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2853" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2853: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2853"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2853: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2853"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2853" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2853: :; "
at_fn_check_prepare_trace "system-traffic.at:2853"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2853"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_64
#AT_START_65
at_fn_group_banner 65 'system-traffic.at:2856' \
  "conntrack - IPv6 fragmentation + vlan" "          " 2
at_xfail=no
(
  $as_echo "65. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2858: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2858"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2858"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2858"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2858"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2858"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2858"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2858"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2858: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2858"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2858"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2860: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2860"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2860"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2860: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2860"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2860"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2862"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2862"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2862"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2862"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2862"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2862"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2862"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2862: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2862"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2863"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2863"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2863"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2863"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2863"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2863"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2863"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2863: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2863"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:2865: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2865"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2865"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2865: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2865"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2865"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2865: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 \"fc00:1::3/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2865"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.100 "fc00:1::3/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2865"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:2866: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2866"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2866"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2866: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2866"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2866"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2866: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 \"fc00:1::4/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2866"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.100 "fc00:1::4/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2866"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,in_port=1,ipv6,action=ct(commit,zone=9),2
priority=10,in_port=2,ct_state=-trk,ipv6,action=ct(table=0,zone=9)
priority=10,in_port=2,ct_state=+trk+est-new,ipv6,action=1
priority=100,icmp6,icmp_type=135,action=normal
priority=100,icmp6,icmp_type=136,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2878: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2878"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2883" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2886: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2886"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2886"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2891: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2891"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2891"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2895: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2895"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2895: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2895"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2895: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2895"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2895" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2895: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2895"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2895: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2895"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2895" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2895: :; "
at_fn_check_prepare_trace "system-traffic.at:2895"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_65
#AT_START_66
at_fn_group_banner 66 'system-traffic.at:2898' \
  "conntrack - IPv6 fragmentation + cvlan" "         " 2
at_xfail=no
(
  $as_echo "66. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2900: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2900"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2900"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2900"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2900"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2900"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2900"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2900"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2900: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:2900"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2900"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:2901" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2901"
     $as_echo "system-traffic.at:2901" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:2901"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2903: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2903"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2903"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2903: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2903"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2903"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2905"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2905"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2905"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2905"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2905"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2905"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2905"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2905: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2905"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2905"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2906"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2906"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2906"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2906"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:2908: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2908"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2908"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2908: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2908"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2908"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2908: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"fc00:ffff::3/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2908"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "fc00:ffff::3/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2908"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2908: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2908"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2908"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:2909: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2909"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2909"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2909: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2909"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2909"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2909: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"fc00:ffff::4/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2909"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "fc00:ffff::4/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2909"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2909: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2909"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2909"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:2911: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2911"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2911: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2911"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2911: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"fc00:1::3/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2911"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "fc00:1::3/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:2911: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2911"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:2912: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2912"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2912: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2912"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2912: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"fc00:1::4/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2912"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "fc00:1::4/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:2912: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2912"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,in_port=1,ipv6,action=ct(commit,zone=9),2
priority=10,in_port=2,ct_state=-trk,ipv6,action=ct(table=0,zone=9)
priority=10,in_port=2,ct_state=+trk+est-new,ipv6,action=1
priority=100,icmp6,icmp_type=135,action=normal
priority=100,icmp6,icmp_type=136,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2924: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:2924"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00:1::4
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2926" "until ip netns exec at_ns0 ping6 -c 1 fc00:1::4"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2929: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2929"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2929"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2934: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:ffff::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2934"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00:ffff::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2934"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2939: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2939"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:1::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2939"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:2944: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:ffff::4 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2944"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00:ffff::4 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2944"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:2948: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2948"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2948: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2948"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2948: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2948"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2948" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2948: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2948"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2948: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2948"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2948" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2948: :; "
at_fn_check_prepare_trace "system-traffic.at:2948"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_66
#AT_START_67
at_fn_group_banner 67 'system-traffic.at:2951' \
  "conntrack - IPv6 fragmentation incomplete reassembled packet" "" 2
at_xfail=no
(
  $as_echo "67. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2953: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2953"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2953"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2953"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2953"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2953"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2953"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2953"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2953: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2953"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2956: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2956"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2956"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2956: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2956"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2956"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2958"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2958"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2958"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2958"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2958"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2958"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2958"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2958: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2958"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2959"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2959"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2959"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2959"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2959"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2959"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2959"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2959: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2959"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a50540000000986dd6000000005002cfffc000000000000000000000000000001fc0000000000000000000000000000021100000100000001000100020008f62900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2965: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2965"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2967: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2967"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2967"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2970: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2970"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2970: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2970"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2970: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2970"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2970" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2970: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2970"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2970: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2970"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2970" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2970: :; "
at_fn_check_prepare_trace "system-traffic.at:2970"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2970"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_67
#AT_START_68
at_fn_group_banner 68 'system-traffic.at:2973' \
  "conntrack - IPv6 fragmentation with fragments specified" "" 2
at_xfail=no
(
  $as_echo "68. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2975: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2975"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2975"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2975"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2975"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2975"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2975"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2975"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2975: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2975"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2978: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2978"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:2978: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2978"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2980"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:2980"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:2980"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2980"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2980"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2980"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2980"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2980: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2980"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:2981"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:2981"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:2981"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2981"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2981"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2981"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2981"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:2981: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2981"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2981"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000A50540000000986DD6000000005002CFFFC000000000000000000000000000001FC0000000000000000000000000000021100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
packet-out in_port=1, packet=50540000000A50540000000986DD6000000000242CFFFC000000000000000000000000000001FC000000000000000000000000000002110004F80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2988: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:2988"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2990: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:2990"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2994: check_logs "
at_fn_check_prepare_trace "system-traffic.at:2994"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2994: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:2994"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2994: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:2994"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2994" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2994: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:2994"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2994: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:2994"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:2994" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:2994: :; "
at_fn_check_prepare_trace "system-traffic.at:2994"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_68
#AT_START_69
at_fn_group_banner 69 'system-traffic.at:2997' \
  "conntrack - IPv6 fragmentation out of order" "    " 2
at_xfail=no
(
  $as_echo "69. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:2999: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:2999"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:2999"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:2999"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2999"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:2999"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:2999"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:2999"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:2999: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:2999"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:2999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3002: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3002"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3002"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3002: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3002"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3002"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3004"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3004"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3004"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3004"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3004"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3004"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3004"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3004: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3004"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3005"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3005"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3005"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3005"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3005"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3005"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3005"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3005: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3005"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000A50540000000986DD6000000000242CFFFC000000000000000000000000000001FC000000000000000000000000000002110004F80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
packet-out in_port=1, packet=50540000000A50540000000986DD6000000005002CFFFC000000000000000000000000000001FC0000000000000000000000000000021100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3012: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:3012"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3014: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3014"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3014"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3018: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3018"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3018: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3018"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3018: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3018"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3018" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3018: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3018"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3018: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3018"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3018" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3018: :; "
at_fn_check_prepare_trace "system-traffic.at:3018"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_69
#AT_START_70
at_fn_group_banner 70 'system-traffic.at:3021' \
  "conntrack - IPv6 fragmentation, multiple extension headers" "" 2
at_xfail=no
(
  $as_echo "70. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3023: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3023"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3023"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3023"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3023"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3023"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3023"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3023"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3023: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3023"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3026: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3026"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3026"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3026: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3026"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3026"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3028"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3028"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3028"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3028"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3028"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3028"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3028"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3028: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3028"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3028"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3029"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3029"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3029"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3029"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3029"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3029"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3029"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3029: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3029"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



# Add different extension headers
cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000A50540000000986DD60000000050800FFFC000000000000000000000000000001FC0000000000000000000000000000022C000000000000001100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
packet-out in_port=1, packet=50540000000a50540000000986dd60000000002c00fffc000000000000000000000000000001fc0000000000000000000000000000022c00000000000000110004f80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3037: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:3037"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3037"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3039: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3039"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3039"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3043: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3043"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3043: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3043"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3043: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3043"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3043" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3043: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3043"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3043: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3043"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3043" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3043: :; "
at_fn_check_prepare_trace "system-traffic.at:3043"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_70
#AT_START_71
at_fn_group_banner 71 'system-traffic.at:3046' \
  "conntrack - IPv6 fragmentation, multiple extension headers + out of order" "" 2
at_xfail=no
(
  $as_echo "71. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3048: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3048"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3048"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3048"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3048"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3048"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3048"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3048"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3048: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3048"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3051: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3051"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3051: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3051"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3051"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3053"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3053"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3053"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3053"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3053"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3053"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3053"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3053: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3053"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3054"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3054"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3054"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3054"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3054"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3054"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3054"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3054: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3054"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



# Add different extension headers
cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a50540000000986dd60000000002c00fffc000000000000000000000000000001fc0000000000000000000000000000022c00000000000000110004f80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
packet-out in_port=1, packet=50540000000A50540000000986DD60000000050800FFFC000000000000000000000000000001FC0000000000000000000000000000022C000000000000001100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3062: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:3062"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3062"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3064: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3064"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3064"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3068: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3068"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3068: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3068"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3068: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3068"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3068" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3068: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3068"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3068: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3068"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3068" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3068: :; "
at_fn_check_prepare_trace "system-traffic.at:3068"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_71
#AT_START_72
at_fn_group_banner 72 'system-traffic.at:3071' \
  "conntrack - IPv6 fragmentation, multiple extension headers 2" "" 2
at_xfail=no
(
  $as_echo "72. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3073: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3073"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3073"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3073"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3073"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3073"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3073"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3073"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3073: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3073"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3073"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3076: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3076"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3076: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3076"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3078"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3078"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3078"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3078"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3079"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3079"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3079"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3079"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



# Add different extension headers
cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000A50540000000986DD60000000050800FFFC000000000000000000000000000001FC0000000000000000000000000000022C000000050200001100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
packet-out in_port=1, packet=50540000000a50540000000986dd60000000002c00fffc000000000000000000000000000001fc0000000000000000000000000000022c00000005020000110004f80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3087: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:3087"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3087"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3089: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3089"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3093: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3093"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3093: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3093"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3093: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3093"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3093" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3093: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3093"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3093: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3093"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3093" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3093: :; "
at_fn_check_prepare_trace "system-traffic.at:3093"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3093"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_72
#AT_START_73
at_fn_group_banner 73 'system-traffic.at:3096' \
  "conntrack - IPv6 fragmentation, multiple extension headers 2 + out of order" "" 2
at_xfail=no
(
  $as_echo "73. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3098: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3098"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3098"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3098"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3098"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3098"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3098"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3098"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3098: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3098"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }






ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3101: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3101"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3101: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3101"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3103"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3103"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3103"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3103"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3104"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3104"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3104"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3104"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3104"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3104"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3104"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3104: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3104"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



# Add different extension headers
cat >bundle.txt <<'_ATEOF'
packet-out in_port=1, packet=50540000000a50540000000986dd60000000002c00fffc000000000000000000000000000001fc0000000000000000000000000000022c00000005020000110004f80000000100010002000800000001020304050607080900010203040506070809, actions=ct(commit)
packet-out in_port=1, packet=50540000000A50540000000986DD60000000050800FFFC000000000000000000000000000001FC0000000000000000000000000000022C000000050200001100000100000001000100020008267100010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090001020304050607080900010203040506070809000102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070809001020304050607080900102030405060708090010203040506070,  actions=ct(commit)
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3112: ovs-ofctl bundle br0 bundle.txt"
at_fn_check_prepare_trace "system-traffic.at:3112"
( $at_check_trace; ovs-ofctl bundle br0 bundle.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3114: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3114"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3118: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3118"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3118: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3118"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3118: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3118"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3118" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3118: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3118"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3118: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3118"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3118" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3118: :; "
at_fn_check_prepare_trace "system-traffic.at:3118"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_73
#AT_START_74
at_fn_group_banner 74 'system-traffic.at:3121' \
  "conntrack - Fragmentation over vxlan" "           " 2
at_xfail=no
(
  $as_echo "74. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3122" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep dstport >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3122"
     $as_echo "system-traffic.at:3122" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3122"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3126: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3126"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3126"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3126"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3126"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3126"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3126"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3126"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3126: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3126"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
{ set +x
$as_echo "$at_srcdir/system-traffic.at:3128: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:3128"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3128"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3130: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3130"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3130"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,icmp,action=ct(commit,zone=9),LOCAL
priority=100,in_port=LOCAL,icmp,action=ct(table=1,zone=9)
table=1,in_port=LOCAL,ct_state=+trk+est,icmp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3141: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3141"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3141"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3144"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3144"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3144"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3144"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3144"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3144"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3144"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3144: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3144"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3145: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:3145"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3146: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:3146"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3150: ovs-vsctl add-port br0 at_vxlan0 -- \\
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3150"
( $at_check_trace; ovs-vsctl add-port br0 at_vxlan0 -- \
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3150: ip addr add dev br0 10.1.1.100/24"
at_fn_check_prepare_trace "system-traffic.at:3150"
( $at_check_trace; ip addr add dev br0 10.1.1.100/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3150: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:3150"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3150: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:3150"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.100/24'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3151: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3151"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:3151: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3151"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:3151: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3151"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





 { set +x
$as_echo "$at_srcdir/system-traffic.at:3155: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3155"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3155"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:3160: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3160"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3163: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3163"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3163"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3166: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3166"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3166"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3170: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3170"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3170: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3170"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3170: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3170"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3170" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3170: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3170"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3170: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3170"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3170" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3170: :; "
at_fn_check_prepare_trace "system-traffic.at:3170"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_74
#AT_START_75
at_fn_group_banner 75 'system-traffic.at:3173' \
  "conntrack - IPv6 Fragmentation over vxlan" "      " 2
at_xfail=no
(
  $as_echo "75. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3174" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep dstport >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3174"
     $as_echo "system-traffic.at:3174" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3174"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3178: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3178"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3178"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3178"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3178"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3178"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3178"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3178"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3178: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3178"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3178"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
{ set +x
$as_echo "$at_srcdir/system-traffic.at:3180: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-traffic.at:3180"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3182: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3182"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3182"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=100,in_port=1,ipv6,action=ct(commit,zone=9),LOCAL
priority=100,in_port=LOCAL,ipv6,action=ct(table=1,zone=9)
table=1,in_port=LOCAL,ct_state=+trk+est,ipv6,action=1

priority=1000,icmp6,icmp_type=135,action=normal
priority=1000,icmp6,icmp_type=136,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3196: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3196"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3199"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3199"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3199"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3199"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3199"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3199"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3199"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3199: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3199"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3199"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3200: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-traffic.at:3200"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3200"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3201: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-traffic.at:3201"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3205: ovs-vsctl add-port br0 at_vxlan0 -- \\
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1 "
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3205"
( $at_check_trace; ovs-vsctl add-port br0 at_vxlan0 -- \
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3205"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3205: ip addr add dev br0 \"fc00::2/96\""
at_fn_check_prepare_trace "system-traffic.at:3205"
( $at_check_trace; ip addr add dev br0 "fc00::2/96"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3205"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3205: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:3205"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3205"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-traffic.at:3205: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-traffic.at:3205"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3205"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 "fc00::2/96"'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3206: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3206"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan remote 172.31.1.100 id 0 dstport 4789
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3206"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:3206: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 \"fc00::1/96\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3206"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 "fc00::1/96"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3206"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:3206: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3206"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450  up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3206"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3212" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3215: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3215"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:3220: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3220"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3223: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3223"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 1600 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3226: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3226"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -s 3200 -q -c 3 -i 0.3 -w 2 fc00::2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3230: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3230"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3230: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3230"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3230: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3230"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3230" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3230: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3230"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3230: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3230"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3230" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3230: :; "
at_fn_check_prepare_trace "system-traffic.at:3230"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_75
#AT_START_76
at_fn_group_banner 76 'system-traffic.at:3233' \
  "conntrack - resubmit to ct multiple times" "      " 2
at_xfail=no
(
  $as_echo "76. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3236: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3236"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3236"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3236"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3236"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3236"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3236"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3236"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3236: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set-fail-mode br0 secure --  "
at_fn_check_prepare_trace "system-traffic.at:3236"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set-fail-mode br0 secure --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3239: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3239"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3239"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3239: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3239"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3239"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3241"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3241"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3241"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3241"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3241"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3241"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3241"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3241: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3241"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3242"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3242"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3242"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3242"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3242"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3242"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3242"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3242: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3242"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3242"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,priority=150,arp,action=normal
table=0,priority=100,ip,in_port=1,action=resubmit(,1),resubmit(,2)

table=1,ip,action=ct(table=3)
table=2,ip,action=ct(table=3)

table=3,ip,action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3254: ovs-ofctl add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3254"
( $at_check_trace; ovs-ofctl add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3256: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3256"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1 packets transmitted, 0 received, 100% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3260: ovs-ofctl dump-flows br0 | ofctl_strip | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3260"
( $at_check_trace; ovs-ofctl dump-flows br0 | ofctl_strip | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=98, priority=100,ip,in_port=1 actions=resubmit(,1),resubmit(,2)
 n_packets=2, n_bytes=84, priority=150,arp actions=NORMAL
 table=1, n_packets=1, n_bytes=98, ip actions=ct(table=3)
 table=2, n_packets=1, n_bytes=98, ip actions=ct(table=3)
 table=3, n_packets=2, n_bytes=196, ip actions=drop
NXST_FLOW reply:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3260"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3269: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3269"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3269: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3269"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3269: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3269"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3269" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3269: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3269"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3269: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3269"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3269" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3269: :; "
at_fn_check_prepare_trace "system-traffic.at:3269"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_76
#AT_START_77
at_fn_group_banner 77 'system-traffic.at:3272' \
  "conntrack - zone-based timeout policy" "          " 2
at_xfail=no
(
  $as_echo "77. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



    $as_echo "system-traffic.at:3274" >"$at_check_line_file"
(! cat /boot/config-$(uname -r) | grep NF_CONNTRACK_TIMEOUT | grep '=y' > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3274"
    modprobe nfnetlink_cttimeout
    on_exit 'modprobe -r nfnetlink_cttimeout'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3275: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3275"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3275"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3275"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3275"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3275"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3275"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3275"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3275: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3275"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3275"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3277: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3277"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3277"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3277: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3277"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3277"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3279"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3279"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3279"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3279"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3279"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3279"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3279"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3279: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3279"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3280"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3280"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3280"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3280"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3280"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3280"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3280"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3280: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3280"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,ip,action=ct(zone=5, table=1)
priority=100,in_port=2,ip,action=ct(zone=5, table=1)
table=1,in_port=2,ip,ct_state=+trk+est,action=1
table=1,in_port=1,ip,ct_state=+trk+new,action=ct(commit,zone=5),2
table=1,in_port=1,ip,ct_state=+trk+est,action=2
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3292: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3292"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3292"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:3299: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3299"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3299"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3302: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3302"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3302"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 4

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3306: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3306"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=5
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3306"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3311: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:3311"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    { set +x
$as_echo "$at_srcdir/system-traffic.at:3316: ovs-vsctl -- --id=@m create Datapath datapath_version=0 -- set Open_vSwitch . datapaths:\"system\"=@m"
at_fn_check_prepare_trace "system-traffic.at:3316"
( $at_check_trace; ovs-vsctl -- --id=@m create Datapath datapath_version=0 -- set Open_vSwitch . datapaths:"system"=@m
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3316"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    DP_TYPE=$(echo "system")


for i in `seq 1 255`; do
ovs-vsctl --may-exist add-zone-tp $DP_TYPE zone=$i udp_first=$i udp_single=$i icmp_first=$i icmp_reply=$i;
done
{ set +x
$as_echo "$at_srcdir/system-traffic.at:3322: ovs-vsctl --may-exist add-zone-tp \$DP_TYPE zone=5 udp_first=1 udp_single=1 icmp_first=1 icmp_reply=1"
at_fn_check_prepare_dynamic "ovs-vsctl --may-exist add-zone-tp $DP_TYPE zone=5 udp_first=1 udp_single=1 icmp_first=1 icmp_reply=1" "system-traffic.at:3322"
( $at_check_trace; ovs-vsctl --may-exist add-zone-tp $DP_TYPE zone=5 udp_first=1 udp_single=1 icmp_first=1 icmp_reply=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3322"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3325: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3325"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3325"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3328: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3328"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3328"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3330: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3330"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=5
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3330"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 6

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3339: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3339"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3339"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3343: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3343"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3343"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3346: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3346"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3346"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3348: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3348"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=5
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3348"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 6

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3357: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3357"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3357"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3361: ovs-vsctl del-zone-tp \$DP_TYPE zone=5"
at_fn_check_prepare_dynamic "ovs-vsctl del-zone-tp $DP_TYPE zone=5" "system-traffic.at:3361"
( $at_check_trace; ovs-vsctl del-zone-tp $DP_TYPE zone=5
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3364: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3364"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3364"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3367: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3367"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 1

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3371: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3371"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=5
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3371"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3376: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3376"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3376: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3376"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3376: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3376"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3376" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3376: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3376"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3376: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3376"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3376" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3376: :; "
at_fn_check_prepare_trace "system-traffic.at:3376"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_77
#AT_START_78
at_fn_group_banner 78 'system-traffic.at:3381' \
  "conntrack - fragment reassembly with L3 L4 protocol information" "" 2
at_xfail=no
(
  $as_echo "78. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3384: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3384"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3384"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3384"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3384"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3384"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3384"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3384"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3384: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3384"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3384"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3390: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3390"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3390"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3392: ovs-ofctl packet-out br0 \"packet=52540003287c525400444ab586dd6006f70605b02c4020010001000000000000000000000020200100010000000000000000000000101100000134e88deb13891389080803136161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616\"\"16161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161\"\"61616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616\"\"1616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161, actions=ct(table=1)\""
at_fn_check_prepare_trace "system-traffic.at:3392"
( $at_check_trace; ovs-ofctl packet-out br0 "packet=52540003287c525400444ab586dd6006f70605b02c4020010001000000000000000000000020200100010000000000000000000000101100000134e88deb13891389080803136161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616""16161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161""61616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616""1616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161, actions=ct(table=1)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3392"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3397: ovs-ofctl packet-out br0 \"packet=52540003287c525400444ab586dd6006f70602682c402001000100000000000000000000002020010001000000000000000000000010110005a834e88deb6161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616\"\"161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161, actions=ct(table=1)\""
at_fn_check_prepare_trace "system-traffic.at:3397"
( $at_check_trace; ovs-ofctl packet-out br0 "packet=52540003287c525400444ab586dd6006f70602682c402001000100000000000000000000002020010001000000000000000000000010110005a834e88deb6161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616""161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161, actions=ct(table=1)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3397"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3400: ovs-ofctl packet-out br0 \"packet=52540003287c525400444ab586dd6006f706033d1140200100010000000000000000000000202001000100000000000000000000001013891389033d923861616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616\"\"1616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161610a, actions=ct(table=1)\""
at_fn_check_prepare_trace "system-traffic.at:3400"
( $at_check_trace; ovs-ofctl packet-out br0 "packet=52540003287c525400444ab586dd6006f706033d1140200100010000000000000000000000202001000100000000000000000000001013891389033d923861616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616""1616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161610a, actions=ct(table=1)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3400"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3403: ovs-appctl dpctl/dump-flows | head -2 | tail -1 | grep -q -e \"udp(src=5001\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3403"
( $at_check_trace; ovs-appctl dpctl/dump-flows | head -2 | tail -1 | grep -q -e "udp(src=5001"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3403"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3405: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3405"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3405: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3405"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3405: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3405"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3405" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3405: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3405"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3405: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3405"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3405" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3405: :; "
at_fn_check_prepare_trace "system-traffic.at:3405"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_78
#AT_START_79
at_fn_group_banner 79 'system-traffic.at:3410' \
  "conntrack - IPv4 HTTP" "                          " 3
at_xfail=no
(
  $as_echo "79. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3412: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3412"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3412"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3412"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3412"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3412"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3412"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3412"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3412: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3412"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3414: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3414"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3414"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3414: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3414"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3414"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3416"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3416"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3416"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3416"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3416"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3416"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3416"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3416: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3416"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3417"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3417"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3417"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3417"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3417"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3417"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3417"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3417: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3417"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,action=ct(commit),2
priority=100,in_port=2,ct_state=-trk,tcp,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk+est,tcp,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3429: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3429"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3429"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3431" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3432" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3435: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3435"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3436: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3436"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3436"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3442: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget 10.1.1.1 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3442"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget 10.1.1.1 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:3442"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3444: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3444"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3444: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3444"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3444: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3444"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3444" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3444: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3444"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3444: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3444"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3444" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3444: :; "
at_fn_check_prepare_trace "system-traffic.at:3444"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3444"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_79
#AT_START_80
at_fn_group_banner 80 'system-traffic.at:3447' \
  "conntrack - IPv6 HTTP" "                          " 3
at_xfail=no
(
  $as_echo "80. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3449: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3449"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3449"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3449"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3449"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3449"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3449"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3449"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3449: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3449"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3449"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3451: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3451"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3451"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3451: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3451"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3451"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3453"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3453"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3453"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3453"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3453"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3453"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3453"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3453: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3453"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3454"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3454"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3454"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3454"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3454"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3454"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3454"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3454: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3454"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,icmp6,action=normal
priority=100,in_port=1,tcp6,action=ct(commit),2
priority=100,in_port=2,ct_state=-trk,tcp6,action=ct(table=0)
priority=100,in_port=2,ct_state=+trk+est,tcp6,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3465: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3465"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3465"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3470" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


PIDFILE=$(mktemp http6XXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py http6 & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http6 | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3472" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp http6XXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http6 & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http6 | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3473" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3476: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::2] -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3476"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::2] -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3476"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3477: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3477"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3483: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget http://[fc00::1] -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3483"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget http://[fc00::1] -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:3483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3485: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3485"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3485: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3485"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3485: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3485"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3485" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3485: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3485"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3485: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3485"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3485" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3485: :; "
at_fn_check_prepare_trace "system-traffic.at:3485"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_80
#AT_START_81
at_fn_group_banner 81 'system-traffic.at:3488' \
  "conntrack - commit, recirc" "                     " 3
at_xfail=no
(
  $as_echo "81. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3490: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3490"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3490"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3490"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3490"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3490"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3490"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3490"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3490: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3490"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3492: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3492"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3492"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3492: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3492"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3492"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3492: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3492"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3492"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3492: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3492"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3492"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3494"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3494"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3494"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3494"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3494"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3494"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3494"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3494: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3494"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3495"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3495"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3495"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3495"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3495"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3495"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3495"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3495: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3495"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3496"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:3496"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:3496"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3496"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3496"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3496"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3496"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3496: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3496"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3496"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3497"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:3497"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:3497"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3497"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3497"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3497"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3497"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3497: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3497"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3497"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=10,icmp,action=normal
priority=100,in_port=1,tcp,ct_state=-trk,action=ct(commit,table=0)
priority=100,in_port=1,tcp,ct_state=+trk,action=2
priority=100,in_port=2,tcp,ct_state=-trk,action=ct(table=0)
priority=100,in_port=2,tcp,ct_state=+trk,action=1
priority=100,in_port=3,tcp,ct_state=-trk,action=set_field:0->metadata,ct(table=0)
priority=100,in_port=3,tcp,ct_state=+trk,metadata=0,action=set_field:1->metadata,ct(commit,table=0)
priority=100,in_port=3,tcp,ct_state=+trk,metadata=1,action=4
priority=100,in_port=4,tcp,ct_state=-trk,action=ct(commit,table=0)
priority=100,in_port=4,tcp,ct_state=+trk,action=3
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3515: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3515"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3515"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3517" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3518" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3521: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3521"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3521"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:3524: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3524"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
wget 10.1.1.4 -t 3 -T 1 --retry-connrefused -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3526: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3526"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3526: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3526"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3526: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3526"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3526" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3526: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3526"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3526: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3526"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3526" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3526: :; "
at_fn_check_prepare_trace "system-traffic.at:3526"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_81
#AT_START_82
at_fn_group_banner 82 'system-traffic.at:3529' \
  "conntrack - multiple zones, local" "              " 3
at_xfail=no
(
  $as_echo "82. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3532: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3532"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3532"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3532"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3532"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3532"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3532"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3532"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3532: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3532"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3532"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3534: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3534"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3534"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3536: ip addr add dev br0 \"10.1.1.1/24\""
at_fn_check_prepare_trace "system-traffic.at:3536"
( $at_check_trace; ip addr add dev br0 "10.1.1.1/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3536"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3537: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:3537"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3537"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip addr del dev br0 "10.1.1.1/24"'
 { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3539"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3539"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3539"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3539"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3539"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3539"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3539"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3539: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3539"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3539"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=LOCAL,ip,ct_state=-trk,action=drop
priority=100,in_port=LOCAL,ip,ct_state=+trk+new,action=ct(commit,zone=1),ct(commit,zone=2),1
priority=100,in_port=LOCAL,ip,ct_state=+trk+est,action=ct(commit,zone=1),ct(commit,zone=2),1
priority=100,in_port=1,ip,ct_state=-trk,action=ct(table=1,zone=1)
table=1,in_port=1,ip,ct_state=+trk+est,ct_zone=1,action=ct(table=2,zone=2)
table=2,in_port=1,ip,ct_state=+trk+est,ct_zone=2,action=LOCAL
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3554: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3554"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3556: ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3556"
( $at_check_trace; ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3556"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3560" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3563: wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log"
at_fn_check_prepare_trace "system-traffic.at:3563"
( $at_check_trace; wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3566: wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log"
at_fn_check_prepare_trace "system-traffic.at:3566"
( $at_check_trace; wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3566"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3568: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | grep \"zone\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3568"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | grep "zone"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=1
icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=2
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3568"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3575: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3575"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3575: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3575"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3575: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3575"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3575" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3575: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3575"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3575: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3575"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3575" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3575: :; "
at_fn_check_prepare_trace "system-traffic.at:3575"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3575"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_82
#AT_START_83
at_fn_group_banner 83 'system-traffic.at:3578' \
  "conntrack - multi-stage pipeline, local" "        " 3
at_xfail=no
(
  $as_echo "83. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3581: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3581"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3581"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3581"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3581"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3581"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3581"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3581"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3581: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3581"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3581"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3583: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3583"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3583"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3585: ip addr add dev br0 \"10.1.1.1/24\""
at_fn_check_prepare_trace "system-traffic.at:3585"
( $at_check_trace; ip addr add dev br0 "10.1.1.1/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3585"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3586: ip link set dev br0 up"
at_fn_check_prepare_trace "system-traffic.at:3586"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3586"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip addr del dev br0 "10.1.1.1/24"'
 { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3588"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3588"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3588"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3588"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'



cat >flows.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal

table=0,priority=100,ip,in_port=LOCAL,action=load:1->NXM_NX_REG0[0..15],goto_table:1
table=0,priority=100,ip,in_port=1,action=load:65534->NXM_NX_REG0[0..15],goto_table:1

table=1,priority=150,in_port=LOCAL,ip,ct_state=+trk+new,action=ct(commit,table=2,zone=OXM_OF_IN_PORT[0..15])
table=1,priority=100,ip,action=ct(table=2,zone=OXM_OF_IN_PORT[0..15])
table=1,priority=1,action=drop

table=2,priority=150,in_port=LOCAL,ip,ct_state=+trk+new,action=ct(commit,table=4,zone=NXM_NX_REG0[0..15])
table=2,priority=100,ip,ct_state=+trk+est,action=ct(table=3,zone=NXM_NX_REG0[0..15])
table=2,priority=1,action=drop

table=3,priority=100,ip,ct_state=+trk+est,action=goto_table:4
table=3,priority=1,action=drop

table=4,priority=100,ip,action=output:NXM_NX_REG0[]
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3625: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3625"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3625"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3627: ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3627"
( $at_check_trace; ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3627"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3631" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




{ set +x
$as_echo "$at_srcdir/system-traffic.at:3634: wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log"
at_fn_check_prepare_trace "system-traffic.at:3634"
( $at_check_trace; wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3634"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3637: wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log"
at_fn_check_prepare_trace "system-traffic.at:3637"
( $at_check_trace; wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3637"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3639: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | grep \"zone\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3639"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | grep "zone"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=1
icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.1,id=<cleared>,type=0,code=0),zone=65534
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=65534,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3639"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3646: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3646"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3646: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3646"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3646: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3646"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3646" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3646: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3646"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3646: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3646"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3646" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3646: :; "
at_fn_check_prepare_trace "system-traffic.at:3646"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_83
#AT_START_84
at_fn_group_banner 84 'system-traffic.at:3649' \
  "conntrack - limit by zone" "                      " 3
at_xfail=no
(
  $as_echo "84. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3651: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3651"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3651"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3651"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3651"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3651"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3651"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3651"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3651: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3651"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3653: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3653"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3653"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3653: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3653"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3653"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3655"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3655"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3655"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3655"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3655"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3655"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3655"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3655: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3655"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3655"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3656"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3656"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3656"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3656"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3656"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3656"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3656"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3656: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3656"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3656"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,arp,action=normal
priority=100,in_port=1,udp,action=ct(commit),2
priority=100,in_port=2,udp,action=ct(zone=3,commit),1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3665: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3665"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3665"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3667: ovs-appctl dpctl/ct-set-limits default=10 zone=0,limit=5 zone=1,limit=15 zone=2,limit=3 zone=3,limit=3"
at_fn_check_prepare_trace "system-traffic.at:3667"
( $at_check_trace; ovs-appctl dpctl/ct-set-limits default=10 zone=0,limit=5 zone=1,limit=15 zone=2,limit=3 zone=3,limit=3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3667"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3668: ovs-appctl dpctl/ct-del-limits zone=1,2,4"
at_fn_check_prepare_trace "system-traffic.at:3668"
( $at_check_trace; ovs-appctl dpctl/ct-del-limits zone=1,2,4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3669: ovs-appctl dpctl/ct-get-limits zone=0,1,2,3"
at_fn_check_prepare_trace "system-traffic.at:3669"
( $at_check_trace; ovs-appctl dpctl/ct-get-limits zone=0,1,2,3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "default limit=10
zone=0,limit=5,count=0
zone=1,limit=10,count=0
zone=2,limit=10,count=0
zone=3,limit=3,count=0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3669"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3678: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3678"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3678"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3679: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000300080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3679"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000300080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3679"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3680: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000400080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3680"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000400080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3680"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3681: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000500080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3681"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000500080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3682: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000600080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3682"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000600080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3682"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3683: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000700080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3683"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000700080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3683"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3684: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000800080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3684"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000800080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3684"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3685: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000900080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3685"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000900080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3685"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3686: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000a00080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3686"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=1 packet=50540000000a50540000000908004500001c000000000011a4cd0a0101010a0101020001000a00080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3686"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3688: ovs-appctl dpctl/ct-get-limits zone=0,1,2,3,4,5"
at_fn_check_prepare_trace "system-traffic.at:3688"
( $at_check_trace; ovs-appctl dpctl/ct-get-limits zone=0,1,2,3,4,5
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "default limit=10
zone=0,limit=5,count=5
zone=1,limit=10,count=0
zone=2,limit=10,count=0
zone=3,limit=3,count=0
zone=4,limit=10,count=0
zone=5,limit=10,count=0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3688"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3699: ovs-appctl dpctl/ct-get-limits"
at_fn_check_prepare_trace "system-traffic.at:3699"
( $at_check_trace; ovs-appctl dpctl/ct-get-limits
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "default limit=10
zone=0,limit=5,count=5
zone=3,limit=3,count=0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3699"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3705: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.1,\" | sort "
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3705"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.1," | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=2),reply=(src=10.1.1.2,dst=10.1.1.1,sport=2,dport=1)
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=3),reply=(src=10.1.1.2,dst=10.1.1.1,sport=3,dport=1)
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=4),reply=(src=10.1.1.2,dst=10.1.1.1,sport=4,dport=1)
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=5),reply=(src=10.1.1.2,dst=10.1.1.1,sport=5,dport=1)
udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=1,dport=6),reply=(src=10.1.1.2,dst=10.1.1.1,sport=6,dport=1)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3714: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000200080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3714"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000200080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3714"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3715: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000300080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3715"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000300080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3715"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3716: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000400080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3716"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000400080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3716"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3717: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000500080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3717"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000500080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3717"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3718: ovs-ofctl -O OpenFlow13 packet-out br0 \"in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000600080000 actions=resubmit(,0)\""
at_fn_check_prepare_trace "system-traffic.at:3718"
( $at_check_trace; ovs-ofctl -O OpenFlow13 packet-out br0 "in_port=2 packet=50540000000a50540000000908004500001c000000000011a4c90a0101030a0101040001000600080000 actions=resubmit(,0)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3718"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3720: ovs-appctl dpctl/ct-get-limits zone=0,3"
at_fn_check_prepare_trace "system-traffic.at:3720"
( $at_check_trace; ovs-appctl dpctl/ct-get-limits zone=0,3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "default limit=10
zone=0,limit=5,count=5
zone=3,limit=3,count=3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3726: ovs-appctl dpctl/dump-conntrack | grep \"orig=.src=10\\.1\\.1\\.3,\" | sort "
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3726"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "orig=.src=10\.1\.1\.3," | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=1,dport=2),reply=(src=10.1.1.4,dst=10.1.1.3,sport=2,dport=1),zone=3
udp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=1,dport=3),reply=(src=10.1.1.4,dst=10.1.1.3,sport=3,dport=1),zone=3
udp,orig=(src=10.1.1.3,dst=10.1.1.4,sport=1,dport=4),reply=(src=10.1.1.4,dst=10.1.1.3,sport=4,dport=1),zone=3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3726"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3732: check_logs \"/could not create datapath/d
/(Cannot allocate memory) on packet/d\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3732"
( $at_check_trace; check_logs "/could not create datapath/d
/(Cannot allocate memory) on packet/d"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3732: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3732"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3732: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3732"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3732" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3732: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3732"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3732: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3732"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3732" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3732: :; "
at_fn_check_prepare_trace "system-traffic.at:3732"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3732"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_84
#AT_START_85
at_fn_group_banner 85 'system-traffic.at:3737' \
  "FTP - no conntrack" "                             " 3
at_xfail=no
(
  $as_echo "85. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3738" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3738"
{ set +x
$as_echo "$at_srcdir/system-traffic.at:3739: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3739"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3739"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3739"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3739"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3739"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3739"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3739"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3739: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3739"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3739"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3741: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3741"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3741"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3741: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3741"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3741"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3743"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3743"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3743"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3743"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3743"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3743"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3743"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3743: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3743"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3744"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3744"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3744"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3744"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3744"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3744"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3744"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3744: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3744"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3744"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,action=normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3750: ovs-ofctl --bundle replace-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3750"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3750"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > ftp1.pid
     echo "kill \`cat ftp1.pid\`" >> cleanup


ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > ftp0.pid
     echo "kill \`cat ftp0.pid\`" >> cleanup


ovs_wait_cond () {
    ip netns exec at_ns1 netstat -l | grep ftp
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3754" "until ip netns exec at_ns1 netstat -l | grep ftp"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3757: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3757"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3757"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3759: find -name index.html"
at_fn_check_prepare_trace "system-traffic.at:3759"
( $at_check_trace; find -name index.html
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "./index.html
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3759"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3763: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3763"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3763: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3763"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3763: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3763"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3763" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3763: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3763"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3763: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3763"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3763" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3763: :; "
at_fn_check_prepare_trace "system-traffic.at:3763"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3763"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_85
#AT_START_86
at_fn_group_banner 86 'system-traffic.at:3766' \
  "conntrack - FTP" "                                " 3
at_xfail=no
(
  $as_echo "86. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3767" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3767"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3770: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3770"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3770"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3770"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3770"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3770"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3770"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3770"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3770: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3770"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3772: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3772"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3772"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3772: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3772"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3772"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3774"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3774"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3774"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3774"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3774"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3774"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3774"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3774: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3774"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3774"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3775"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3775"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3775"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3775"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows1.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,tcp,action=ct(alg=ftp,commit),2
table=0,priority=100,in_port=2,tcp,action=ct(table=1)
table=1,in_port=2,tcp,ct_state=+trk+est,action=1
table=1,in_port=2,tcp,ct_state=+trk+rel,action=1
_ATEOF


cat >flows2.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal

table=0,priority=100,in_port=1,tcp,action=ct(table=1)
table=1,in_port=1,tcp,ct_state=+trk+new,action=ct(commit,alg=ftp),2
table=1,in_port=1,tcp,ct_state=+trk+est,action=2

table=0,priority=100,in_port=2,tcp,action=ct(table=1)
table=1,in_port=2,tcp,ct_state=+trk+new+rel,action=ct(commit),1
table=1,in_port=2,tcp,ct_state=+trk+est,action=1
table=1,in_port=2,tcp,ct_state=+trk-new+rel,action=1
_ATEOF


cat >flows3.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,tcp,action=ct(commit),2
table=0,priority=100,in_port=2,tcp,action=ct(table=1)
table=1,in_port=2,tcp,ct_state=+trk+est,action=1
table=1,in_port=2,tcp,ct_state=+trk+rel,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3817: ovs-ofctl --bundle replace-flows br0 flows1.txt"
at_fn_check_prepare_trace "system-traffic.at:3817"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows1.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3817"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3819" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3820" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3824: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3824"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:3824"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3825: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3825"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3825"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3829: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3829"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3830: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3830"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3830"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3835: ovs-ofctl --bundle replace-flows br0 flows2.txt"
at_fn_check_prepare_trace "system-traffic.at:3835"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows2.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3835"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3836: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:3836"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3836"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3840: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3840"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:3840"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3841: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3841"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3841"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3845: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0-1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3845"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0-1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3845"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3846: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3846"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3846"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3851: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:3851"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3854: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0-2.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3854"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0-2.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3854"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3855: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3855"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3860: ovs-ofctl --bundle replace-flows br0 flows3.txt"
at_fn_check_prepare_trace "system-traffic.at:3860"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows3.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3860"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:3861: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:3861"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3861"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3864: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0-3.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3864"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0-3.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:3864"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3865: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3865"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3865"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3869: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3869"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3869: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3869"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3869: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3869"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3869" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3869: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3869"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3869: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3869"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3869" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3869: :; "
at_fn_check_prepare_trace "system-traffic.at:3869"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_86
#AT_START_87
at_fn_group_banner 87 'system-traffic.at:3872' \
  "conntrack - FTP over IPv6" "                      " 3
at_xfail=no
(
  $as_echo "87. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3873" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3873"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3876: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3876"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3876"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3876"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3876"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3876"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3876"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3876"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3876: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3876"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3876"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3878: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3878"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3878: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3878"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3878"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3880"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3880"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3880"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3880"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3880"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3880"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3880"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3880: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3880"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3880"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3881"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3881"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3881"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3881"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3881"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3881"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3881"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3881: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3881"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3881"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0 priority=100 in_port=1 icmp6, action=2
table=0 priority=100 in_port=2 icmp6, action=1
table=0 priority=10 ip6, action=ct(table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new, tcp6, tp_dst=21, action=ct(alg=ftp,commit),2
table=1 in_port=2 ct_state=+new+rel, tcp6, action=ct(commit),1
table=1 in_port=1 ct_state=+est, tcp6, action=2
table=1 in_port=2 ct_state=+est, tcp6, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3906: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3906"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3911" "until ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3913" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3916: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3916"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3916"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3919: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3919"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),reply=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3919"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3924: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3924"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3924: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3924"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3924: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3924"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3924" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3924: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3924"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3924: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3924"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3924" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3924: :; "
at_fn_check_prepare_trace "system-traffic.at:3924"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_87
#AT_START_88
at_fn_group_banner 88 'system-traffic.at:3927' \
  "conntrack - IPv6 FTP Passive" "                   " 3
at_xfail=no
(
  $as_echo "88. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3928" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3928"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3931: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3931"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3931"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3931"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3931"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3931"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3931"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3931"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3931: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3931"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3933: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3933"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3933"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3933: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3933"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3933"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3935"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3935"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3935"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3935"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3935"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3935"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3935"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3935: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3935"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3935"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3936: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3936"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3937"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3937"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3937"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3937"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3937"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3937"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3937"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3937: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3937"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3937"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3938: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:99
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3938"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:99
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3938"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3939: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:99 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3939"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:99 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3939"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3940: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3940"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=100 in_port=1 icmp6, action=2
table=0 priority=100 in_port=2 icmp6, action=1
table=0 priority=10 ip6, action=ct(table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new, tcp6, tp_dst=21, action=ct(alg=ftp,commit),2
table=1 in_port=1 ct_state=+new+rel, tcp6, action=ct(commit),2
table=1 in_port=1 ct_state=+est, tcp6, action=2
table=1 in_port=2 ct_state=+est, tcp6, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3965: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:3965"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3970" "until ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3972" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3975: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3975"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3978: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:3978"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:3983: check_logs "
at_fn_check_prepare_trace "system-traffic.at:3983"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3983: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:3983"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3983: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:3983"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3983" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3983: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:3983"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3983: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:3983"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:3983" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:3983: :; "
at_fn_check_prepare_trace "system-traffic.at:3983"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_88
#AT_START_89
at_fn_group_banner 89 'system-traffic.at:3986' \
  "conntrack - FTP with multiple expectations" "     " 3
at_xfail=no
(
  $as_echo "89. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:3987" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:3987"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:3990: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:3990"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:3990"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:3990"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3990"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:3990"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:3990"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3990"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3990: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:3990"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3992: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3992"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:3992: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3992"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3994"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:3994"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:3994"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3994"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3994"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3994"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3994"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3994: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3994"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3994"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:3995"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:3995"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:3995"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3995"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3995"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3995"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3995"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:3995: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:3995"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:3995"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal

table=0,priority=100,in_port=1,tcp,action=ct(table=1,zone=1)
table=1,in_port=1,tcp,ct_zone=1,ct_state=+trk+new-rel,action=ct(commit,alg=ftp,zone=1),ct(commit,alg=ftp,zone=2),2
table=1,in_port=1,tcp,ct_zone=1,ct_state=+trk+new+rel,action=ct(commit,zone=1),ct(commit,zone=2),2
table=1,in_port=1,tcp,ct_zone=1,ct_state=+trk+est,action=ct(table=2,zone=2)
table=2,in_port=1,tcp,ct_zone=2,ct_state=+trk+est,action=2

table=0,priority=100,in_port=2,tcp,action=ct(table=1,zone=2)
table=1,in_port=2,tcp,ct_zone=2,ct_state=+trk+rel,action=ct(commit,zone=2),ct(commit,zone=1),1
table=1,in_port=2,tcp,ct_zone=2,ct_state=+trk+est,action=ct(table=2,zone=1)
table=2,in_port=2,tcp,ct_zone=1,ct_state=+trk+rel,action=ct(commit,zone=2),ct(commit,zone=1),1
table=2,in_port=2,tcp,ct_zone=1,ct_state=+trk+est,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4018: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4018"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4020" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4021" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4025: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4025"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.1 --no-passive-ftp  -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:4025"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4026: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4026"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4026"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4030: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4030"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4030"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4031: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4031"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4031"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4038: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:4038"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4041: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4041"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4041"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4042: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4042"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=2,protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4049: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4049"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4049: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4049"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4049: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4049"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4049" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4049: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4049"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4049: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4049"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4049" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4049: :; "
at_fn_check_prepare_trace "system-traffic.at:4049"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_89
#AT_START_90
at_fn_group_banner 90 'system-traffic.at:4052' \
  "conntrack - TFTP" "                               " 3
at_xfail=no
(
  $as_echo "90. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:4053" >"$at_check_line_file"
(test $HAVE_TFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4053"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4056: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4056"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4056"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4056"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4056"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4056"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4056"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4056"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4056: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4056"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4056"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4058: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4058"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4058"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4058: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4058"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4058"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4060"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4060"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4060"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4060"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4060"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4060"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4060"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4060: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4060"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4061"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4061"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4061"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4061"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4061"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4061"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4061"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4061: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4061"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows1.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal
table=0,priority=100,in_port=1,udp,action=ct(alg=tftp,commit),2
table=0,priority=100,in_port=2,udp,action=ct(table=1)
table=1,in_port=2,udp,ct_state=+trk+est,action=1
table=1,in_port=2,udp,ct_state=+trk+rel,action=1
_ATEOF


cat >flows2.txt <<'_ATEOF'
table=0,priority=1,action=drop
table=0,priority=10,arp,action=normal
table=0,priority=10,icmp,action=normal

table=0,priority=100,in_port=1,udp,action=ct(table=1)
table=1,in_port=1,udp,ct_state=+trk+new-rel,action=ct(commit,alg=tftp),2
table=1,in_port=1,udp,ct_state=+trk+new+rel,action=ct(commit),2
table=1,in_port=1,udp,ct_state=+trk+est,action=2

table=0,priority=100,in_port=2,udp,action=ct(table=1)
table=1,in_port=2,udp,ct_state=+trk+est,action=1
table=1,in_port=2,udp,ct_state=+trk+new+rel,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4092: ovs-ofctl --bundle replace-flows br0 flows1.txt"
at_fn_check_prepare_trace "system-traffic.at:4092"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows1.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4092"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp tftpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py tftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo tftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4094" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp tftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py tftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo tftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4095" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4098: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
curl \$CURL_OPT tftp://10.1.1.1/flows1.txt -o foo 2>curl0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4098"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
curl $CURL_OPT tftp://10.1.1.1/flows1.txt -o foo 2>curl0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 28 $at_status "$at_srcdir/system-traffic.at:4098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4099: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4099"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4099"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl \$CURL_OPT tftp://10.1.1.2/flows1.txt -o foo 2>curl1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl $CURL_OPT tftp://10.1.1.2/flows1.txt -o foo 2>curl1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4104: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4104"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),helper=tftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4109: ovs-ofctl --bundle replace-flows br0 flows2.txt"
at_fn_check_prepare_trace "system-traffic.at:4109"
( $at_check_trace; ovs-ofctl --bundle replace-flows br0 flows2.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:4110: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:4110"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4110"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4113: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
curl \$CURL_OPT tftp://10.1.1.1/flows1.txt -o foo 2>curl2.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4113"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
curl $CURL_OPT tftp://10.1.1.1/flows1.txt -o foo 2>curl2.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 28 $at_status "$at_srcdir/system-traffic.at:4113"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4114: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4114"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4114"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4118: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl \$CURL_OPT tftp://10.1.1.2/flows1.txt -o foo 2>curl3.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4118"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl $CURL_OPT tftp://10.1.1.2/flows1.txt -o foo 2>curl3.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4119: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4119"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),helper=tftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4119"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4123: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4123"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4123: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4123"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4123: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4123"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4123" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4123: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4123"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4123: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4123"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4123" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4123: :; "
at_fn_check_prepare_trace "system-traffic.at:4123"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_90
#AT_START_91
at_fn_group_banner 91 'system-traffic.at:4128' \
  "conntrack - simple SNAT" "                        " 4
at_xfail=no
(
  $as_echo "91. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4131: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4131"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4131"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4131"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4131"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4131"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4131"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4131"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4131: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4131"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4131"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4133: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4133"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4133: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4133"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4135"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4135"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4135"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4135"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4135"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4135"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4135"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4135: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4135"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4136: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4136"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4137"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4137"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4137"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4137"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4137"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4137"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4137"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4137: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4137"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4137"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
in_port=1,ip,action=ct(commit,zone=1,nat(src=10.1.1.240-10.1.1.255)),2
in_port=2,ct_state=-trk,ip,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=+trk,ct_zone=1,ip,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a0101f0/0xfffffff0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4161: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4161"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4161"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4164" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4165: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4165"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4165"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4167: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4167"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.2XX,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4171: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4171"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4171: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4171"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4171: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4171"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4171" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4171: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4171"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4171: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4171"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4171" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4171: :; "
at_fn_check_prepare_trace "system-traffic.at:4171"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4171"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_91
#AT_START_92
at_fn_group_banner 92 'system-traffic.at:4174' \
  "conntrack - SNAT with ct_mark change on reply" "  " 4
at_xfail=no
(
  $as_echo "92. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4177: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4177"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4177"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4177"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4177"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4177"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4177"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4177"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4177: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4177"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4179: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4179"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4179"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4179: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4179"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4179"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4181"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4181"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4181"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4181"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4181"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4181"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4181"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4181: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4181"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4182: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4182"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4182"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4183: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4183"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4183"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4185"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4185"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4185"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4185"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4185"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4185"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4185"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4185: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4185"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4186: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4186"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4186"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4187: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4187"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
in_port=1,ip,action=ct(commit,zone=1,nat(src=10.1.1.240)),2
in_port=2,ct_state=-trk,ip,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=+trk,ct_zone=1,ip,action=ct(table=1,commit,zone=1,exec(set_field:1->ct_mark)),1
table=1,in_port=2,ct_mark=1,ct_state=+rpl,ct_zone=1,ip,action=1
priority=0,action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4203: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4203"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4203"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4206: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -c 1 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4206"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -c 1 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1 packets transmitted, 1 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4206"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4210: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4210"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.2XX,id=<cleared>,type=0,code=0),zone=1,mark=1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4214: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4214"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4214: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4214"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4214: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4214"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4214" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4214: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4214"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4214: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4214"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4214" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4214: :; "
at_fn_check_prepare_trace "system-traffic.at:4214"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4214"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_92
#AT_START_93
at_fn_group_banner 93 'system-traffic.at:4217' \
  "conntrack - SNAT with port range" "               " 4
at_xfail=no
(
  $as_echo "93. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4220: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4220"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4220"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4220"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4220"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4220"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4220"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4220"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4220: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4220"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4222: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4222"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4222"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4222: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4222"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4222"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4224"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4224"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4224"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4224"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4224"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4224"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4224"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4224: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4224"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4224"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4225: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4225"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4226"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4226"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4226"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4226"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4226"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4226"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4226"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4226: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4226"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
in_port=1,tcp,action=ct(commit,zone=1,nat(src=10.1.1.240-10.1.1.255:34567-34568,random)),2
in_port=2,ct_state=-trk,tcp,tp_dst=34567,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=-trk,tcp,tp_dst=34568,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=+trk,ct_zone=1,tcp,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a0101f0/0xfffffff0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4251: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4251"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4251"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4254" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4255: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4255"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4257: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4257"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.2XX,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4257"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4261: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4261"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4261: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4261"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4261: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4261"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4261" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4261: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4261"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4261: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4261"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4261" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4261: :; "
at_fn_check_prepare_trace "system-traffic.at:4261"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_93
#AT_START_94
at_fn_group_banner 94 'system-traffic.at:4264' \
  "conntrack - SNAT with port range using ICMP" "    " 4
at_xfail=no
(
  $as_echo "94. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4268: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4268"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4268"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4268"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4268"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4268"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4268"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4268"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4268: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4268"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4270: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4270"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4270: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4270"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4270"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4272"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4272"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4272"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4272"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4272"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4272"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4272"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4272: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4272"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4272"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4273: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4273"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4273"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4274"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4274"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4274"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4274"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4274"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4274"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4274"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4274: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4274"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4274"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
in_port=1,ip,action=ct(commit,zone=1,nat(src=10.1.1.240-10.1.1.255:20000)),2
in_port=2,ct_state=-trk,ip,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=+trk,ct_zone=1,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a0101f0/0xfffffff0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4298: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4298"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4298"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4301: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -c 1 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4301"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -c 1 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1 packets transmitted, 1 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4301"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4305: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4305"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmp,orig=(src=10.1.1.1,dst=10.1.1.2,id=<cleared>,type=8,code=0),reply=(src=10.1.1.2,dst=10.1.1.2XX,id=<cleared>,type=0,code=0),zone=1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4305"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4309: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4309"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4309: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4309"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4309: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4309"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4309" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4309: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4309"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4309: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4309"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4309" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4309: :; "
at_fn_check_prepare_trace "system-traffic.at:4309"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_94
#AT_START_95
at_fn_group_banner 95 'system-traffic.at:4312' \
  "conntrack - SNAT with port range with exhaustion" "" 4
at_xfail=no
(
  $as_echo "95. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4315: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4315"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4315"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4315"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4315"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4315"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4315"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4315"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4315: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4315"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4317: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4317"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4317: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4317"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4319"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4319"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4319"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4319"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4319"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4319"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4319"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4319: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4319"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4319"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4320: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4320"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4320"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4321"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4321"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4321"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4321"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4321"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4321"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4321"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4321: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4321"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4321"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
in_port=1,tcp,action=ct(commit,zone=1,nat(src=10.1.1.240:34568,random)),2
in_port=2,ct_state=-trk,tcp,tp_dst=34567,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=-trk,tcp,tp_dst=34568,action=ct(table=0,zone=1,nat)
in_port=2,ct_state=+trk,ct_zone=1,tcp,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a0101f0/0xfffffff0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4346: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4346"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4346"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4349" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4350: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 1 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4350"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 1 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4352: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 1 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4352"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 1 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:4352"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4354: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4354"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.2XX,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4354"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4358: check_logs \"/Unable to NAT due to tuple space exhaustion - if DoS attack, use firewalling and\\/or zone partitioning./d
/Dropped .* log messages in last .* seconds \\(most recently, .* seconds ago\\) due to excessive rate/d\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4358"
( $at_check_trace; check_logs "/Unable to NAT due to tuple space exhaustion - if DoS attack, use firewalling and\/or zone partitioning./d
/Dropped .* log messages in last .* seconds \(most recently, .* seconds ago\) due to excessive rate/d"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4358: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4358"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4358: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4358"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4358" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4358: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4358"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4358: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4358"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4358" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4358: :; "
at_fn_check_prepare_trace "system-traffic.at:4358"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_95
#AT_START_96
at_fn_group_banner 96 'system-traffic.at:4363' \
  "conntrack - more complex SNAT" "                  " 4
at_xfail=no
(
  $as_echo "96. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4366: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4366"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4366"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4366"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4366"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4366"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4366"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4366"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4366: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4366"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4366"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4368: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4368"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4368"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4368: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4368"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4368"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4370"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4370"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4370"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4370"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4370"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4370"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4370"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4370: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4370"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4370"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4371: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4371"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4371"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4372"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4372"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4372"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4372"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4372"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4372"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4372"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4372: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4372"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
priority=100 ip action=ct(table=1,zone=1,nat)
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0 action=drop
table=1 priority=100 in_port=1 ip ct_state=+trk+new-est action=ct(commit,zone=1,nat(src=10.1.1.240-10.1.1.255)),2
table=1 priority=100 in_port=1 ip ct_state=+trk-new+est action=2
table=1 priority=100 in_port=2 ip ct_state=+trk-new+est action=1
table=1 priority=0 action=drop
table=8 priority=100 reg2=0x0a0101f0/0xfffffff0 action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8 priority=0 action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10 arp arp_op=1 action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4402: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4402"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4402"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4405" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4406: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4406"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4406"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4408: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4408"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/' | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.2XX,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4408"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4412: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4412"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4412: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4412"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4412: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4412"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4412" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4412: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4412"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4412: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4412"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4412" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4412: :; "
at_fn_check_prepare_trace "system-traffic.at:4412"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_96
#AT_START_97
at_fn_group_banner 97 'system-traffic.at:4415' \
  "conntrack - simple DNAT" "                        " 4
at_xfail=no
(
  $as_echo "97. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4418: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4418"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4418"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4418"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4418"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4418"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4418"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4418"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4418: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4418"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4420: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4420"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4420: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4420"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4420"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4422"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4422"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4422"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4422"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4422"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4422"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4422"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4422: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4422"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4423"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4423"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4423"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4423"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4423"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4423"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4423"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4423: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4423"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4424: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4424"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4424"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
priority=100 in_port=1,ip,nw_dst=10.1.1.64,action=ct(zone=1,nat(dst=10.1.1.2),commit),2
priority=10 in_port=1,ip,action=ct(commit,zone=1),2
priority=100 in_port=2,ct_state=-trk,ip,action=ct(table=0,nat,zone=1)
priority=100 in_port=2,ct_state=+trk+est,ct_zone=1,ip,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a010140,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4450: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4450"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4450"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4453" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4454: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4454"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4454"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4456: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.64\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4456"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.64" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.64,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4461: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4461"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4461"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4463: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4463"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4463"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4467: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4467"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4467: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4467"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4467: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4467"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4467" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4467: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4467"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4467: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4467"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4467" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4467: :; "
at_fn_check_prepare_trace "system-traffic.at:4467"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4467"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_97
#AT_START_98
at_fn_group_banner 98 'system-traffic.at:4470' \
  "conntrack - more complex DNAT" "                  " 4
at_xfail=no
(
  $as_echo "98. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4473: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4473"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4473"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4473"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4473"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4473"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4473"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4473"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4473: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4473"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4473"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4475: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4475"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4475"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4475: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4475"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4475"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4477"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4477"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4477"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4477"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4477"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4477"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4477"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4477: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4477"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4477"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4478"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4478"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4478"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4478"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4478"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4478"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4478"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4478: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4478"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4478"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4479: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4479"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=100 ip action=ct(table=1,zone=1,nat)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 priority=100 in_port=1 ct_state=+new ip nw_dst=10.1.1.64 action=ct(zone=1,nat(dst=10.1.1.2),commit),2
table=1 priority=10 in_port=1 ct_state=+new ip action=ct(commit,zone=1),2
table=1 priority=100 in_port=1 ct_state=+est ct_zone=1 action=2
table=1 priority=100 in_port=2 ct_state=+est ct_zone=1 action=1
table=1 priority=0 action=drop
table=8,reg2=0x0a010140,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4511: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4511"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4511"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4514" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4515: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4515"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4515"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4517: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.64\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4517"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.64" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.64,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4517"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4522: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4522"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget 10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4522"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4524: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4524"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4528: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4528"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4528: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4528"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4528: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4528"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4528" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4528: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4528"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4528: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4528"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4528" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4528: :; "
at_fn_check_prepare_trace "system-traffic.at:4528"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_98
#AT_START_99
at_fn_group_banner 99 'system-traffic.at:4531' \
  "conntrack - ICMP related with NAT" "              " 4
at_xfail=no
(
  $as_echo "99. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:4532" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4532"
$as_echo "system-traffic.at:4533" >"$at_check_line_file"
(test $HAVE_TCPDUMP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4533"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4536: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4536"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4536"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4536"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4536"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4536"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4536"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4536"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4536: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4536"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4536"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4538: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4538"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4538"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4538: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4538"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4538"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4540"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4540"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4540"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4540"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4540"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4540"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4540"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4540: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4540"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4541: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4541"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4541"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4542"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4542"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4542"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4542"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4542"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4542"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4542"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4542: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4542"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



cat >flows.txt <<'_ATEOF'
in_port=1,udp,action=ct(commit,nat(src=10.1.1.240-10.1.1.255),exec(set_field:1->ct_mark)),2
in_port=2,icmp,ct_state=-trk,action=ct(table=0,nat)
in_port=2,icmp,nw_dst=10.1.1.1,ct_state=+trk+rel,ct_mark=1,action=1
priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
priority=10 arp action=normal
priority=0,action=drop
table=8,reg2=0x0a0101f0/0xfffffff0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4567: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4567"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4567"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


rm p0.pcap
tcpdump -U -i ovs-p0 -w p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:4574: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c \"echo a | nc \$NC_EOF_OPT -u 10.1.1.2 10000\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4574"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c "echo a | nc $NC_EOF_OPT -u 10.1.1.2 10000"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4574"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4576: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:4576"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4576"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:4577: ovs-ofctl -O OpenFlow15 dump-flows br0 | ofctl_strip | sort | grep -v drop"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4577"
( $at_check_trace; ovs-ofctl -O OpenFlow15 dump-flows br0 | ofctl_strip | sort | grep -v drop
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " n_packets=1, n_bytes=42, priority=10,arp actions=NORMAL
 n_packets=1, n_bytes=44, udp,in_port=1 actions=ct(commit,nat(src=10.1.1.240-10.1.1.255),exec(set_field:0x1->ct_mark)),output:2
 n_packets=1, n_bytes=72, ct_state=+rel+trk,ct_mark=0x1,icmp,in_port=2,nw_dst=10.1.1.1 actions=output:1
 n_packets=1, n_bytes=72, ct_state=-trk,icmp,in_port=2 actions=ct(table=0,nat)
 n_packets=2, n_bytes=84, priority=100,arp,arp_op=1 actions=move:NXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
 table=10, n_packets=1, n_bytes=42, priority=10,arp,arp_op=1 actions=set_field:2->arp_op,move:NXM_NX_ARP_SHA[]->NXM_NX_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->NXM_NX_ARP_SHA[],move:NXM_OF_ARP_SPA[]->NXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->NXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],set_field:0->in_port,output:NXM_NX_REG3[0..15]
 table=10, n_packets=1, n_bytes=42, priority=100,arp,reg0=0,reg1=0 actions=NORMAL
 table=8, n_packets=1, n_bytes=42, priority=0 actions=set_field:0->xreg0
 table=8, n_packets=1, n_bytes=42, reg2=0xa0101f0/0xfffffff0 actions=set_field:0x808888888888->xreg0
OFPST_FLOW reply (OF1.5):
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4577"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4590: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4590"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq | sed -e 's/dst=10.1.1.2[45][0-9]/dst=10.1.1.2XX/'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.2XX,sport=<cleared>,dport=<cleared>),mark=1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4594: tcpdump -v \"icmp\" -r p0.pcap 2>/dev/null | egrep 'wrong|bad'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4594"
( $at_check_trace; tcpdump -v "icmp" -r p0.pcap 2>/dev/null | egrep 'wrong|bad'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:

at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:4594"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4596: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4596"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4596: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4596"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4596: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4596"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4596" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4596: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4596"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4596: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4596"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4596" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4596: :; "
at_fn_check_prepare_trace "system-traffic.at:4596"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4596"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_99
#AT_START_100
at_fn_group_banner 100 'system-traffic.at:4709' \
  "conntrack - FTP SNAT prerecirc " "                " 4
at_xfail=no
(
  $as_echo "100. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4709" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4709"
    $as_echo "system-traffic.at:4709" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4709"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4709"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4709"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 in_port=1, ip, action=ct(table=1,nat)
table=0 in_port=2, ip, action=ct(table=2,nat)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 ct_state=+new, tcp, tp_dst=21, nw_src=10.1.1.1, action=ct(alg=ftp,commit,nat(src=10.1.1.9)),2
table=1 ct_state=+est, tcp, nw_src=10.1.1.9,     action=2
table=1 priority=10, tcp, action=drop
table=1 priority=0,action=drop
table=2 ct_state=+est, tcp, nw_dst=10.1.1.1, action=1
table=2 ct_state=+new+rel, tcp, nw_dst=10.1.1.9, action=ct(commit,nat),1
table=2 ct_state=+rel, icmp, nw_dst=10.1.1.1, action=1
table=2 priority=10, tcp, action=drop
table=2 priority=0, action=drop
table=8,reg2=0x0a010109/0xffffffff,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4709" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4709"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4709"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4709"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4709" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4709"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4709" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4709: :; "
at_fn_check_prepare_trace "system-traffic.at:4709"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_100
#AT_START_101
at_fn_group_banner 101 'system-traffic.at:4720' \
  "conntrack - FTP SNAT prerecirc seqadj" "          " 4
at_xfail=no
(
  $as_echo "101. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4720" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4720"
    $as_echo "system-traffic.at:4720" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4720"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4720"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4720"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 in_port=1, ip, action=ct(table=1,nat)
table=0 in_port=2, ip, action=ct(table=2,nat)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 ct_state=+new, tcp, tp_dst=21, nw_src=10.1.1.1, action=ct(alg=ftp,commit,nat(src=10.1.1.240)),2
table=1 ct_state=+est, tcp, nw_src=10.1.1.240,     action=2
table=1 priority=10, tcp, action=drop
table=1 priority=0,action=drop
table=2 ct_state=+est, tcp, nw_dst=10.1.1.1, action=1
table=2 ct_state=+new+rel, tcp, nw_dst=10.1.1.240, action=ct(commit,nat),1
table=2 ct_state=+rel, icmp, nw_dst=10.1.1.1, action=1
table=2 priority=10, tcp, action=drop
table=2 priority=0, action=drop
table=8,reg2=0x0a0101f0/0xffffffff,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4720" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4720"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4720"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4720"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4720" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4720"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4720" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4720: :; "
at_fn_check_prepare_trace "system-traffic.at:4720"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_101
#AT_START_102
at_fn_group_banner 102 'system-traffic.at:4775' \
  "conntrack - FTP SNAT postrecirc " "               " 4
at_xfail=no
(
  $as_echo "102. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4775" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4775"
    $as_echo "system-traffic.at:4775" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4775"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4775"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4775"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 ip, action=ct(table=1)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new, tcp, tp_dst=21, action=ct(alg=ftp,commit,nat(src=10.1.1.9)),2
table=1 in_port=1 ct_state=+est, tcp,     action=ct(nat),2
table=1 in_port=2 ct_state=+est, tcp,     action=ct(nat),1
table=1 in_port=2 ct_state=+new+rel, tcp, action=ct(commit,nat),1
table=1 in_port=2 ct_state=+rel, icmp,    action=ct(nat),1
table=1 priority=0, action=drop
table=8,reg2=0x0a010109/0xffffffff,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4775" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4775"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4775"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4775"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4775" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4775"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4775" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4775: :; "
at_fn_check_prepare_trace "system-traffic.at:4775"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4775"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_102
#AT_START_103
at_fn_group_banner 103 'system-traffic.at:4786' \
  "conntrack - FTP SNAT postrecirc seqadj" "         " 4
at_xfail=no
(
  $as_echo "103. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4786" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4786"
    $as_echo "system-traffic.at:4786" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4786"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4786"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4786"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 ip, action=ct(table=1)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new, tcp, tp_dst=21, action=ct(alg=ftp,commit,nat(src=10.1.1.240)),2
table=1 in_port=1 ct_state=+est, tcp,     action=ct(nat),2
table=1 in_port=2 ct_state=+est, tcp,     action=ct(nat),1
table=1 in_port=2 ct_state=+new+rel, tcp, action=ct(commit,nat),1
table=1 in_port=2 ct_state=+rel, icmp,    action=ct(nat),1
table=1 priority=0, action=drop
table=8,reg2=0x0a0101f0/0xffffffff,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4786" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4786"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4786"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4786"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4786" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4786"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4786" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4786: :; "
at_fn_check_prepare_trace "system-traffic.at:4786"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4786"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_103
#AT_START_104
at_fn_group_banner 104 'system-traffic.at:4906' \
  "conntrack - FTP SNAT orig tuple " "               " 4
at_xfail=no
(
  $as_echo "104. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4906" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4906"
    $as_echo "system-traffic.at:4906" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4906"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4906"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4906"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 in_port=1, ip, action=set_field:1->reg4,set_field:1->reg3,ct(zone=NXM_NX_REG4[0..15],table=1)
table=0 in_port=2, ip, action=set_field:1->reg4,set_field:2->reg3,ct(zone=NXM_NX_REG4[0..15],nat,table=1)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 reg3=1, ip, ct_state=-rel-rpl+trk-inv action=set_field:1->reg0,resubmit(,3),goto_table:5
table=1 reg3=1, ip, ct_state=-rel+rpl+trk-inv action=set_field:2->reg0,resubmit(,3,ct),goto_table:4
table=1 reg3=2, ip, ct_state=-rel-rpl+trk-inv action=set_field:2->reg0,resubmit(,3),goto_table:5
table=1 reg3=2, ip, ct_state=-rel+rpl+trk-inv action=set_field:1->reg0,resubmit(,3,ct),goto_table:4
table=1 ip, ct_state=+rel+trk-inv, action=move:NXM_NX_CT_LABEL[0]->NXM_NX_REG0[0],resubmit(,3,ct),goto_table:4
table=1 priority=0, action=drop
table=3 priority=10, reg0=1, ip, nw_src=10.1.1.1 action=set_field:1234->reg1,set_field:1->reg2
table=3 priority=0, action=set_field:1235->reg1,set_field:0->reg2
table=4 priority=100 reg2=1, action=goto_table:5
table=4 priority=0 action=move:NXM_NX_REG3[]->NXM_NX_REG0[],resubmit(,3),goto_table:5
table=5 reg2=0 priority=1000 action=drop
table=5 priority=100 reg2=1 reg3=1 ct_state=+new-rel, tcp, tp_dst=21, action=ct(zone=NXM_NX_REG4[0..15],alg=ftp,commit,nat(src=10.1.1.9),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 reg3=1 ct_state=+new-rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat(src=10.1.1.9),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 reg3=2 ct_state=+new-rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat(dst=10.1.1.9),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 ct_state=+new+rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat,exec(move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 ct_state=-new+trk-inv reg3=1 ip, action=ct(zone=NXM_NX_REG4[0..15],nat),goto_table:6
table=5 priority=0 action=goto_table:6
table=6 in_port=1 action=2
table=6 in_port=2 action=1
table=8,reg2=0x0a010109,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4906" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4906"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4906"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),zone=1,labels=0x4d2000000000000000000000001,protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.9,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),zone=1,labels=0x4d2000000000000000000000001,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4906"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4906" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4906"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4906" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4906: :; "
at_fn_check_prepare_trace "system-traffic.at:4906"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_104
#AT_START_105
at_fn_group_banner 105 'system-traffic.at:4910' \
  "conntrack - FTP SNAT orig tuple seqadj" "         " 4
at_xfail=no
(
  $as_echo "105. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

    $as_echo "system-traffic.at:4910" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4910"
    $as_echo "system-traffic.at:4910" >"$at_check_line_file"
(test $HAVE_LFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4910"
    modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





    { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4910"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4910"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




     { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



        cat >flows.txt <<'_ATEOF'
table=0 in_port=1, ip, action=set_field:1->reg4,set_field:1->reg3,ct(zone=NXM_NX_REG4[0..15],table=1)
table=0 in_port=2, ip, action=set_field:1->reg4,set_field:2->reg3,ct(zone=NXM_NX_REG4[0..15],nat,table=1)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=1 reg3=1, ip, ct_state=-rel-rpl+trk-inv action=set_field:1->reg0,resubmit(,3),goto_table:5
table=1 reg3=1, ip, ct_state=-rel+rpl+trk-inv action=set_field:2->reg0,resubmit(,3,ct),goto_table:4
table=1 reg3=2, ip, ct_state=-rel-rpl+trk-inv action=set_field:2->reg0,resubmit(,3),goto_table:5
table=1 reg3=2, ip, ct_state=-rel+rpl+trk-inv action=set_field:1->reg0,resubmit(,3,ct),goto_table:4
table=1 ip, ct_state=+rel+trk-inv, action=move:NXM_NX_CT_LABEL[0]->NXM_NX_REG0[0],resubmit(,3,ct),goto_table:4
table=1 priority=0, action=drop
table=3 priority=10, reg0=1, ip, nw_src=10.1.1.1 action=set_field:1234->reg1,set_field:1->reg2
table=3 priority=0, action=set_field:1235->reg1,set_field:0->reg2
table=4 priority=100 reg2=1, action=goto_table:5
table=4 priority=0 action=move:NXM_NX_REG3[]->NXM_NX_REG0[],resubmit(,3),goto_table:5
table=5 reg2=0 priority=1000 action=drop
table=5 priority=100 reg2=1 reg3=1 ct_state=+new-rel, tcp, tp_dst=21, action=ct(zone=NXM_NX_REG4[0..15],alg=ftp,commit,nat(src=10.1.1.240),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 reg3=1 ct_state=+new-rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat(src=10.1.1.240),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 reg3=2 ct_state=+new-rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat(dst=10.1.1.240),exec(move:NXM_NX_REG3[0]->NXM_NX_CT_LABEL[0],move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 reg2=1 ct_state=+new+rel, ip, action=ct(zone=NXM_NX_REG4[0..15],commit,nat,exec(move:NXM_NX_REG1[0..31]->NXM_NX_CT_LABEL[96..127])),goto_table:6
table=5 priority=10 ct_state=-new+trk-inv reg3=1 ip, action=ct(zone=NXM_NX_REG4[0..15],nat),goto_table:6
table=5 priority=0 action=goto_table:6
table=6 in_port=1 action=2
table=6 in_port=2 action=1
table=8,reg2=0x0a0101f0,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=drop
_ATEOF


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4910" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




        cat >ftp.cmd <<'_ATEOF'
set net:max-retries 1
set net:timeout 1
set ftp:passive-mode off
cache off
connect ftp://anonymous:@10.1.1.2
ls
ls
ls
ls
_ATEOF

     { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4910"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
lftp -f ftp.cmd > lftp.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



        { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4910"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),zone=1,labels=0x4d2000000000000000000000001,protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),zone=1,labels=0x4d2000000000000000000000001,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4910"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4910" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4910"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4910" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4910: :; "
at_fn_check_prepare_trace "system-traffic.at:4910"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4910"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


    ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_105
#AT_START_106
at_fn_group_banner 106 'system-traffic.at:4912' \
  "conntrack - IPv4 FTP Passive with SNAT" "         " 4
at_xfail=no
(
  $as_echo "106. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:4913" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4913"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:4918: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4918"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4918"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4918"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4918"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4918"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4918"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4918"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4918: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4918"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4920: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4920"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4920: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4920"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4922"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4922"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4922"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4922"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4922"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4922"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4922"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4922: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4922"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4922"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4923: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4923"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4924: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4924"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4926"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4926"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4926"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4926"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4926"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4926"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4926"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4926: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4926"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4927: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4927"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4927"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4928: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4928"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4928"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4929: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4929"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4929"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp nw_src=10.1.1.1 tp_dst=21  action=ct(alg=ftp,commit,nat(src=10.1.1.240)),2
table=1 in_port=1 ct_state=+new+rel tcp nw_src=10.1.1.1 action=ct(commit,nat),2
table=1 in_port=1 ct_state=+est tcp nw_src=10.1.1.240 action=2
table=1 in_port=2 ct_state=+est tcp nw_dst=10.1.1.1 action=1

table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4953: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:4953"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4953"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4956" "until ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4958" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4961: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4961"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4961"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:4964: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:4964"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4964"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:4969: check_logs "
at_fn_check_prepare_trace "system-traffic.at:4969"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4969: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:4969"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4969: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:4969"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4969" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4969: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:4969"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4969: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:4969"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:4969" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:4969: :; "
at_fn_check_prepare_trace "system-traffic.at:4969"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4969"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_106
#AT_START_107
at_fn_group_banner 107 'system-traffic.at:4972' \
  "conntrack - IPv4 FTP Passive with DNAT" "         " 4
at_xfail=no
(
  $as_echo "107. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:4973" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:4973"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:4978: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:4978"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:4978"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:4978"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4978"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:4978"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:4978"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4978"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4978: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:4978"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4980: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4980"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:4980: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4980"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4982"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:4982"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:4982"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4982"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4982"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4982"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4982"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4982: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4982"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4983: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4983"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4983"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4984: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4984"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4985: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4985"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4985"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:4987"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:4987"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:4987"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4987"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.240/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4987"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.240/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4987"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4987"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:4987: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4987"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4987"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4988: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4988"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:4989: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:4989"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:4989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp nw_src=10.1.1.1 tp_dst=21 action=ct(alg=ftp,commit,nat(dst=10.1.1.240)),2
table=1 in_port=1 ct_state=+new+rel tcp nw_src=10.1.1.1 action=ct(commit,nat),2
table=1 in_port=1 ct_state=+est tcp nw_dst=10.1.1.240 action=2
table=1 in_port=2 ct_state=+est tcp nw_dst=10.1.1.1 action=1

table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5013: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5013"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5013"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.240 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5016" "until ip netns exec at_ns0 ping -c 1 10.1.1.240 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5018" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5021: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5021"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5021"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5024: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5024"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.240,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.240,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5024"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5029: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5029"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5029: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5029"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5029: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5029"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5029" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5029: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5029"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5029: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5029"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5029" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5029: :; "
at_fn_check_prepare_trace "system-traffic.at:5029"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5029"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_107
#AT_START_108
at_fn_group_banner 108 'system-traffic.at:5032' \
  "conntrack - IPv4 FTP Passive with DNAT 2" "       " 4
at_xfail=no
(
  $as_echo "108. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5033" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5033"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5038: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5038"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5038"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5038"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5038"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5038"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5038"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5038"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5038: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5038"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5040: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5040"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5040"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5040: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5040"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5040"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5042"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5042"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5042"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5042"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/16\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5042"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/16" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5042"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5042"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5042: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5042"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5043: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5043"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5043"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5044: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.200 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5044"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.200 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5044"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5045: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.100.1 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5045"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.100.1 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5045"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5047"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5047"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5047"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5047"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.100.1/16\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5047"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.100.1/16" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5047"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5047"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5047: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5047"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5047"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5048: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5048"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5049: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5049"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5049"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp nw_src=10.1.1.1 tp_dst=21 action=ct(alg=ftp,commit,nat(dst=10.1.100.1)),2
table=1 in_port=1 ct_state=+new+rel tcp nw_src=10.1.1.1 action=ct(commit,nat),2
table=1 in_port=1 ct_state=+est tcp nw_dst=10.1.100.1 action=2
table=1 in_port=2 ct_state=+est tcp nw_dst=10.1.1.1 action=1

table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5073: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5073"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5073"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.100.1 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5076" "until ip netns exec at_ns0 ping -c 1 10.1.100.1 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5078" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5081: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.200 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5081"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.200 -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5081"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5084: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.200\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5084"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.200" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.200,sport=<cleared>,dport=<cleared>),reply=(src=10.1.100.1,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.200,sport=<cleared>,dport=<cleared>),reply=(src=10.1.100.1,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5084"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5089: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5089"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5089: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5089"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5089: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5089"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5089" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5089: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5089"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5089: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5089"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5089" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5089: :; "
at_fn_check_prepare_trace "system-traffic.at:5089"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5089"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_108
#AT_START_109
at_fn_group_banner 109 'system-traffic.at:5092' \
  "conntrack - IPv4 FTP Active with DNAT" "          " 4
at_xfail=no
(
  $as_echo "109. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5093" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5093"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5098: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5098"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5098"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5098"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5098"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5098"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5098"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5098"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5098: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5098"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5098"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5100: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5100"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5100"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5100: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5100"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5100"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5102"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5102"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5102"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5102"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5102"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5102"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5102"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5102: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5102"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5102"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5103: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5103"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5104: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5104"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5105: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5105"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5107"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5107"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5107"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5107"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.240/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5107"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.240/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5107"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5107"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5107: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5107"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5107"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5108: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5108"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5108"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5109: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5109"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp nw_src=10.1.1.1 tp_dst=21 action=ct(alg=ftp,commit,nat(dst=10.1.1.240)),2
table=1 in_port=2 ct_state=+new+rel tcp nw_src=10.1.1.240 action=ct(commit,nat),1
table=1 in_port=1 ct_state=+est tcp nw_dst=10.1.1.240 action=2
table=1 in_port=2 ct_state=+est tcp nw_dst=10.1.1.1 action=1

table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5133: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5133"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5133"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.240 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5136" "until ip netns exec at_ns0 ping -c 1 10.1.1.240 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5138" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5141: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5141"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.1.2 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5141"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5144: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5144"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.240,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.240,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5149: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5149"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5149: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5149"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5149: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5149"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5149" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5149: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5149"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5149: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5149"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5149" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5149: :; "
at_fn_check_prepare_trace "system-traffic.at:5149"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_109
#AT_START_110
at_fn_group_banner 110 'system-traffic.at:5152' \
  "conntrack - IPv4 FTP Active with DNAT with reverse skew" "" 4
at_xfail=no
(
  $as_echo "110. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5153" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5153"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5158: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5158"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5158"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5158"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5158"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5158"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5158"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5158"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5158: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5158"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5160: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5160"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5160: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5160"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5160"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5162"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5162"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5162"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5162"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/16\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5162"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/16" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5162"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5162"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5162: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5162"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5163: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5163"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5163"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5164: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5164"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5165: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.120.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5165"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.120.240 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5165"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5167"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5167"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5167"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5167"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/16\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5167"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/16" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5167"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5167"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5167: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5167"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5167"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5168: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5168"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5168"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5169: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5169"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5169"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp nw_src=10.1.1.1 tp_dst=21 action=ct(alg=ftp,commit,nat(dst=10.1.1.2)),2
table=1 in_port=2 ct_state=+new+rel tcp nw_src=10.1.1.2 action=ct(commit,nat),1
table=1 in_port=1 ct_state=+est tcp nw_dst=10.1.1.2 action=2
table=1 in_port=2 ct_state=+est tcp nw_dst=10.1.1.1 action=1

table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5193: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5193"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5193"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5196" "until ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5198" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5201: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.120.240 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5201"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://10.1.120.240 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5204: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.120.240\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5204"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.120.240" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.120.240,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.120.240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5204"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5209: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5209"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5209: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5209"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5209: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5209"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5209" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5209: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5209"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5209: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5209"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5209" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5209: :; "
at_fn_check_prepare_trace "system-traffic.at:5209"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5209"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_110
#AT_START_111
at_fn_group_banner 111 'system-traffic.at:5212' \
  "conntrack - IPv6 HTTP with SNAT" "                " 4
at_xfail=no
(
  $as_echo "111. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5215: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5215"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5215"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5215"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5215"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5215"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5215"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5215"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5215: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5215"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5217: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5217"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5217: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5217"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5219"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5219"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5219"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5219"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5220: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5220"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5221"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5221"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5221"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5221"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5221"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5221"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5221"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5221: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5221"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5222: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5222"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5222"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5223: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::241 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5223"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::241 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5223"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
priority=1,action=drop
priority=10,icmp6,action=normal
priority=100,in_port=1,ip6,action=ct(commit,nat(src=fc00::240-fc00::241)),2
priority=100,in_port=2,ct_state=-trk,ip6,action=ct(nat,table=0)
priority=100,in_port=2,ct_state=+trk+est,ip6,action=1
priority=200,in_port=2,ct_state=+trk+new,icmp6,icmpv6_code=0,icmpv6_type=135,nd_target=fc00::240,action=ct(commit,nat(dst=fc00::1)),1
priority=200,in_port=2,ct_state=+trk+new,icmp6,icmpv6_code=0,icmpv6_type=135,nd_target=fc00::241,action=ct(commit,nat(dst=fc00::1)),1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5236: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5236"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5241" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


PIDFILE=$(mktemp http6XXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http6 & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http6 | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5244" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5246: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::2] -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5246"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::2] -t 3 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5246"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



PIDFILE=$(mktemp http6XXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py http6 & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http6 | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5250" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5251: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget http://[fc00::1] -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5251"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget http://[fc00::1] -t 3 -T 1 -v -o wget1.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 4 $at_status "$at_srcdir/system-traffic.at:5251"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5253: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5253"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5253: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5253"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5253: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5253"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5253" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5253: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5253"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5253: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5253"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5253" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5253: :; "
at_fn_check_prepare_trace "system-traffic.at:5253"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5253"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_111
#AT_START_112
at_fn_group_banner 112 'system-traffic.at:5256' \
  "conntrack - IPv6 HTTP with DNAT" "                " 4
at_xfail=no
(
  $as_echo "112. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5259: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5259"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5259"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5259"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5259"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5259"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5259"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5259"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5259: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5259"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5261: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5261"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5261: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5261"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5263"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5263"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5263"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5263"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5263"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5263"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5263"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5263: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5263"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5263"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5264"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5264"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5264"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5264"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5264"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5264"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5264"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5264: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5264"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5265: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 link set dev p0 address 80:88:88:88:88:77
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5265"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 link set dev p0 address 80:88:88:88:88:77
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5265"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5266: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5266"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5266"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5267: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5267"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5267"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5268: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5268"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5268"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
priority=100 in_port=1,ip6,ipv6_dst=fc00::240,action=ct(zone=1,nat(dst=fc00::2),commit),2
priority=100 in_port=2,ct_state=-trk,ip6,action=ct(table=0,nat,zone=1)
priority=100 in_port=2,ct_state=+trk+est,ct_zone=1,ip6,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5277: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5277"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5277"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::240
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5282" "until ip netns exec at_ns0 ping6 -c 1 fc00::240"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5284: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::240 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5284"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping6 -q -c 3 -i 0.3 -w 2 fc00::240 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5284"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



PIDFILE=$(mktemp http6XXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py http6 & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http6 | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5289" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5290: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::240] -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5290"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget http://[fc00::240] -t 5 -T 1 --retry-connrefused -v -o wget0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5292: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::1\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5292"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::1" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "icmpv6,orig=(src=fc00::1,dst=fc00::240,id=<cleared>,type=128,code=0),reply=(src=fc00::2,dst=fc00::1,id=<cleared>,type=129,code=0),zone=1
tcp,orig=(src=fc00::1,dst=fc00::240,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::1,sport=<cleared>,dport=<cleared>),zone=1,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5292"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5297: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5297"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5297: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5297"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5297: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5297"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5297" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5297: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5297"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5297: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5297"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5297" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5297: :; "
at_fn_check_prepare_trace "system-traffic.at:5297"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5297"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_112
#AT_START_113
at_fn_group_banner 113 'system-traffic.at:5300' \
  "conntrack - IPv6 ICMP6 Related with SNAT" "       " 4
at_xfail=no
(
  $as_echo "113. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5301" >"$at_check_line_file"
(test $HAVE_TCPDUMP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5301"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5304: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5304"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5304"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5304"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5304"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5304"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5304"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5304"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5304: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5304"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5304"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5306: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5306"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5306"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5306: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5306"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5306"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5308"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5308"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5308"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5308"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5308"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5308"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5308"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5308: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5308"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5308"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5309"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5309"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5309"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5309"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5309"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5309"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5309"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5309: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5309"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5309"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5310: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 link set dev p0 address 80:88:88:88:88:77
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5310"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 link set dev p0 address 80:88:88:88:88:77
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5310"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5311: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5311"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 link set dev p1 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5311"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5313: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5313"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5313"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5314: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::3 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5314"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::3 lladdr 80:88:88:88:88:88 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5314"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5315: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5315"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5316: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5316"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::1 lladdr 80:88:88:88:88:77 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5316"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5318: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 route add default via fc00::2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5318"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 route add default via fc00::2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5318"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
priority=100 in_port=1,ip6,action=ct(nat(src=fc00::240),commit),2
priority=100 in_port=2,ct_state=-trk,ip6,action=ct(table=0,nat)
priority=100 in_port=2,ct_state=+trk+est,ip6,action=1
priority=100 in_port=2,ct_state=+trk+rel,ip6,action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5328: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5328"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5328"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5333" "until ip netns exec at_ns0 ping6 -c 1 fc00::2"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5335: ovs-appctl dpctl/flush-conntrack"
at_fn_check_prepare_trace "system-traffic.at:5335"
( $at_check_trace; ovs-appctl dpctl/flush-conntrack
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5335"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


rm p0.pcap
tcpdump -U -i ovs-p0 -w p0.pcap &
sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:5342: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c \"echo a | nc -6 \$NC_EOF_OPT -u fc00::2 1\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5342"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
bash -c "echo a | nc -6 $NC_EOF_OPT -u fc00::2 1"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5342"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5344: tcpdump -v \"icmp6\" -r p0.pcap 2>/dev/null | egrep 'wrong|bad'"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5344"
( $at_check_trace; tcpdump -v "icmp6" -r p0.pcap 2>/dev/null | egrep 'wrong|bad'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:

at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:5344"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5346: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5346"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5346"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5350: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5350"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5350: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5350"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5350: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5350"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5350" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5350: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5350"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5350: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5350"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5350" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5350: :; "
at_fn_check_prepare_trace "system-traffic.at:5350"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5350"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_113
#AT_START_114
at_fn_group_banner 114 'system-traffic.at:5353' \
  "conntrack - IPv6 FTP with SNAT" "                 " 4
at_xfail=no
(
  $as_echo "114. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5354" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5354"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5359: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5359"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5359"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5359"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5359"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5359"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5359"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5359"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5359: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5359"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5361: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5361"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5361: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5361"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5363"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5363"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5363"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5363"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5363"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5363"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5363"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5363: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5363"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5363"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5364: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5364"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5364"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5365"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5365"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5365"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5365"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5365"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5365"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5365"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5365: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5365"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5365"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5367: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5367"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5367"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip6, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp6 ipv6_src=fc00::1 tp_dst=21  action=ct(alg=ftp,commit,nat(src=fc00::240)),2
table=1 in_port=2 ct_state=+new+rel tcp6 ipv6_dst=fc00::240 action=ct(commit,nat),1
table=1 in_port=1 ct_state=+est tcp6 ipv6_src=fc00::240   action=2
table=1 in_port=2 ct_state=+est tcp6 ipv6_dst=fc00::1     action=1
table=1 priority=100 in_port=1 icmp6, action=2
table=1 priority=100 in_port=2 icmp6, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5392: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5392"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5392"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5397" "until ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5399" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5402: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5402"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5402"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5405: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5405"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),reply=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5405"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5410: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5410"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5410: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5410"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5410: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5410"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5410" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5410: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5410"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5410: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5410"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5410" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5410: :; "
at_fn_check_prepare_trace "system-traffic.at:5410"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_114
#AT_START_115
at_fn_group_banner 115 'system-traffic.at:5413' \
  "conntrack - IPv6 FTP Passive with SNAT" "         " 4
at_xfail=no
(
  $as_echo "115. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5414" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5414"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5419: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5419"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5419"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5419"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5419"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5419"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5419"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5419"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5419: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5419"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5419"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5421: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5421"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5421: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5421"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5423"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5423"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5423"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5423"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5423"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5423"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5423"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5423: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5423"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5423"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5424: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5424"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5424"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5425"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5425"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5425"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5425"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5425"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5425"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5425"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5425: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5425"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5425"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5426: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:99
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5426"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:99
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5426"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5427: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:99 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5427"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::2 lladdr 80:88:88:88:88:99 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5427"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5428: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5428"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5428"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip6, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 in_port=1 ct_state=+new tcp6 ipv6_src=fc00::1 tp_dst=21  action=ct(alg=ftp,commit,nat(src=fc00::240)),2
table=1 in_port=1 ct_state=+new+rel tcp6 ipv6_dst=fc00::2 action=ct(commit,nat),2
table=1 in_port=1 ct_state=+est tcp6 ipv6_src=fc00::240 action=2
table=1 in_port=2 ct_state=+est tcp6 ipv6_dst=fc00::1 action=1
table=1 priority=100 in_port=1 icmp6, action=2
table=1 priority=100 in_port=2 icmp6, action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5453: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5453"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5453"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5458" "until ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null"


PIDFILE=$(mktemp ftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo ftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5460" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5463: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5463"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5463"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5466: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5466"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5466"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5471: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5471"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5471: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5471"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5471: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5471"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5471" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5471: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5471"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5471: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5471"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5471" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5471: :; "
at_fn_check_prepare_trace "system-traffic.at:5471"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_115
#AT_START_116
at_fn_group_banner 116 'system-traffic.at:5474' \
  "conntrack - IPv6 FTP with SNAT - orig tuple" "    " 4
at_xfail=no
(
  $as_echo "116. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5475" >"$at_check_line_file"
(test $HAVE_FTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5475"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'




{ set +x
$as_echo "$at_srcdir/system-traffic.at:5479: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5479"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5479"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5479"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5479"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5479"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5479"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5479"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5479: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5479"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5481: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5481"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5481"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5481: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5481"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5481"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5483"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5483"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5483"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5483"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::1/96\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5483"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "fc00::1/96" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5483"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5483"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5483: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5483"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5483"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5484: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5484"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address 80:88:88:88:88:88
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5484"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5485"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5485"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5485"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5485"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"fc00::2/96\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5485"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "fc00::2/96" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5485"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5485"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5485: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5485"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5485"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5487: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5487"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip -6 neigh add fc00::240 lladdr 80:88:88:88:88:88 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5487"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip6, action=ct(nat,table=1)
table=0 priority=0 action=drop
table=1 priority=100 in_port=1 icmp6, action=2
table=1 priority=100 in_port=2 icmp6, action=1
table=1 priority=10 in_port=1 ct_state=+new+trk-inv tcp6 ct_nw_proto=6 ct_ipv6_src=fc00::1 ct_tp_dst=21  action=ct(alg=ftp,commit,nat(src=fc00::240)),2
table=1 priority=10 in_port=2 ct_state=+new+rel+trk-inv ipv6 ct_nw_proto=6 ct_ipv6_src=fc00::1 ct_tp_dst=21 action=ct(commit,nat),1
table=1 priority=10 in_port=1 ct_state=+est+trk-inv ipv6 ct_nw_proto=6 ct_ipv6_src=fc00::1 ct_tp_dst=21 action=2
table=1 priority=10 in_port=2 ct_state=+est+trk-inv ipv6 ct_nw_proto=6 ct_ipv6_src=fc00::1 ct_tp_dst=21 action=1
table=1 priority=0, action=drop
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5512: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5512"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5512"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5517" "until ip netns exec at_ns0 ping6 -c 1 fc00::2 >/dev/null"


ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py ftp & echo $! > ftp0.pid
     echo "kill \`cat ftp0.pid\`" >> cleanup


ovs_wait_cond () {
    ip netns exec at_ns1 netstat -l | grep ftp
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5520" "until ip netns exec at_ns1 netstat -l | grep ftp"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5523: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5523"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
wget ftp://[fc00::2] -6 --no-passive-ftp -t 3 -T 1 --retry-connrefused -v --server-response --no-remove-listing -o wget0.log -d
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5523"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5526: ovs-appctl dpctl/dump-conntrack | grep \"dst=fc00::2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5526"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=fc00::2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),reply=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>),helper=ftp
tcp,orig=(src=fc00::2,dst=fc00::240,sport=<cleared>,dport=<cleared>),reply=(src=fc00::1,dst=fc00::2,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5526"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5531: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5531"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5531: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5531"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5531: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5531"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5531" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5531: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5531"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5531: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5531"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5531" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5531: :; "
at_fn_check_prepare_trace "system-traffic.at:5531"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5531"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_116
#AT_START_117
at_fn_group_banner 117 'system-traffic.at:5534' \
  "conntrack - IPv4 TFTP with SNAT" "                " 4
at_xfail=no
(
  $as_echo "117. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5535" >"$at_check_line_file"
(test $HAVE_TFTP = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5535"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5540: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5540"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5540"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5540"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5540"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5540"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5540"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5540"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5540: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5540"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5540"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5542: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5542"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5542: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5542"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5542"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5544"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5544"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5544"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5544"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5544"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5544"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5544"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5544: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5544"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5545: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5545"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5545"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5546: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5546"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.2 e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5546"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5548"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5548"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5548"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5548"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5548"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5548"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5548"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5548: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5548"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5549: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5549"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address e6:66:c1:22:22:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5549"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5550: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5550"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.1 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5550"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5551: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5551"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
arp -s 10.1.1.240 e6:66:c1:11:11:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5551"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



cat >flows.txt <<'_ATEOF'
table=0 priority=10 ip, action=ct(table=1)
table=0 priority=0 action=drop
table=1 priority=100 in_port=1 icmp, action=2
table=1 priority=100 in_port=2 icmp, action=1
table=1 in_port=1 ct_state=+new udp nw_src=10.1.1.1 tp_dst=69  action=ct(alg=tftp,commit,nat(src=10.1.1.240)),2
table=1 in_port=2 ct_state=+new+rel udp nw_src=10.1.1.2 action=ct(commit,nat),1
table=1 in_port=1 ct_state=+est udp nw_src=10.1.1.1 action=ct(nat,table=2)
table=1 in_port=2 ct_state=+est udp nw_src=10.1.1.2 action=ct(nat,table=2)
table=1 priority=0, action=drop
table=2 in_port=1 ct_state=+est udp nw_src=10.1.1.240 action=2
table=2 in_port=2 ct_state=+est udp nw_dst=10.1.1.1 action=1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5579: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5579"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5579"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5582" "until ip netns exec at_ns0 ping -c 1 10.1.1.2 >/dev/null"


PIDFILE=$(mktemp tftpXXX.pid)
    ip netns exec at_ns0 $PYTHON3 $srcdir/test-l7.py tftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo tftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5584" "until ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp tftpXXX.pid)
    ip netns exec at_ns1 $PYTHON3 $srcdir/test-l7.py tftp & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo tftp | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5585" "until ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5588: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl \$CURL_OPT tftp://10.1.1.2/flows.txt -o foo 2>curl0.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5588"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
curl $CURL_OPT tftp://10.1.1.2/flows.txt -o foo 2>curl0.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5588"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5590: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.2\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5590"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.2" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "udp,orig=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),helper=tftp
udp,orig=(src=10.1.1.2,dst=10.1.1.240,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5590"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5595: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5595"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5595: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5595"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5595: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5595"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5595" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5595: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5595"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5595: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5595"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5595" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5595: :; "
at_fn_check_prepare_trace "system-traffic.at:5595"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_117
#AT_START_118
at_fn_group_banner 118 'system-traffic.at:5598' \
  "conntrack - DNAT load balancing" "                " 4
at_xfail=no
(
  $as_echo "118. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5601: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5601"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5601"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5601"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5601"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5601"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5601"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5601"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5601: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5601"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5601"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5603: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5603"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5603"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5603: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5603"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5603"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5603: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5603"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5603"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns4



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5603: ip netns add at_ns4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5603"
( $at_check_trace; ip netns add at_ns4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5603"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns4


'
                ip netns exec at_ns4 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5605"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5605"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5605"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5605"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5605"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5605"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5605"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5605: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5605"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5605"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5606"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:5606"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:5606"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5606"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5606"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5606"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5606"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5606: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5606"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5606"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5607"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:5607"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:5607"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5607"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5607"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5607"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5607"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5607: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5607"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5607"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip link add p4 type veth peer name ovs-p4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5608"
( $at_check_trace; ip link add p4 type veth peer name ovs-p4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip link set p4 netns at_ns4"
at_fn_check_prepare_trace "system-traffic.at:5608"
( $at_check_trace; ip link set p4 netns at_ns4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip link set dev ovs-p4 up"
at_fn_check_prepare_trace "system-traffic.at:5608"
( $at_check_trace; ip link set dev ovs-p4 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ovs-vsctl add-port br0 ovs-p4 -- \\
                set interface ovs-p4 external-ids:iface-id=\"p4\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5608"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p4 -- \
                set interface ovs-p4 external-ids:iface-id="p4"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p4
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5608"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p4
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5608"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5608"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5608: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5608"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p4'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5609: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5609"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5610: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address 80:88:88:88:88:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5610"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address 80:88:88:88:88:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5610"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5611: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address 80:88:88:88:88:33
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5611"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address 80:88:88:88:88:33
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5611"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5612: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address 80:88:88:88:88:44
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5612"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address 80:88:88:88:88:44
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5612"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5619: ovs-ofctl -O OpenFlow15 -vwarn add-group br0 \"group_id=234,type=select,bucket=weight=100,ct(nat(dst=10.1.1.2),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.3),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.4),commit,table=4)\""
at_fn_check_prepare_trace "system-traffic.at:5619"
( $at_check_trace; ovs-ofctl -O OpenFlow15 -vwarn add-group br0 "group_id=234,type=select,bucket=weight=100,ct(nat(dst=10.1.1.2),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.3),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.4),commit,table=4)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5619"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


cat >flows.txt <<'_ATEOF'
table=0 priority=100 ip nw_dst=10.1.1.64 action=group:234
table=0 priority=90 ip action=ct(table=4,nat)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=4,ip,nw_dst=10.1.1.1 action=mod_dl_dst:80:88:88:88:88:11,output:1
table=4,ip,nw_dst=10.1.1.2 action=mod_dl_dst:80:88:88:88:88:22,output:2
table=4,ip,nw_dst=10.1.1.3 action=mod_dl_dst:80:88:88:88:88:33,output:3
table=4,ip,nw_dst=10.1.1.4 action=mod_dl_dst:80:88:88:88:88:44,output:4
table=4 priority=0 action=drop
table=8,reg2=0x0a010140,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=controller
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5652: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5652"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5652"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns2 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5655" "until ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5656" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns4 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5657" "until ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




on_exit 'ovs-ofctl -O OpenFlow15 dump-flows br0'
on_exit 'ovs-appctl revalidator/purge'
on_exit 'ovs-appctl dpif/dump-flows br0'

for i in 1 2 3 4 5 6 7 8 9 10 11 12; do
    echo Request $i
     { set +x
$as_echo "$at_srcdir/system-traffic.at:5666: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget\$i.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5666"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
wget 10.1.1.64 -t 5 -T 1 --retry-connrefused -v -o wget$i.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5666"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


done

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5670: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.1.1.64\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5670"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.1.1.64" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.1,dst=10.1.1.64,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.64,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.3,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
tcp,orig=(src=10.1.1.1,dst=10.1.1.64,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.4,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5670"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-appctl dpif/dump-flows br0
ovs-appctl revalidator/purge
ovs-ofctl -O OpenFlow15 dump-flows br0
ovs-ofctl -O OpenFlow15 dump-group-stats br0

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5681: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5681"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5681: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5681"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5681: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5681"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5681" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5681: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5681"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5681: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5681"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5681" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5681: :; "
at_fn_check_prepare_trace "system-traffic.at:5681"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5681"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_118
#AT_START_119
at_fn_group_banner 119 'system-traffic.at:5685' \
  "conntrack - DNAT load balancing with NC" "        " 4
at_xfail=no
(
  $as_echo "119. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5686" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5686"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5689: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5689"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5689"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5689"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5689"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5689"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5689"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5689"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5689: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5689"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5689"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5691: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5691"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5691: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5691"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns3



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5691: ip netns add at_ns3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5691"
( $at_check_trace; ip netns add at_ns3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns3


'
                ip netns exec at_ns3 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns4



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5691: ip netns add at_ns4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5691"
( $at_check_trace; ip netns add at_ns4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns4


'
                ip netns exec at_ns4 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns5



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5691: ip netns add at_ns5 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5691"
( $at_check_trace; ip netns add at_ns5 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns5


'
                ip netns exec at_ns5 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5693"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5693"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5693"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5693"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5693"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5693"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5693"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5693: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5693"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5693"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5694"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:5694"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:5694"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5694"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5694"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5694"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5694"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5694: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5694"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5694"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip link add p3 type veth peer name ovs-p3 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5695"
( $at_check_trace; ip link add p3 type veth peer name ovs-p3 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip link set p3 netns at_ns3"
at_fn_check_prepare_trace "system-traffic.at:5695"
( $at_check_trace; ip link set p3 netns at_ns3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:5695"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ovs-vsctl add-port br0 ovs-p3 -- \\
                set interface ovs-p3 external-ids:iface-id=\"p3\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5695"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p3 -- \
                set interface ovs-p3 external-ids:iface-id="p3"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.3/24\" dev p3
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5695"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.3/24" dev p3
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5695"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5695"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5695: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5695"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p3'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip link add p4 type veth peer name ovs-p4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5696"
( $at_check_trace; ip link add p4 type veth peer name ovs-p4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip link set p4 netns at_ns4"
at_fn_check_prepare_trace "system-traffic.at:5696"
( $at_check_trace; ip link set p4 netns at_ns4
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip link set dev ovs-p4 up"
at_fn_check_prepare_trace "system-traffic.at:5696"
( $at_check_trace; ip link set dev ovs-p4 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ovs-vsctl add-port br0 ovs-p4 -- \\
                set interface ovs-p4 external-ids:iface-id=\"p4\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5696"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p4 -- \
                set interface ovs-p4 external-ids:iface-id="p4"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.4/24\" dev p4
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5696"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.4/24" dev p4
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5696"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5696"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5696: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5696"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5696"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p4'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip link add p5 type veth peer name ovs-p5 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5697"
( $at_check_trace; ip link add p5 type veth peer name ovs-p5 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip link set p5 netns at_ns5"
at_fn_check_prepare_trace "system-traffic.at:5697"
( $at_check_trace; ip link set p5 netns at_ns5
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip link set dev ovs-p5 up"
at_fn_check_prepare_trace "system-traffic.at:5697"
( $at_check_trace; ip link set dev ovs-p5 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ovs-vsctl add-port br0 ovs-p5 -- \\
                set interface ovs-p5 external-ids:iface-id=\"p5\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5697"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p5 -- \
                set interface ovs-p5 external-ids:iface-id="p5"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.5/24\" dev p5
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5697"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.5/24" dev p5
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5697"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5697"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5697: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5697"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p5'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5698: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:11
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5698"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address 80:88:88:88:88:11
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5698"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5699: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address 80:88:88:88:88:22
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5699"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address 80:88:88:88:88:22
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5699"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5700: ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address 80:88:88:88:88:33
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5700"
( $at_check_trace; ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
ip link set dev p3 address 80:88:88:88:88:33
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5700"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5701: ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address 80:88:88:88:88:44
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5701"
( $at_check_trace; ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
ip link set dev p4 address 80:88:88:88:88:44
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5701"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5702: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 address 80:88:88:88:88:55
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5702"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
ip link set dev p5 address 80:88:88:88:88:55
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5702"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5709: ovs-ofctl -O OpenFlow15 -vwarn add-group br0 \"group_id=234,type=select,bucket=weight=100,ct(nat(dst=10.1.1.2),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.3),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.4),commit,table=4)\""
at_fn_check_prepare_trace "system-traffic.at:5709"
( $at_check_trace; ovs-ofctl -O OpenFlow15 -vwarn add-group br0 "group_id=234,type=select,bucket=weight=100,ct(nat(dst=10.1.1.2),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.3),commit,table=4),bucket=weight=100,ct(nat(dst=10.1.1.4),commit,table=4)"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5709"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


cat >flows.txt <<'_ATEOF'
table=0 priority=100 ip nw_dst=10.1.1.64 action=group:234
table=0 priority=90 ip action=ct(table=4,nat)
table=0 priority=100 arp arp_op=1 action=move:OXM_OF_ARP_TPA[]->NXM_NX_REG2[],resubmit(,8),goto_table:10
table=0 priority=10 arp action=normal
table=0 priority=0 action=drop
table=4,ip,nw_dst=10.1.1.1 action=mod_dl_dst:80:88:88:88:88:11,output:1
table=4,ip,nw_dst=10.1.1.2 action=mod_dl_dst:80:88:88:88:88:22,output:2
table=4,ip,nw_dst=10.1.1.3 action=mod_dl_dst:80:88:88:88:88:33,output:3
table=4,ip,nw_dst=10.1.1.4 action=mod_dl_dst:80:88:88:88:88:44,output:4
table=4,ip,nw_dst=10.1.1.5 action=mod_dl_dst:80:88:88:88:88:55,output:5
table=4 priority=0 action=drop
table=8,reg2=0x0a010140,action=load:0x808888888888->OXM_OF_PKT_REG0[]
table=8,priority=0,action=load:0->OXM_OF_PKT_REG0[]
table=10 priority=100 arp xreg0=0 action=normal
table=10 priority=10,arp,arp_op=1,action=load:2->OXM_OF_ARP_OP[],move:OXM_OF_ARP_SHA[]->OXM_OF_ARP_THA[],move:OXM_OF_PKT_REG0[0..47]->OXM_OF_ARP_SHA[],move:OXM_OF_ARP_SPA[]->OXM_OF_ARP_TPA[],move:NXM_NX_REG2[]->OXM_OF_ARP_SPA[],move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],move:OXM_OF_PKT_REG0[0..47]->NXM_OF_ETH_SRC[],move:NXM_OF_IN_PORT[]->NXM_NX_REG3[0..15],load:0->NXM_OF_IN_PORT[],output:NXM_NX_REG3[0..15]
table=10 priority=0 action=controller
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5743: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5743"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5743"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns2 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5746" "until ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns3 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5747" "until ip netns exec at_ns3 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"



PIDFILE=$(mktemp httpXXX.pid)
    ip netns exec at_ns4 $PYTHON3 $srcdir/test-l7.py http & echo $! > $PIDFILE
     echo "kill \`cat $PIDFILE\`" >> cleanup



        PROTO=$(echo http | sed -e 's/\([a-zA-Z]*\).*/\1/')
    ovs_wait_cond () {
    ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
netstat -l | grep $PROTO
NS_EXEC_HEREDOC
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5748" "until ip netns exec at_ns4 sh << NS_EXEC_HEREDOC
netstat -l | grep \$PROTO
NS_EXEC_HEREDOC"




on_exit 'ovs-ofctl -O OpenFlow15 dump-flows br0'
on_exit 'ovs-appctl revalidator/purge'
on_exit 'ovs-appctl dpif/dump-flows br0'

sleep 5

for i in 1 2 3 4 5 6 7 8 9; do
    echo Request $i
     { set +x
$as_echo "$at_srcdir/system-traffic.at:5759: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo \"TEST1\" | nc -p 4100\$i 10.1.1.64 80 > nc-1-\$i.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5759"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo "TEST1" | nc -p 4100$i 10.1.1.64 80 > nc-1-$i.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5759"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


     { set +x
$as_echo "$at_srcdir/system-traffic.at:5760: ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
echo \"TEST5\" | nc -p 4100\$i 10.1.1.64 80 > nc-5-\$i.log
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5760"
( $at_check_trace; ip netns exec at_ns5 sh << NS_EXEC_HEREDOC
echo "TEST5" | nc -p 4100$i 10.1.1.64 80 > nc-5-$i.log
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5760"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


done

conntrack -L 2>&1

ovs-appctl dpif/dump-flows br0
ovs-appctl revalidator/purge
ovs-ofctl -O OpenFlow15 dump-flows br0
ovs-ofctl -O OpenFlow15 dump-group-stats br0

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5770: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5770"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5770: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5770"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5770: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5770"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5770" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5770: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5770"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5770: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5770"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5770" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5770: :; "
at_fn_check_prepare_trace "system-traffic.at:5770"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5770"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_119
#AT_START_120
at_fn_group_banner 120 'system-traffic.at:5773' \
  "conntrack - floating IP" "                        " 4
at_xfail=no
(
  $as_echo "120. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5774" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5774"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5776: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5776"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5776"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5776"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5776"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5776"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5776"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5776"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5776: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5776"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:5777" >"$at_check_line_file"
(! grep -q "Datapath supports ct_clear action" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5777"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5779: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5779"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5779: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5779"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5780"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5780"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5780"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5780"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5780"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5780"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""f0:00:00:01:01:01""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address \"f0:00:00:01:01:01\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5780"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address "f0:00:00:01:01:01"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5780: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5780"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'

  { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5781"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5781"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5781"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5781"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5781"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5781"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""f0:00:00:01:01:02""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address \"f0:00:00:01:01:02\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5781"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address "f0:00:00:01:01:02"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5781: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5781"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5784: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.2 lladdr f0:00:00:01:01:02 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5784"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.2 lladdr f0:00:00:01:01:02 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5784"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5785: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.1 lladdr f0:00:00:01:01:01 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5785"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.1 lladdr f0:00:00:01:01:01 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5785"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5788: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5788"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5788"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5789: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5789"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5789"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5790: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5790"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5790"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5791: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5791"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5791"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns exec at_ns0 nc -l -k 1234 > /dev/null & echo $! > nc0.pid
     echo "kill \`cat nc0.pid\`" >> cleanup



cat >flows.txt <<'_ATEOF'
table=0,priority=10  ip action=ct(table=1)
table=0,priority=1   action=drop
table=1,priority=20  ip,ct_state=+trk+est,nw_dst=10.254.254.0/24 action=goto_table:10
table=1,priority=20  ip,ct_state=+trk+new,nw_dst=10.254.254.0/24 action=ct(commit,table=10)
table=1,priority=10  ip,ct_state=+trk+est action=goto_table:20
table=1,priority=10  ip,ct_state=+trk+new action=ct(commit,table=20)
table=1,priority=1   ip,ct_state=+trk+inv action=drop
table=10             ip,nw_dst=10.254.254.1 action=set_field:10.1.1.1->nw_dst,goto_table:11
table=10             ip,nw_dst=10.254.254.2 action=set_field:10.1.1.2->nw_dst,goto_table:11
table=11             ip,nw_src=10.1.1.1 action=set_field:10.254.254.1->nw_src,goto_table:12
table=11             ip,nw_src=10.1.1.2 action=set_field:10.254.254.2->nw_src,goto_table:12
table=12,priority=10 ip action=ct_clear,ct(table=13)
table=12,priority=1  action=drop
table=13             ip,ct_state=+trk+est action=goto_table:20
table=13             ip,ct_state=+trk+new action=ct(commit,table=20)
table=13             ip,ct_state=+trk+inv action=drop
table=20             ip,nw_src=10.1.1.1 action=set_field:f0:00:00:01:01:01->eth_src,goto_table:21
table=20             ip,nw_src=10.1.1.2 action=set_field:f0:00:00:01:01:02->eth_src,goto_table:21
table=20             ip,nw_src=10.254.254.0/24 action=set_field:f0:00:00:01:01:FE->eth_src,goto_table:21
table=21             ip,nw_dst=10.1.1.1 action=set_field:f0:00:00:01:01:01->eth_dst,output:ovs-p0
table=21             ip,nw_dst=10.1.1.2 action=set_field:f0:00:00:01:01:02->eth_dst,output:ovs-p1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5826: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5826"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5826"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5829: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo \"foobar\" |nc \$NC_EOF_OPT 10.1.1.1 1234
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5829"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo "foobar" |nc $NC_EOF_OPT 10.1.1.1 1234
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5829"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ovs-appctl dpctl/dump-conntrack | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' |
grep "tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=TIME_WAIT)"

}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5830" "until ovs-appctl dpctl/dump-conntrack | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' |
grep \"tcp,orig=(src=10.1.1.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=TIME_WAIT)\"
"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5838: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo \"foobar\" |nc \$NC_EOF_OPT 10.254.254.1 1234
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5838"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo "foobar" |nc $NC_EOF_OPT 10.254.254.1 1234
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5838"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ovs-appctl dpctl/dump-conntrack | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' |
grep "tcp,orig=(src=10.254.254.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.254.254.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=TIME_WAIT)"

}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5839" "until ovs-appctl dpctl/dump-conntrack | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' |
grep \"tcp,orig=(src=10.254.254.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.254.254.2,sport=<cleared>,dport=<cleared>),protoinfo=(state=TIME_WAIT)\"
"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5843: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5843"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5843: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5843"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5843: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5843"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5843" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5843: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5843"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5843: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5843"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5843" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5843: :; "
at_fn_check_prepare_trace "system-traffic.at:5843"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_120
#AT_START_121
at_fn_group_banner 121 'system-traffic.at:5846' \
  "conntrack - negative test for recirculation optimization" "" 4
at_xfail=no
(
  $as_echo "121. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

$as_echo "system-traffic.at:5849" >"$at_check_line_file"
(test $HAVE_NC = no) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5849"
modprobe nf_conntrack_ipv4 || echo "Module nf_conntrack_ipv4 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv4'
                modprobe nf_conntrack_ipv6 || echo "Module nf_conntrack_ipv6 not loaded."
                 on_exit 'modprobe -r nf_conntrack_ipv6'
                modprobe nf_nat_ftp || echo "Module nf_nat_ftp not loaded."
                 on_exit 'modprobe -r nf_nat_ftp'
                modprobe nf_nat_tftp || echo "Module nf_nat_tftp not loaded."
                 on_exit 'modprobe -r nf_nat_tftp'

     sysctl -w net.netfilter.nf_conntrack_helper=0
     on_exit 'ovstest test-netlink-conntrack flush'


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5851: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5851"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5851"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5851"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5851"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5851"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5851"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5851"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5851: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:5851"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5851"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:5852" >"$at_check_line_file"
(! grep -q "Datapath supports ct_clear action" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5852"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5854: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5854"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5854"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5854: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5854"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5854"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5855"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5855"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5855"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5855"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5855"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5855"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""f0:00:00:01:01:01""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address \"f0:00:00:01:01:01\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5855"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address "f0:00:00:01:01:01"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5855: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5855"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5855"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'

  { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5856"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5856"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5856"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5856"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5856"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5856"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""f0:00:00:01:01:02""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address \"f0:00:00:01:01:02\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5856"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address "f0:00:00:01:01:02"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5856: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5856"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5856"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5859: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.2 lladdr f0:00:00:01:01:02 dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5859"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.2 lladdr f0:00:00:01:01:02 dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5859"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5860: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.1 lladdr f0:00:00:01:01:01 dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5860"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.1 lladdr f0:00:00:01:01:01 dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5860"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5863: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5863"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5864: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5864"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip neigh add 10.1.1.254 lladdr f0:00:00:01:01:FE dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5864"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5865: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5865"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5865"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5866: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5866"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default nexthop via 10.1.1.254
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5866"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns exec at_ns0 nc -l -k 1234 > /dev/null & echo $! > nc0.pid
     echo "kill \`cat nc0.pid\`" >> cleanup



cat >flows.txt <<'_ATEOF'
table=0,priority=10  ip action=ct(table=1)
table=1,priority=20  ip,ct_state=+trk+est,nw_dst=10.254.254.0/24 action=goto_table:2
table=1,priority=20  ip,ct_state=+trk+new,nw_dst=10.254.254.0/24 action=ct(commit,exec(set_field:1->ct_mark),table=2)
table=2             ip,nw_dst=10.254.254.1 action=set_field:10.1.1.1->nw_dst,goto_table:3
table=2             ip,nw_dst=10.254.254.2 action=set_field:10.1.1.2->nw_dst,goto_table:3
table=3             ip,nw_src=10.1.1.1 action=set_field:10.254.254.1->nw_src,goto_table:4
table=3             ip,nw_src=10.1.1.2 action=set_field:10.254.254.2->nw_src,goto_table:4
table=4             ip,nw_dst=10.1.1.1 action=set_field:f0:00:00:01:01:01->eth_dst,goto_table:5
table=4             ip,nw_dst=10.1.1.2 action=set_field:f0:00:00:01:01:02->eth_dst,goto_table:5
table=5             ip,nw_src=10.254.254.0/24 action=set_field:f0:00:00:01:01:FE->eth_src,goto_table:6
table=6,priority=10 ip action=ct(table=7)
table=7             ip,ct_state=+trk+est action=goto_table:8
table=7             ip,ct_mark=0x0,ct_state=+trk+new action=ct(commit,exec(set_field:2->ct_mark),table=8)
table=8             ip,nw_dst=10.1.1.1 action=output:ovs-p0
table=8             ip,nw_dst=10.1.1.2 action=output:ovs-p1
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5895: ovs-ofctl --bundle add-flows br0 flows.txt"
at_fn_check_prepare_trace "system-traffic.at:5895"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5895"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5897: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo \"foobar\" |nc \$NC_EOF_OPT 10.254.254.1 1234
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5897"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
echo "foobar" |nc $NC_EOF_OPT 10.254.254.1 1234
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5897"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5899: ovs-appctl dpctl/dump-conntrack | grep \"dst=10.254.254\" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq"
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:5899"
( $at_check_trace; ovs-appctl dpctl/dump-conntrack | grep "dst=10.254.254" | sed -e 's/port=[0-9]*/port=<cleared>/g' -e 's/id=[0-9]*/id=<cleared>/g' -e 's/state=[0-9_A-Z]*/state=<cleared>/g' | sort | uniq
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "tcp,orig=(src=10.1.1.2,dst=10.254.254.1,sport=<cleared>,dport=<cleared>),reply=(src=10.254.254.1,dst=10.1.1.2,sport=<cleared>,dport=<cleared>),mark=1,protoinfo=(state=<cleared>)
tcp,orig=(src=10.254.254.2,dst=10.1.1.1,sport=<cleared>,dport=<cleared>),reply=(src=10.1.1.1,dst=10.254.254.2,sport=<cleared>,dport=<cleared>),mark=2,protoinfo=(state=<cleared>)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5899"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs-appctl dpif/dump-flows br0

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5906: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5906"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5906: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5906"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5906: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5906"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5906" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5906: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5906"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5906: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5906"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5906" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5906: :; "
at_fn_check_prepare_trace "system-traffic.at:5906"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5906"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_121
#AT_START_122
at_fn_group_banner 122 'system-traffic.at:5911' \
  "802.1ad - vlan_limit" "                           " 5
at_xfail=no
(
  $as_echo "122. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5912: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5912"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5912"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5912"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5912"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5912"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5912"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5912"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5912: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:5912"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5912"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:5913" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5913"
     $as_echo "system-traffic.at:5913" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5913"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5915: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5915"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5915"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5915: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5915"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5915"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5917"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5917"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5917"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5917"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5917"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5917"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5917"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5917: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5917"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5917"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5918"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5918"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5918"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5918"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5918"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5918"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5918"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5918: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5918"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:5920: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5920"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5920: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5920"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5920: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"10.255.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5920"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "10.255.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5920: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5920"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:5921: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5921"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5921: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5921"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5921: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"10.255.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5921"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "10.255.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5921: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5921"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:5923: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5923"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5923: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5923"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5923: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5923"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:5923: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5923"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5923"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:5924: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5924"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5924: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5924"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5924: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5924"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:5924: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5924"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5924"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





{ set +x
$as_echo "$at_srcdir/system-traffic.at:5926: ovs-ofctl add-flow br0 \"priority=1 action=normal\""
at_fn_check_prepare_trace "system-traffic.at:5926"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=1 action=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5928" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5931: ovs-appctl revalidator/purge"
at_fn_check_prepare_trace "system-traffic.at:5931"
( $at_check_trace; ovs-appctl revalidator/purge
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5931"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5932: ovs-vsctl set Open_vSwitch . other_config:vlan-limit=1"
at_fn_check_prepare_trace "system-traffic.at:5932"
( $at_check_trace; ovs-vsctl set Open_vSwitch . other_config:vlan-limit=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5932"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5933: ovs-ofctl add-flow br0 \"priority=100 dl_type=0x8100 action=drop\""
at_fn_check_prepare_trace "system-traffic.at:5933"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=100 dl_type=0x8100 action=drop"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5933"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-traffic.at:5934: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 -w 3 10.2.2.2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5934"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 -w 3 10.2.2.2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; cat "$at_stdout"
at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:5934"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5936: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5936"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5936: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5936"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5936: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5936"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5936" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5936: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5936"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5936: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5936"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5936" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5936: :; "
at_fn_check_prepare_trace "system-traffic.at:5936"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5936"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_122
#AT_START_123
at_fn_group_banner 123 'system-traffic.at:5940' \
  "802.1ad - push/pop outer 802.1ad" "               " 5
at_xfail=no
(
  $as_echo "123. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5941: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5941"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5941"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5941"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5941"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5941"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5941"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5941"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5941: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:5941"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5941"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:5942" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5942"
     $as_echo "system-traffic.at:5942" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5942"

ovs-vsctl add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ovs-vsctl add-br br2 -- set Bridge br2 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5946: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5946"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5946"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:5946: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5946"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5946"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




{ set +x
$as_echo "$at_srcdir/system-traffic.at:5948: ip link add ovs-p0 type veth peer name ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:5948"
( $at_check_trace; ip link add ovs-p0 type veth peer name ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5948"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5949: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:5949"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5949"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5950: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:5950"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5950"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5951: ovs-vsctl add-port br0 ovs-p0"
at_fn_check_prepare_trace "system-traffic.at:5951"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5952: ovs-vsctl add-port br1 ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:5952"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5952"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p0'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5955: ip link add ovs-p2 type veth peer name ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:5955"
( $at_check_trace; ip link add ovs-p2 type veth peer name ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5955"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5956: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:5956"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5956"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5957: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:5957"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5957"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5958: ovs-vsctl add-port br0 ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:5958"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5958"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5959: ovs-vsctl add-port br2 ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:5959"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5959"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'

 { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip link add p4 type veth peer name ovs-p4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5962"
( $at_check_trace; ip link add p4 type veth peer name ovs-p4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip link set p4 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:5962"
( $at_check_trace; ip link set p4 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip link set dev ovs-p4 up"
at_fn_check_prepare_trace "system-traffic.at:5962"
( $at_check_trace; ip link set dev ovs-p4 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ovs-vsctl add-port br1 ovs-p4 -- \\
                set interface ovs-p4 external-ids:iface-id=\"p4\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5962"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p4 -- \
                set interface ovs-p4 external-ids:iface-id="p4"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p4
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5962"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p4
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5962"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5962"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5962: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5962"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5962"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p4'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip link add p5 type veth peer name ovs-p5 || return 77"
at_fn_check_prepare_trace "system-traffic.at:5963"
( $at_check_trace; ip link add p5 type veth peer name ovs-p5 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip link set p5 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:5963"
( $at_check_trace; ip link set p5 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip link set dev ovs-p5 up"
at_fn_check_prepare_trace "system-traffic.at:5963"
( $at_check_trace; ip link set dev ovs-p5 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ovs-vsctl add-port br2 ovs-p5 -- \\
                set interface ovs-p5 external-ids:iface-id=\"p5\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5963"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p5 -- \
                set interface ovs-p5 external-ids:iface-id="p5"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p5
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5963"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p5
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5963"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5963"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:5963: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5963"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5963"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p5'


   { set +x
$as_echo "$at_srcdir/system-traffic.at:5964: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5964"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5964"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5964: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5964"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5964"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5964: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5964"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5964"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:5964: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5964"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5964"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:5965: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5965"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5965: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5965"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:5965: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5965"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:5965: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5965"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5965"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows-br0.txt <<'_ATEOF'
priority=1 action=drop
priority=100 in_port=1 action=push_vlan:0x88a8,mod_vlan_vid=4094,output:2
priority=100 in_port=2 action=push_vlan:0x88a8,mod_vlan_vid=4094,output:1
_ATEOF


cat >flows-customer-br.txt <<'_ATEOF'
priority=1 action=normal
priority=100 in_port=1 vlan_tci=0x1000/0x1000 action=pop_vlan,normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:5978: ovs-ofctl --bundle add-flows br0 flows-br0.txt"
at_fn_check_prepare_trace "system-traffic.at:5978"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows-br0.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5979: ovs-ofctl --bundle add-flows br1 flows-customer-br.txt"
at_fn_check_prepare_trace "system-traffic.at:5979"
( $at_check_trace; ovs-ofctl --bundle add-flows br1 flows-customer-br.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5979"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5980: ovs-ofctl --bundle add-flows br2 flows-customer-br.txt"
at_fn_check_prepare_trace "system-traffic.at:5980"
( $at_check_trace; ovs-ofctl --bundle add-flows br2 flows-customer-br.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5980"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5982" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:5984: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5984"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5984"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:5988: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5988"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5988"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:5992: check_logs "
at_fn_check_prepare_trace "system-traffic.at:5992"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5992: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:5992"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5992: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:5992"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5992" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5992: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:5992"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5992: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:5992"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:5992" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:5992: :; "
at_fn_check_prepare_trace "system-traffic.at:5992"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5992"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_123
#AT_START_124
at_fn_group_banner 124 'system-traffic.at:5996' \
  "802.1ad - push/pop outer 802.1q" "                " 5
at_xfail=no
(
  $as_echo "124. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:5997: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:5997"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:5997"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:5997"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5997"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:5997"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:5997"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:5997"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:5997: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:5997"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:5997"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:5998" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5998"
     $as_echo "system-traffic.at:5998" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:5998"

ovs-vsctl add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ovs-vsctl add-br br2 -- set Bridge br2 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6002: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6002"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6002"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6002: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6002"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6002"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




{ set +x
$as_echo "$at_srcdir/system-traffic.at:6004: ip link add ovs-p0 type veth peer name ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:6004"
( $at_check_trace; ip link add ovs-p0 type veth peer name ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6004"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6005: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6005"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6006: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6006"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6006"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6007: ovs-vsctl add-port br0 ovs-p0"
at_fn_check_prepare_trace "system-traffic.at:6007"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6007"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6008: ovs-vsctl add-port br1 ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:6008"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6008"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p0'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6011: ip link add ovs-p2 type veth peer name ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:6011"
( $at_check_trace; ip link add ovs-p2 type veth peer name ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6012: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:6012"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6012"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6013: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:6013"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6013"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6014: ovs-vsctl add-port br0 ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:6014"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6014"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6015: ovs-vsctl add-port br2 ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:6015"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6015"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip link add p4 type veth peer name ovs-p4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6018"
( $at_check_trace; ip link add p4 type veth peer name ovs-p4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip link set p4 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6018"
( $at_check_trace; ip link set p4 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip link set dev ovs-p4 up"
at_fn_check_prepare_trace "system-traffic.at:6018"
( $at_check_trace; ip link set dev ovs-p4 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ovs-vsctl add-port br1 ovs-p4 -- \\
                set interface ovs-p4 external-ids:iface-id=\"p4\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6018"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p4 -- \
                set interface ovs-p4 external-ids:iface-id="p4"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p4
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6018"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p4
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6018"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6018"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6018: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6018"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6018"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p4'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip link add p5 type veth peer name ovs-p5 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6019"
( $at_check_trace; ip link add p5 type veth peer name ovs-p5 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip link set p5 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6019"
( $at_check_trace; ip link set p5 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip link set dev ovs-p5 up"
at_fn_check_prepare_trace "system-traffic.at:6019"
( $at_check_trace; ip link set dev ovs-p5 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ovs-vsctl add-port br2 ovs-p5 -- \\
                set interface ovs-p5 external-ids:iface-id=\"p5\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6019"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p5 -- \
                set interface ovs-p5 external-ids:iface-id="p5"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p5
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6019"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p5
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6019"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6019"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6019: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6019"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6019"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p5'


   { set +x
$as_echo "$at_srcdir/system-traffic.at:6020: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6020"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6020"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6020: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6020"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6020"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6020: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6020"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6020"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6020: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6020"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6020"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6021: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6021"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6021"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6021: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6021"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6021"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6021: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6021"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6021"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6021: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6021"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6021"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows-br0.txt <<'_ATEOF'
priority=1 action=drop
priority=100 in_port=1 action=push_vlan:0x8100,mod_vlan_vid=4094,output:2
priority=100 in_port=2 action=push_vlan:0x8100,mod_vlan_vid=4094,output:1
_ATEOF


cat >flows-customer-br.txt <<'_ATEOF'
priority=1 action=normal
priority=100 in_port=1 vlan_tci=0x1000/0x1000 action=pop_vlan,normal
_ATEOF


{ set +x
$as_echo "$at_srcdir/system-traffic.at:6034: ovs-ofctl --bundle add-flows br0 flows-br0.txt"
at_fn_check_prepare_trace "system-traffic.at:6034"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows-br0.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6034"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6035: ovs-ofctl --bundle add-flows br1 flows-customer-br.txt"
at_fn_check_prepare_trace "system-traffic.at:6035"
( $at_check_trace; ovs-ofctl --bundle add-flows br1 flows-customer-br.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6035"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6036: ovs-ofctl --bundle add-flows br2 flows-customer-br.txt"
at_fn_check_prepare_trace "system-traffic.at:6036"
( $at_check_trace; ovs-ofctl --bundle add-flows br2 flows-customer-br.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6036"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6038" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6040: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6040"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6040"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6044: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6044"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6044"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6048: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6048"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6048: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6048"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6048: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6048"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6048" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6048: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6048"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6048: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6048"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6048" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6048: :; "
at_fn_check_prepare_trace "system-traffic.at:6048"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_124
#AT_START_125
at_fn_group_banner 125 'system-traffic.at:6052' \
  "802.1ad - 802.1q tunnel" "                        " 5
at_xfail=no
(
  $as_echo "125. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6053: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6053"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6053"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6053"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6053"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6053"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6053"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6053"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6053: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:6053"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6053"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:6054" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:6054"
     $as_echo "system-traffic.at:6054" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:6054"

ovs-vsctl add-br br1 -- set Bridge br1 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ovs-vsctl add-br br2 -- set Bridge br2 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6058: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6058"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6058"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6058: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6058"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6058"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




{ set +x
$as_echo "$at_srcdir/system-traffic.at:6060: ip link add ovs-p0 type veth peer name ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:6060"
( $at_check_trace; ip link add ovs-p0 type veth peer name ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6061: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6061"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6061"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6062: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6062"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6062"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6063: ovs-vsctl add-port br0 ovs-p0"
at_fn_check_prepare_trace "system-traffic.at:6063"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6063"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6064: ovs-vsctl add-port br1 ovs-p1"
at_fn_check_prepare_trace "system-traffic.at:6064"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6064"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p0'

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6067: ip link add ovs-p2 type veth peer name ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:6067"
( $at_check_trace; ip link add ovs-p2 type veth peer name ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6067"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6068: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:6068"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6068"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6069: ip link set dev ovs-p3 up"
at_fn_check_prepare_trace "system-traffic.at:6069"
( $at_check_trace; ip link set dev ovs-p3 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6069"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6070: ovs-vsctl add-port br0 ovs-p2"
at_fn_check_prepare_trace "system-traffic.at:6070"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6070"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6071: ovs-vsctl add-port br2 ovs-p3"
at_fn_check_prepare_trace "system-traffic.at:6071"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6071"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-p2'

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip link add p4 type veth peer name ovs-p4 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6074"
( $at_check_trace; ip link add p4 type veth peer name ovs-p4 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip link set p4 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6074"
( $at_check_trace; ip link set p4 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip link set dev ovs-p4 up"
at_fn_check_prepare_trace "system-traffic.at:6074"
( $at_check_trace; ip link set dev ovs-p4 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ovs-vsctl add-port br1 ovs-p4 -- \\
                set interface ovs-p4 external-ids:iface-id=\"p4\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6074"
( $at_check_trace; ovs-vsctl add-port br1 ovs-p4 -- \
                set interface ovs-p4 external-ids:iface-id="p4"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p4
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6074"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p4
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6074"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6074"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6074: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6074"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6074"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p4'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip link add p5 type veth peer name ovs-p5 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6075"
( $at_check_trace; ip link add p5 type veth peer name ovs-p5 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip link set p5 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6075"
( $at_check_trace; ip link set p5 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip link set dev ovs-p5 up"
at_fn_check_prepare_trace "system-traffic.at:6075"
( $at_check_trace; ip link set dev ovs-p5 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ovs-vsctl add-port br2 ovs-p5 -- \\
                set interface ovs-p5 external-ids:iface-id=\"p5\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6075"
( $at_check_trace; ovs-vsctl add-port br2 ovs-p5 -- \
                set interface ovs-p5 external-ids:iface-id="p5"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p5
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6075"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p5
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6075"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6075"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6075: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6075"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6075"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p5'


   { set +x
$as_echo "$at_srcdir/system-traffic.at:6076: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6076"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6076: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6076"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6076: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6076"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6076: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6076"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6076"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6077: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6077"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6077"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6077: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6077"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6077"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6077: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6077"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6077"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6077: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6077"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6077"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.200 type vlan proto 802.1q id 200
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.200 type vlan proto 802.1q id 200
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.200 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.200 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.200 \"10.3.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.200 "10.3.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6078: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.200 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6078"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.200 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.200 type vlan proto 802.1q id 200
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.200 type vlan proto 802.1q id 200
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.200 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.200 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.200 \"10.3.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.200 "10.3.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6079: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.200 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6079"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.200 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6079"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6080: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.300 type vlan proto 802.1q id 300
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6080"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p4 name p4.300 type vlan proto 802.1q id 300
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6080"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6080: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.300 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6080"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p4.300 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6080"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6080: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.300 \"10.4.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6080"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p4.300 "10.4.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6080"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6080: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.300 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6080"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p4.300 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6080"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6081: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.300 type vlan proto 802.1q id 300
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6081"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p5 name p5.300 type vlan proto 802.1q id 300
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6081"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6081: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.300 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6081"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p5.300 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6081"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6081: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.300 \"10.4.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6081"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p5.300 "10.4.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6081"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6081: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.300 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6081"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p5.300 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6081"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





{ set +x
$as_echo "$at_srcdir/system-traffic.at:6083: ovs-ofctl add-flow br0 action=normal"
at_fn_check_prepare_trace "system-traffic.at:6083"
( $at_check_trace; ovs-ofctl add-flow br0 action=normal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6083"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6084: ovs-ofctl add-flow br1 action=normal"
at_fn_check_prepare_trace "system-traffic.at:6084"
( $at_check_trace; ovs-ofctl add-flow br1 action=normal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6084"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6085: ovs-ofctl add-flow br2 action=normal"
at_fn_check_prepare_trace "system-traffic.at:6085"
( $at_check_trace; ovs-ofctl add-flow br2 action=normal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6085"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6086: ovs-vsctl set port ovs-p0 vlan_mode=dot1q-tunnel tag=4094 cvlans=100,200"
at_fn_check_prepare_trace "system-traffic.at:6086"
( $at_check_trace; ovs-vsctl set port ovs-p0 vlan_mode=dot1q-tunnel tag=4094 cvlans=100,200
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6086"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6087: ovs-vsctl set port ovs-p2 vlan_mode=dot1q-tunnel tag=4094 cvlans=100,200"
at_fn_check_prepare_trace "system-traffic.at:6087"
( $at_check_trace; ovs-vsctl set port ovs-p2 vlan_mode=dot1q-tunnel tag=4094 cvlans=100,200
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6087"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6089" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"

ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.3.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6090" "until ip netns exec at_ns0 ping -c 1 10.3.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6092: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6092"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6092"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6096: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.3.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6096"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.3.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6096"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6100: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6100"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6100"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6104: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.3.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6104"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.3.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6109: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 -w 3 10.4.2.2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6109"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 1 -w 3 10.4.2.2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; cat "$at_stdout"
at_fn_check_status 1 $at_status "$at_srcdir/system-traffic.at:6109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6111: check_logs \"/dropping VLAN \\(0\\|300\\) packet received on dot1q-tunnel port/d\""
at_fn_check_prepare_notrace 'a shell pipeline' "system-traffic.at:6111"
( $at_check_trace; check_logs "/dropping VLAN \(0\|300\) packet received on dot1q-tunnel port/d"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6111: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6111"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6111: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6111"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6111" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6111: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6111"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6111: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6111"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6111" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6111: :; "
at_fn_check_prepare_trace "system-traffic.at:6111"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6111"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_125
#AT_START_126
at_fn_group_banner 126 'system-traffic.at:6114' \
  "802.1ad - double vlan match" "                    " 5
at_xfail=no
(
  $as_echo "126. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6115: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6115"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6115"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6115"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6115"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6115"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6115"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6115"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6115: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0 "
at_fn_check_prepare_trace "system-traffic.at:6115"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Open_vSwitch . other_config:vlan-limit=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-traffic.at:6116" >"$at_check_line_file"
(! grep -q "VLAN header stack length probed as" ovs-vswitchd.log) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:6116"
     $as_echo "system-traffic.at:6116" >"$at_check_line_file"
(test `sed -n 's/.*VLAN header stack length probed as \([0-9]\+\).*/\1/p' ovs-vswitchd.log` -lt 2) \
  && at_fn_check_skip 77 "$at_srcdir/system-traffic.at:6116"

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6118: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6118"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6118: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6118"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6118"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6120"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6120"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6120"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6120"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6120"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6120"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6120"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6120: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6120"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6121"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6121"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6121"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6121"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"10.1.1.2/24\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6121"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "10.1.1.2/24" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6121"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6121"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6121: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6121"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6121"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



  { set +x
$as_echo "$at_srcdir/system-traffic.at:6123: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6123"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0 name p0.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6123: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6123"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6123: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 \"10.255.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6123"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094 "10.255.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6123: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6123"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




  { set +x
$as_echo "$at_srcdir/system-traffic.at:6124: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6124"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1 name p1.4094 type vlan proto 802.1ad id 4094
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6124: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6124"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6124: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 \"10.255.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6124"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094 "10.255.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6124: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6124"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094 mtu 1496
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





   { set +x
$as_echo "$at_srcdir/system-traffic.at:6126: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6126"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add link p0.4094 name p0.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6126: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6126"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6126: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 \"10.2.2.1/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6126"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev p0.4094.100 "10.2.2.1/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6126: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6126"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set p0.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




   { set +x
$as_echo "$at_srcdir/system-traffic.at:6127: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6127"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link add link p1.4094 name p1.4094.100 type vlan proto 802.1q id 100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6127"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6127: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6127"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1.4094.100 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6127"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6127: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 \"10.2.2.2/24\"
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6127"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add dev p1.4094.100 "10.2.2.2/24"
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6127"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }




       { set +x
$as_echo "$at_srcdir/system-traffic.at:6127: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6127"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set p1.4094.100 mtu 1492
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6127"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }





cat >flows-br0.txt <<'_ATEOF'
table=0,priority=1                action=drop
table=0,priority=100 dl_vlan=4094 action=pop_vlan,goto_table:1
table=1,priority=100 dl_vlan=100  action=push_vlan:0x88a8,mod_vlan_vid:4094,normal
_ATEOF

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6134: ovs-ofctl --bundle add-flows br0 flows-br0.txt"
at_fn_check_prepare_trace "system-traffic.at:6134"
( $at_check_trace; ovs-ofctl --bundle add-flows br0 flows-br0.txt
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6134"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.2.2.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6136" "until ip netns exec at_ns0 ping -c 1 10.2.2.2"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6138: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6138"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6138"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-traffic.at:6142: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6142"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 1600 -q -c 3 -i 0.3 -w 2 10.2.2.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6142"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6146: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6146"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6146: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6146"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6146: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6146"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6146" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6146: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6146"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6146: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6146"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6146" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6146: :; "
at_fn_check_prepare_trace "system-traffic.at:6146"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_126
#AT_START_127
at_fn_group_banner 127 'system-traffic.at:6152' \
  "nsh - encap header" "                             " 6
at_xfail=no
(
  $as_echo "127. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6153: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6153"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6153"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6153"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6153"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6153"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6153"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6153"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6153: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:6153"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6155: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6155"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6155"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6155: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6155"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6155"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6157"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6157"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6157"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6157"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6157"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6157"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6157"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6157: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6157"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6157"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6158"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6158"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6158"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6158"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6158"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6158"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6158"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6158: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6158"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6162: ovs-ofctl -Oopenflow13 add-flow br0 \"table=0,priority=100,in_port=ovs-p0,ip,actions=encap(nsh(md_type=1)),set_field:0x1234->nsh_spi,set_field:0x11223344->nsh_c1,encap(ethernet),set_field:f2:ff:00:00:00:02->dl_dst,set_field:f2:ff:00:00:00:01->dl_src,ovs-p1\""
at_fn_check_prepare_trace "system-traffic.at:6162"
( $at_check_trace; ovs-ofctl -Oopenflow13 add-flow br0 "table=0,priority=100,in_port=ovs-p0,ip,actions=encap(nsh(md_type=1)),set_field:0x1234->nsh_spi,set_field:0x11223344->nsh_c1,encap(ethernet),set_field:f2:ff:00:00:00:02->dl_dst,set_field:f2:ff:00:00:00:01->dl_src,ovs-p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6164: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6164"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6164"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6170: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
\$PYTHON3 \$srcdir/sendpkt.py p0 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6170"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
$PYTHON3 $srcdir/sendpkt.py p0 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_wait_cond () {
    cat p1.pcap | egrep "0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *0fc6" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6173" "until cat p1.pcap | egrep \"0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *0fc6\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0010: *0103 *0012 *34ff *1122 *3344 *0000 *0000 *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6174" "until cat p1.pcap | egrep \"0x0010: *0103 *0012 *34ff *1122 *3344 *0000 *0000 *0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0020: *0000 *0000 *0000 *f200 *0000 *0002 *f200 *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6175" "until cat p1.pcap | egrep \"0x0020: *0000 *0000 *0000 *f200 *0000 *0002 *f200 *0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6176" "until cat p1.pcap | egrep \"0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6177" "until cat p1.pcap | egrep \"0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0050: *0000 *0000 *5002 *2000 *b85e *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6178" "until cat p1.pcap | egrep \"0x0050: *0000 *0000 *5002 *2000 *b85e *0000\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:6180: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6180"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6180: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6180"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6180: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6180"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6180" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6180: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6180"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6180: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6180"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6180" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6180: :; "
at_fn_check_prepare_trace "system-traffic.at:6180"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_127
#AT_START_128
at_fn_group_banner 128 'system-traffic.at:6184' \
  "nsh - decap header" "                             " 6
at_xfail=no
(
  $as_echo "128. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6185: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6185"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6185"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6185"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6185"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6185"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6185"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6185"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6185: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:6185"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6187: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6187"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6187: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6187"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6187"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6189"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6189"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6189"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6189"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6189"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6189"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6189"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6189: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6189"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6189"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6190"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6190"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6190"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6190"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6190"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6190"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6190"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6190: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6190"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6194: ovs-ofctl -Oopenflow13 add-flow br0 \"table=0,priority=100,in_port=ovs-p0,dl_type=0x894f, actions=decap(),decap(), ovs-p1\""
at_fn_check_prepare_trace "system-traffic.at:6194"
( $at_check_trace; ovs-ofctl -Oopenflow13 add-flow br0 "table=0,priority=100,in_port=ovs-p0,dl_type=0x894f, actions=decap(),decap(), ovs-p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6196: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6196"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6202: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
\$PYTHON3 \$srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 00 64 03 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6202"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
$PYTHON3 $srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 00 64 03 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6202"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_wait_cond () {
    cat p1.pcap | egrep "0x0000: *f200 *0000 *0002 *f200 *0000 *0001 *0800 *4500" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6205" "until cat p1.pcap | egrep \"0x0000: *f200 *0000 *0002 *f200 *0000 *0001 *0800 *4500\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0010: *0028 *0001 *0000 *4006 *b013 *c0a8 *000a *0a00" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6206" "until cat p1.pcap | egrep \"0x0010: *0028 *0001 *0000 *4006 *b013 *c0a8 *000a *0a00\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0020: *000a *0400 *0800 *0000 *00c8 *0000 *0000 *5002" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6207" "until cat p1.pcap | egrep \"0x0020: *000a *0400 *0800 *0000 *00c8 *0000 *0000 *5002\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0030: *2000 *b85e *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6208" "until cat p1.pcap | egrep \"0x0030: *2000 *b85e *0000\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:6210: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6210"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6210: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6210"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6210: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6210"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6210" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6210: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6210"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6210: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6210"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6210" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6210: :; "
at_fn_check_prepare_trace "system-traffic.at:6210"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6210"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_128
#AT_START_129
at_fn_group_banner 129 'system-traffic.at:6214' \
  "nsh - replace header" "                           " 6
at_xfail=no
(
  $as_echo "129. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6215: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6215"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6215"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6215"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6215"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6215"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6215"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6215"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6215: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:6215"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6217: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6217"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6217: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6217"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6219"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6219"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6219"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6219"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6219: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6219"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6220"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6220"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6220"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6220"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6220"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6220"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6220"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6220: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6220"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6226: ovs-ofctl -Oopenflow13 add-flow br0 \"table=0,priority=100,in_port=ovs-p0,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x03,actions=decap(),decap(),encap(nsh(md_type=1)),set_field:0x07->nsh_ttl,set_field:0x0101->nsh_spi,set_field:0x04->nsh_si,set_field:0x100f0e0d->nsh_c1,set_field:0x0c0b0a09->nsh_c2,set_field:0x08070605->nsh_c3,set_field:0x04030201->nsh_c4,encap(ethernet),set_field:f2:ff:00:00:00:02->dl_dst,set_field:f2:ff:00:00:00:01->dl_src,ovs-p1\""
at_fn_check_prepare_trace "system-traffic.at:6226"
( $at_check_trace; ovs-ofctl -Oopenflow13 add-flow br0 "table=0,priority=100,in_port=ovs-p0,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x03,actions=decap(),decap(),encap(nsh(md_type=1)),set_field:0x07->nsh_ttl,set_field:0x0101->nsh_spi,set_field:0x04->nsh_si,set_field:0x100f0e0d->nsh_c1,set_field:0x0c0b0a09->nsh_c2,set_field:0x08070605->nsh_c3,set_field:0x04030201->nsh_c4,encap(ethernet),set_field:f2:ff:00:00:00:02->dl_dst,set_field:f2:ff:00:00:00:01->dl_src,ovs-p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6228: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6228"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6228"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6235: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
\$PYTHON3 \$srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 01 00 03 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6235"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
$PYTHON3 $srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 01 00 03 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6235"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_wait_cond () {
    cat p1.pcap | egrep "0x0000: *f2ff *0000 *0002 *f2ff *0000* 0001 *894f *01c6" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6238" "until cat p1.pcap | egrep \"0x0000: *f2ff *0000 *0002 *f2ff *0000* 0001 *894f *01c6\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0010: *0103 *0001 *0104 *100f *0e0d *0c0b *0a09 *0807" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6239" "until cat p1.pcap | egrep \"0x0010: *0103 *0001 *0104 *100f *0e0d *0c0b *0a09 *0807\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0020: *0605 *0403 *0201 *f200 *0000 *0002 *f200 *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6240" "until cat p1.pcap | egrep \"0x0020: *0605 *0403 *0201 *f200 *0000 *0002 *f200 *0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6241" "until cat p1.pcap | egrep \"0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6242" "until cat p1.pcap | egrep \"0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0050: *0000 *0000 *5002 *2000 *b85e *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6243" "until cat p1.pcap | egrep \"0x0050: *0000 *0000 *5002 *2000 *b85e *0000\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:6245: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6245"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6245: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6245"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6245: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6245"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6245" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6245: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6245"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6245: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6245"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6245" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6245: :; "
at_fn_check_prepare_trace "system-traffic.at:6245"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_129
#AT_START_130
at_fn_group_banner 130 'system-traffic.at:6249' \
  "nsh - forward" "                                  " 6
at_xfail=no
(
  $as_echo "130. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6250: modprobe openvswitch"
at_fn_check_prepare_trace "system-traffic.at:6250"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-traffic.at:6250"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-traffic.at:6250"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6250"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-traffic.at:6250"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-traffic.at:6250"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6250"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6250: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-traffic.at:6250"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6252: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6252"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6252"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns1



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6252: ip netns add at_ns1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6252"
( $at_check_trace; ip netns add at_ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6252"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns1


'
                ip netns exec at_ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del at_ns2



                { set +x
$as_echo "$at_srcdir/system-traffic.at:6252: ip netns add at_ns2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6252"
( $at_check_trace; ip netns add at_ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6252"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns2


'
                ip netns exec at_ns2 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6254"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-traffic.at:6254"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-traffic.at:6254"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ovs-vsctl add-port br0 ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6254"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6254"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6254"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6254"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6254: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6254"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6254"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip link add p1 type veth peer name ovs-p1 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6255"
( $at_check_trace; ip link add p1 type veth peer name ovs-p1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip link set p1 netns at_ns1"
at_fn_check_prepare_trace "system-traffic.at:6255"
( $at_check_trace; ip link set p1 netns at_ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip link set dev ovs-p1 up"
at_fn_check_prepare_trace "system-traffic.at:6255"
( $at_check_trace; ip link set dev ovs-p1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ovs-vsctl add-port br0 ovs-p1 -- \\
                set interface ovs-p1 external-ids:iface-id=\"p1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6255"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p1 -- \
                set interface ovs-p1 external-ids:iface-id="p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6255"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6255"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6255"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip link set dev p1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6255: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6255"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6255"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p1'


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip link add p2 type veth peer name ovs-p2 || return 77"
at_fn_check_prepare_trace "system-traffic.at:6256"
( $at_check_trace; ip link add p2 type veth peer name ovs-p2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip link set p2 netns at_ns2"
at_fn_check_prepare_trace "system-traffic.at:6256"
( $at_check_trace; ip link set p2 netns at_ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip link set dev ovs-p2 up"
at_fn_check_prepare_trace "system-traffic.at:6256"
( $at_check_trace; ip link set dev ovs-p2 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ovs-vsctl add-port br0 ovs-p2 -- \\
                set interface ovs-p2 external-ids:iface-id=\"p2\""
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6256"
( $at_check_trace; ovs-vsctl add-port br0 ovs-p2 -- \
                set interface ovs-p2 external-ids:iface-id="p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add \"0.0.0.0\" dev p2
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6256"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip addr add "0.0.0.0" dev p2
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6256"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6256"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip link set dev p2 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-traffic.at:6256: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6256"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6256"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p2'



{ set +x
$as_echo "$at_srcdir/system-traffic.at:6261: ovs-ofctl -Oopenflow13 add-flow br0 \"table=0,priority=100,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x02,actions=ovs-p1\""
at_fn_check_prepare_trace "system-traffic.at:6261"
( $at_check_trace; ovs-ofctl -Oopenflow13 add-flow br0 "table=0,priority=100,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x02,actions=ovs-p1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6261"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-traffic.at:6262: ovs-ofctl -Oopenflow13 add-flow br0 \"table=0,priority=100,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x01,actions=ovs-p2\""
at_fn_check_prepare_trace "system-traffic.at:6262"
( $at_check_trace; ovs-ofctl -Oopenflow13 add-flow br0 "table=0,priority=100,dl_type=0x894f,nsh_spi=0x100,nsh_si=0x01,actions=ovs-p2"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6262"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6264: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6264"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p1 > p1.pcap &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6264"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6265: ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p2 > p2.pcap &
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6265"
( $at_check_trace; ip netns exec at_ns2 sh << NS_EXEC_HEREDOC
tcpdump -l -n -xx -U -i p2 > p2.pcap &
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6265"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


sleep 1

 { set +x
$as_echo "$at_srcdir/system-traffic.at:6269: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
\$PYTHON3 \$srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 01 00 02 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6269"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
$PYTHON3 $srcdir/sendpkt.py p0 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 02 06 01 03 00 01 00 02 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6269"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_wait_cond () {
    cat p1.pcap | egrep "0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *0206" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6272" "until cat p1.pcap | egrep \"0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *0206\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0010: *0103 *0001 *0002 *0102 *0304 *0506 *0708 *090a" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6273" "until cat p1.pcap | egrep \"0x0010: *0103 *0001 *0002 *0102 *0304 *0506 *0708 *090a\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0020: *0b0c *0d0e *0f10 *f200 *0000 *0002 *f200 *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6274" "until cat p1.pcap | egrep \"0x0020: *0b0c *0d0e *0f10 *f200 *0000 *0002 *f200 *0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6275" "until cat p1.pcap | egrep \"0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6276" "until cat p1.pcap | egrep \"0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p1.pcap | egrep "0x0050: *0000 *0000 *5002 *2000 *b85e *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6277" "until cat p1.pcap | egrep \"0x0050: *0000 *0000 *5002 *2000 *b85e *0000\" 2>&1 1>/dev/null"


 { set +x
$as_echo "$at_srcdir/system-traffic.at:6280: ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
\$PYTHON3 \$srcdir/sendpkt.py p1 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 01 c6 01 03 00 01 00 01 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-traffic.at:6280"
( $at_check_trace; ip netns exec at_ns1 sh << NS_EXEC_HEREDOC
$PYTHON3 $srcdir/sendpkt.py p1 f2 ff 00 00 00 02 f2 ff 00 00 00 01 89 4f 01 c6 01 03 00 01 00 01 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 f2 00 00 00 00 02 f2 00 00 00 00 01 08 00 45 00 00 28 00 01 00 00 40 06 b0 13 c0 a8 00 0a 0a 00 00 0a 04 00 08 00 00 00 00 c8 00 00 00 00 50 02 20 00 b8 5e 00 00 > /dev/null
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_wait_cond () {
    cat p2.pcap | egrep "0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *01c6" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6283" "until cat p2.pcap | egrep \"0x0000: *f2ff *0000 *0002 *f2ff *0000 *0001 *894f *01c6\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p2.pcap | egrep "0x0010: *0103 *0001 *0001 *0102 *0304 *0506 *0708 *090a" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6284" "until cat p2.pcap | egrep \"0x0010: *0103 *0001 *0001 *0102 *0304 *0506 *0708 *090a\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p2.pcap | egrep "0x0020: *0b0c *0d0e *0f10 *f200 *0000 *0002 *f200 *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6285" "until cat p2.pcap | egrep \"0x0020: *0b0c *0d0e *0f10 *f200 *0000 *0002 *f200 *0000\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p2.pcap | egrep "0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6286" "until cat p2.pcap | egrep \"0x0030: *0001 *0800 *4500 *0028 *0001 *0000 *4006 *b013\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p2.pcap | egrep "0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6287" "until cat p2.pcap | egrep \"0x0040: *c0a8 *000a *0a00 *000a *0400 *0800 *0000 *00c8\" 2>&1 1>/dev/null"

ovs_wait_cond () {
    cat p2.pcap | egrep "0x0050: *0000 *0000 *5002 *2000 *b85e *0000" 2>&1 1>/dev/null
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6288" "until cat p2.pcap | egrep \"0x0050: *0000 *0000 *5002 *2000 *b85e *0000\" 2>&1 1>/dev/null"


{ set +x
$as_echo "$at_srcdir/system-traffic.at:6290: check_logs "
at_fn_check_prepare_trace "system-traffic.at:6290"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6290: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-traffic.at:6290"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6290: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-traffic.at:6290"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6290" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6290: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-traffic.at:6290"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-traffic.at:6290: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-traffic.at:6290"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-traffic.at:6290" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-traffic.at:6290: :; "
at_fn_check_prepare_trace "system-traffic.at:6290"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-traffic.at:6290"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_130
#AT_START_131
at_fn_group_banner 131 'system-layer3-tunnels.at:3' \
  "layer3 - ping over VXLAN-GPE" "                   " 7
at_xfail=no
(
  $as_echo "131. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: modprobe openvswitch"
at_fn_check_prepare_trace "system-layer3-tunnels.at:4"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-layer3-tunnels.at:4"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-layer3-tunnels.at:4"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:4"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-layer3-tunnels.at:4"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-layer3-tunnels.at:4"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:4"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:4: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Bridge br0 other-config:hwaddr=\"00:12:34:56:78:bb\" "
at_fn_check_prepare_trace "system-layer3-tunnels.at:4"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Bridge br0 other-config:hwaddr="00:12:34:56:78:bb"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:4"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-layer3-tunnels.at:5" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep dstport >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:5"
     $as_echo "system-layer3-tunnels.at:5" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:5"
     $as_echo "system-layer3-tunnels.at:5" >"$at_check_line_file"
(! ip link add foo type vxlan help 2>&1 | grep gpe >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:5"
$as_echo "system-layer3-tunnels.at:6" >"$at_check_line_file"
(! ip route help 2>&1 |grep encap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:6"

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:10: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-layer3-tunnels.at:10"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:10"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-layer3-tunnels.at:13"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-layer3-tunnels.at:13"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:13"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:13"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:13"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:13"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:13"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:13: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:13"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:13"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:14: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:14"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:14"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:15: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:15"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:15"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:19: ovs-vsctl add-port br0 at_vxlan0 -- \\
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1 options:packet_type=legacy_l3 options:exts=gpe"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:19"
( $at_check_trace; ovs-vsctl add-port br0 at_vxlan0 -- \
              set int at_vxlan0 type=vxlan options:remote_ip=172.31.1.1 options:packet_type=legacy_l3 options:exts=gpe
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:19: ip addr add dev br0 10.1.1.2/24"
at_fn_check_prepare_trace "system-layer3-tunnels.at:19"
( $at_check_trace; ip addr add dev br0 10.1.1.2/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:19: ip link set dev br0 up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:19"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:19: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-layer3-tunnels.at:19"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.2/24'


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:21: ip neigh add 10.1.1.1 lladdr 00:12:34:56:78:aa dev br0"
at_fn_check_prepare_trace "system-layer3-tunnels.at:21"
( $at_check_trace; ip neigh add 10.1.1.1 lladdr 00:12:34:56:78:aa dev br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:21"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:22: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan dstport 4789 external gpe
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:22"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_vxlan1 type vxlan dstport 4789 external gpe
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:22"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:23: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:23"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_vxlan1 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:23"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:24: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:24"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_vxlan1 mtu 1450 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:24"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:25: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add 10.1.1.2/32 encap ip id 0 dst 172.31.1.100 dev at_vxlan1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:25"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add 10.1.1.2/32 encap ip id 0 dst 172.31.1.100 dev at_vxlan1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:25"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:27: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:27"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:27"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:30: ovs-ofctl add-flow br0 \"priority=1 action=drop\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:30"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=1 action=drop"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:30"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:31: ovs-ofctl add-flow br0 \"priority=100 ip,nw_dst=10.1.1.1 action=output:at_vxlan0\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:31"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=100 ip,nw_dst=10.1.1.1 action=output:at_vxlan0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:31"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:32: ovs-ofctl add-flow br0 \"priority=100 ip,nw_dst=10.1.1.2 action=mod_dl_src:00:12:34:56:78:aa,mod_dl_dst:00:12:34:56:78:bb,local\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:32"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=100 ip,nw_dst=10.1.1.2 action=mod_dl_src:00:12:34:56:78:aa,mod_dl_dst:00:12:34:56:78:bb,local"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:32"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:34" "until ip netns exec at_ns0 ping -c 1 10.1.1.2"


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:37: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:37"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:37"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:42: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:42"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:42"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:45: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:45"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:45"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: check_logs "
at_fn_check_prepare_trace "system-layer3-tunnels.at:49"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-layer3-tunnels.at:49"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-layer3-tunnels.at:49"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:49" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-layer3-tunnels.at:49"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-layer3-tunnels.at:49"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:49" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:49: :; "
at_fn_check_prepare_trace "system-layer3-tunnels.at:49"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:49"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_131
#AT_START_132
at_fn_group_banner 132 'system-layer3-tunnels.at:52' \
  "layer3 - ping over GRE" "                         " 7
at_xfail=no
(
  $as_echo "132. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: modprobe openvswitch"
at_fn_check_prepare_trace "system-layer3-tunnels.at:53"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-layer3-tunnels.at:53"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-layer3-tunnels.at:53"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:53"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-layer3-tunnels.at:53"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-layer3-tunnels.at:53"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:53"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:53: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Bridge br0 other-config:hwaddr=\"00:12:34:56:78:bb\" "
at_fn_check_prepare_trace "system-layer3-tunnels.at:53"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  -- set Bridge br0 other-config:hwaddr="00:12:34:56:78:bb"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:53"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


$as_echo "system-layer3-tunnels.at:54" >"$at_check_line_file"
(! ip link add foo type gre help 2>&1 | grep "gre " >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:54"
     $as_echo "system-layer3-tunnels.at:54" >"$at_check_line_file"
(systemctl status firewalld 2>&1 | grep running > /dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:54"
$as_echo "system-layer3-tunnels.at:55" >"$at_check_line_file"
(! ip route help 2>&1 |grep encap >/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-layer3-tunnels.at:55"

ovs-vsctl add-br br-underlay -- set Bridge br-underlay protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --

ip netns del at_ns0



                { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:59: ip netns add at_ns0 || return 77"
at_fn_check_prepare_trace "system-layer3-tunnels.at:59"
( $at_check_trace; ip netns add at_ns0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:59"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del at_ns0


'
                ip netns exec at_ns0 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip link add p0 type veth peer name ovs-p0 || return 77"
at_fn_check_prepare_trace "system-layer3-tunnels.at:62"
( $at_check_trace; ip link add p0 type veth peer name ovs-p0 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip link set p0 netns at_ns0"
at_fn_check_prepare_trace "system-layer3-tunnels.at:62"
( $at_check_trace; ip link set p0 netns at_ns0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip link set dev ovs-p0 up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:62"
( $at_check_trace; ip link set dev ovs-p0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ovs-vsctl add-port br-underlay ovs-p0 -- \\
                set interface ovs-p0 external-ids:iface-id=\"p0\""
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:62"
( $at_check_trace; ovs-vsctl add-port br-underlay ovs-p0 -- \
                set interface ovs-p0 external-ids:iface-id="p0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.1.1/24\" dev p0
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:62"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add "172.31.1.1/24" dev p0
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:62"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:62"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev p0 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:62: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:62"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:62"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      on_exit 'ip link del ovs-p0'


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:63: ip addr add dev br-underlay \"172.31.1.100/24\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:63"
( $at_check_trace; ip addr add dev br-underlay "172.31.1.100/24"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:63"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:64: ip link set dev br-underlay up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:64"
( $at_check_trace; ip link set dev br-underlay up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:64"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:68: ovs-vsctl add-port br0 at_gre0 -- \\
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 options:packet_type=legacy_l3"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:68"
( $at_check_trace; ovs-vsctl add-port br0 at_gre0 -- \
              set int at_gre0 type=gre options:remote_ip=172.31.1.1 options:packet_type=legacy_l3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:68"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:68: ip addr add dev br0 10.1.1.2/24"
at_fn_check_prepare_trace "system-layer3-tunnels.at:68"
( $at_check_trace; ip addr add dev br0 10.1.1.2/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:68"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:68: ip link set dev br0 up"
at_fn_check_prepare_trace "system-layer3-tunnels.at:68"
( $at_check_trace; ip link set dev br0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:68"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:68: ip link set dev br0 mtu 1450"
at_fn_check_prepare_trace "system-layer3-tunnels.at:68"
( $at_check_trace; ip link set dev br0 mtu 1450
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:68"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

    on_exit 'ip addr del dev br0 10.1.1.2/24'


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:70: ip neigh add 10.1.1.1 lladdr 00:12:34:56:78:aa dev br0"
at_fn_check_prepare_trace "system-layer3-tunnels.at:70"
( $at_check_trace; ip neigh add 10.1.1.1 lladdr 00:12:34:56:78:aa dev br0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:70"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:71: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_gre1 type gre remote 172.31.1.100
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:71"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link add dev at_gre1 type gre remote 172.31.1.100
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:71"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:72: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_gre1 10.1.1.1/24
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:72"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip addr add dev at_gre1 10.1.1.1/24
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:72"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:73: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_gre1 mtu 1450 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:73"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip link set dev at_gre1 mtu 1450 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:73"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:74: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add 10.1.1.2/32 encap ip id 0 dst 172.31.1.100 dev at_gre1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:74"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ip route add 10.1.1.2/32 encap ip id 0 dst 172.31.1.100 dev at_gre1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:74"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:76: ovs-ofctl add-flow br-underlay \"actions=normal\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:76"
( $at_check_trace; ovs-ofctl add-flow br-underlay "actions=normal"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:76"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:79: ovs-ofctl add-flow br0 \"priority=1 action=drop\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:79"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=1 action=drop"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:79"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:80: ovs-ofctl add-flow br0 \"priority=100 ip,nw_dst=10.1.1.1 action=output:at_gre0\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:80"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=100 ip,nw_dst=10.1.1.1 action=output:at_gre0"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:80"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:81: ovs-ofctl add-flow br0 \"priority=100 ip,nw_dst=10.1.1.2 action=mod_dl_src:00:12:34:56:78:aa,mod_dl_dst:00:12:34:56:78:bb,local\""
at_fn_check_prepare_trace "system-layer3-tunnels.at:81"
( $at_check_trace; ovs-ofctl add-flow br0 "priority=100 ip,nw_dst=10.1.1.2 action=mod_dl_src:00:12:34:56:78:aa,mod_dl_dst:00:12:34:56:78:bb,local"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_wait_cond () {
    ip netns exec at_ns0 ping -c 1 10.1.1.2
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:83" "until ip netns exec at_ns0 ping -c 1 10.1.1.2"


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:86: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:86"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 172.31.1.100 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:91: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:91"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:91"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


 { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:94: ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep \"transmitted\" | sed 's/time.*ms\$/time 0ms/'
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:94"
( $at_check_trace; ip netns exec at_ns0 sh << NS_EXEC_HEREDOC
ping -s 3200 -q -c 3 -i 0.3 -w 2 10.1.1.2 | grep "transmitted" | sed 's/time.*ms$/time 0ms/'
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3 packets transmitted, 3 received, 0% packet loss, time 0ms
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:94"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: check_logs "
at_fn_check_prepare_trace "system-layer3-tunnels.at:98"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-layer3-tunnels.at:98"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-layer3-tunnels.at:98"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:98" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-layer3-tunnels.at:98"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-layer3-tunnels.at:98"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:98" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:98: :; "
at_fn_check_prepare_trace "system-layer3-tunnels.at:98"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:98"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_132
#AT_START_133
at_fn_group_banner 133 'system-layer3-tunnels.at:101' \
  "layer3 - use non-local port as tunnel endpoint" " " 7
at_xfail=no
(
  $as_echo "133. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-layer3-tunnels.at:103"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-layer3-tunnels.at:103"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:103"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-layer3-tunnels.at:103"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: ovs-vswitchd --enable-dummy --disable-system --disable-system-route  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-layer3-tunnels.at:103"
( $at_check_trace; ovs-vswitchd --enable-dummy --disable-system --disable-system-route  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:103"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:103: add_of_br 0 add-port br0 p0 -- set Interface p0 type=dummy ofport_request=1 "
at_fn_check_prepare_trace "system-layer3-tunnels.at:103"
( $at_check_trace; add_of_br 0 add-port br0 p0 -- set Interface p0 type=dummy ofport_request=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:103"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:104: ovs-vsctl add-port br0 vtep0 -- set int vtep0 type=dummy"
at_fn_check_prepare_trace "system-layer3-tunnels.at:104"
( $at_check_trace; ovs-vsctl add-port br0 vtep0 -- set int vtep0 type=dummy
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:105: ovs-vsctl add-br int-br -- set bridge int-br datapath_type=dummy"
at_fn_check_prepare_trace "system-layer3-tunnels.at:105"
( $at_check_trace; ovs-vsctl add-br int-br -- set bridge int-br datapath_type=dummy
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:106: ovs-vsctl add-port int-br t1 -- set Interface t1 type=gre \\
                    options:remote_ip=1.1.2.92 ofport_request=3"
at_fn_check_prepare_notrace 'an embedded newline' "system-layer3-tunnels.at:106"
( $at_check_trace; ovs-vsctl add-port int-br t1 -- set Interface t1 type=gre \
                    options:remote_ip=1.1.2.92 ofport_request=3
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:106"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:109: ovs-appctl dpif/show"
at_fn_check_prepare_trace "system-layer3-tunnels.at:109"
( $at_check_trace; ovs-appctl dpif/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "dummy@ovs-dummy: hit:0 missed:0
  br0:
    br0 65534/100: (dummy-internal)
    p0 1/1: (dummy)
    vtep0 2/2: (dummy)
  int-br:
    int-br 65534/3: (dummy-internal)
    t1 3/4: (gre: remote_ip=1.1.2.92)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:120: ovs-appctl netdev-dummy/ip4addr vtep0 1.1.2.88/24"
at_fn_check_prepare_trace "system-layer3-tunnels.at:120"
( $at_check_trace; ovs-appctl netdev-dummy/ip4addr vtep0 1.1.2.88/24
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:120"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:122: ovs-appctl ovs/route/add 1.1.2.92/24 vtep0"
at_fn_check_prepare_trace "system-layer3-tunnels.at:122"
( $at_check_trace; ovs-appctl ovs/route/add 1.1.2.92/24 vtep0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:122"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:124: ovs-ofctl add-flow br0 action=normal"
at_fn_check_prepare_trace "system-layer3-tunnels.at:124"
( $at_check_trace; ovs-ofctl add-flow br0 action=normal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:124"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:125: ovs-ofctl add-flow int-br action=normal"
at_fn_check_prepare_trace "system-layer3-tunnels.at:125"
( $at_check_trace; ovs-ofctl add-flow int-br action=normal
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:125"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:129: ovs-appctl netdev-dummy/receive vtep0 'recirc_id(0),in_port(2),eth(dst=ff:ff:ff:ff:ff:ff,src=aa:55:aa:55:00:03),eth_type(0x0806),arp(tip=1.1.2.92,sip=1.1.2.88,op=1,sha=aa:55:aa:55:00:03,tha=00:00:00:00:00:00)'"
at_fn_check_prepare_trace "system-layer3-tunnels.at:129"
( $at_check_trace; ovs-appctl netdev-dummy/receive vtep0 'recirc_id(0),in_port(2),eth(dst=ff:ff:ff:ff:ff:ff,src=aa:55:aa:55:00:03),eth_type(0x0806),arp(tip=1.1.2.92,sip=1.1.2.88,op=1,sha=aa:55:aa:55:00:03,tha=00:00:00:00:00:00)'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:129"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:130: ovs-appctl netdev-dummy/receive p0 'recirc_id(0),in_port(1),eth(src=f8:bc:12:44:34:b6,dst=aa:55:aa:55:00:03),eth_type(0x0806),arp(sip=1.1.2.92,tip=1.1.2.88,op=2,sha=f8:bc:12:44:34:b6,tha=aa:55:aa:55:00:03)'"
at_fn_check_prepare_trace "system-layer3-tunnels.at:130"
( $at_check_trace; ovs-appctl netdev-dummy/receive p0 'recirc_id(0),in_port(1),eth(src=f8:bc:12:44:34:b6,dst=aa:55:aa:55:00:03),eth_type(0x0806),arp(sip=1.1.2.92,tip=1.1.2.88,op=2,sha=f8:bc:12:44:34:b6,tha=aa:55:aa:55:00:03)'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:130"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:132: ovs-appctl tnl/neigh/show | tail -n+3 | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-layer3-tunnels.at:132"
( $at_check_trace; ovs-appctl tnl/neigh/show | tail -n+3 | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1.1.2.92                                      f8:bc:12:44:34:b6   br0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:132"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:136: ovs-appctl ovs/route/show | tail -n+2 | sort"
at_fn_check_prepare_notrace 'a shell pipeline' "system-layer3-tunnels.at:136"
( $at_check_trace; ovs-appctl ovs/route/show | tail -n+2 | sort
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "User: 1.1.2.0/24 dev vtep0 SRC 1.1.2.88
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:141: ovs-appctl ofproto/trace ovs-dummy 'in_port(1),eth(src=f8:bc:12:44:34:b6,dst=aa:55:aa:55:00:03),eth_type(0x0800),ipv4(src=1.1.2.92,dst=1.1.2.88,proto=47,tos=0,ttl=64,frag=no)'"
at_fn_check_prepare_trace "system-layer3-tunnels.at:141"
( $at_check_trace; ovs-appctl ofproto/trace ovs-dummy 'in_port(1),eth(src=f8:bc:12:44:34:b6,dst=aa:55:aa:55:00:03),eth_type(0x0800),ipv4(src=1.1.2.92,dst=1.1.2.88,proto=47,tos=0,ttl=64,frag=no)'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:141"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:143: tail -1 stdout"
at_fn_check_prepare_trace "system-layer3-tunnels.at:143"
( $at_check_trace; tail -1 stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Datapath actions: tnl_pop(4)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:143"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:148: ovs-appctl ofproto/trace ovs-dummy 'in_port(3),eth(dst=f9:bc:12:44:34:b6,src=af:55:aa:55:00:03),eth_type(0x0800),ipv4(src=1.1.3.88,dst=1.1.3.92,proto=1,tos=0,ttl=64,frag=no)'"
at_fn_check_prepare_trace "system-layer3-tunnels.at:148"
( $at_check_trace; ovs-appctl ofproto/trace ovs-dummy 'in_port(3),eth(dst=f9:bc:12:44:34:b6,src=af:55:aa:55:00:03),eth_type(0x0800),ipv4(src=1.1.3.88,dst=1.1.3.92,proto=1,tos=0,ttl=64,frag=no)'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:148"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:149: tail -1 stdout"
at_fn_check_prepare_trace "system-layer3-tunnels.at:149"
( $at_check_trace; tail -1 stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Datapath actions: clone(tnl_push(tnl_port(4),header(size=38,type=3,eth(dst=f8:bc:12:44:34:b6,src=aa:55:aa:55:00:03,dl_type=0x0800),ipv4(src=1.1.2.88,dst=1.1.2.92,proto=47,tos=0,ttl=64,frag=0x4000),gre((flags=0x0,proto=0x6558))),out_port(2)),1)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:153: check_logs "
at_fn_check_prepare_trace "system-layer3-tunnels.at:153"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:153: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-layer3-tunnels.at:153"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:153: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-layer3-tunnels.at:153"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:153" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:153: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-layer3-tunnels.at:153"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-layer3-tunnels.at:153: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-layer3-tunnels.at:153"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-layer3-tunnels.at:153"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-layer3-tunnels.at:153" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_133
#AT_START_134
at_fn_group_banner 134 'system-interface.at:5' \
  "interface - add delete add same interface" "      " 8
at_xfail=no
(
  $as_echo "134. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


{ set +x
$as_echo "$at_srcdir/system-interface.at:7: modprobe openvswitch"
at_fn_check_prepare_trace "system-interface.at:7"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-interface.at:7: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-interface.at:7"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:7: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-interface.at:7"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-interface.at:7: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:7"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-interface.at:7: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-interface.at:7"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:7: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-interface.at:7"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-interface.at:7: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:7"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:7: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-interface.at:7"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:7"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/system-interface.at:9: ip link add ovs-veth0 type veth peer name ovs-veth1"
at_fn_check_prepare_trace "system-interface.at:9"
( $at_check_trace; ip link add ovs-veth0 type veth peer name ovs-veth1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:9"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del ovs-veth0'

{ set +x
$as_echo "$at_srcdir/system-interface.at:12: ovs-vsctl add-port br0 ovs-veth0"
at_fn_check_prepare_trace "system-interface.at:12"
( $at_check_trace; ovs-vsctl add-port br0 ovs-veth0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:12"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:14: ip link del ovs-veth0"
at_fn_check_prepare_trace "system-interface.at:14"
( $at_check_trace; ip link del ovs-veth0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:14"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-interface.at:15: ip link add ovs-veth0 type veth peer name ovs-veth1"
at_fn_check_prepare_trace "system-interface.at:15"
( $at_check_trace; ip link add ovs-veth0 type veth peer name ovs-veth1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:15"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:17: ovs-vsctl del-port br0 ovs-veth0"
at_fn_check_prepare_trace "system-interface.at:17"
( $at_check_trace; ovs-vsctl del-port br0 ovs-veth0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:17"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:19: check_logs \"/could not open network device ovs-veth0/d
/cannot get .*STP status on nonexistent port/d
/ethtool command .*on network device ovs-veth0 failed/d
/error receiving .*ovs-veth0/d
/ovs-veth0: removing policing failed/d\""
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:19"
( $at_check_trace; check_logs "/could not open network device ovs-veth0/d
/cannot get .*STP status on nonexistent port/d
/ethtool command .*on network device ovs-veth0 failed/d
/error receiving .*ovs-veth0/d
/ovs-veth0: removing policing failed/d"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-interface.at:19: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-interface.at:19"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-interface.at:19: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-interface.at:19"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-interface.at:19" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-interface.at:19: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-interface.at:19"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-interface.at:19: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-interface.at:19"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-interface.at:19" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-interface.at:19: :; "
at_fn_check_prepare_trace "system-interface.at:19"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:19"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_134
#AT_START_135
at_fn_group_banner 135 'system-interface.at:30' \
  "interface - add route to br and verify clean-up" "" 8
at_xfail=no
(
  $as_echo "135. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


{ set +x
$as_echo "$at_srcdir/system-interface.at:32: modprobe openvswitch"
at_fn_check_prepare_trace "system-interface.at:32"
( $at_check_trace; modprobe openvswitch
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit 'modprobe -r openvswitch'
   modprobe -q vport_geneve || echo "Module vport_geneve not loaded."
               on_exit 'modprobe -q -r vport_geneve'
              modprobe -q vport_gre || echo "Module vport_gre not loaded."
               on_exit 'modprobe -q -r vport_gre'
              modprobe -q vport_lisp || echo "Module vport_lisp not loaded."
               on_exit 'modprobe -q -r vport_lisp'
              modprobe -q vport_stt || echo "Module vport_stt not loaded."
               on_exit 'modprobe -q -r vport_stt'
              modprobe -q vport_vxlan || echo "Module vport_vxlan not loaded."
               on_exit 'modprobe -q -r vport_vxlan'

   on_exit 'ovs-dpctl del-dp ovs-system'
   on_exit 'ovs-appctl dpctl/flush-conntrack'
      touch .conf.db.~lock~
   { set +x
$as_echo "$at_srcdir/system-interface.at:32: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-interface.at:32"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:32: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-interface.at:32"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
$as_echo "$at_srcdir/system-interface.at:32: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:32"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
$as_echo "$at_srcdir/system-interface.at:32: ovs-vsctl --no-wait init "
at_fn_check_prepare_trace "system-interface.at:32"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:32: ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-interface.at:32"
( $at_check_trace; ovs-vswitchd  --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"
   { set +x
$as_echo "$at_srcdir/system-interface.at:32: sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:32"
( $at_check_trace; sed < stderr '
/ovs_numa|INFO|Discovered /d
/vlog|INFO|opened log file/d
/vswitchd|INFO|ovs-vswitchd (Open vSwitch)/d
/reconnect|INFO|/d
/dpif_netlink|INFO|Generic Netlink family .ovs_datapath. does not exist/d
/ofproto|INFO|using datapath ID/d
/netdev_linux|INFO|.*device has unknown hardware address family/d
/ofproto|INFO|datapath ID changed to fedcba9876543210/d
/dpdk|INFO|DPDK Disabled - Use other_config:dpdk-init to enable/d
/netlink_socket|INFO|netlink: could not enable listening to all nsid/d
/probe tc:/d
/tc: Using policy/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      { set +x
$as_echo "$at_srcdir/system-interface.at:32: ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --  "
at_fn_check_prepare_trace "system-interface.at:32"
( $at_check_trace; ovs-vsctl -- add-br br0 -- set Bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15 fail-mode=secure  --
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:32"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



HWADDR_BRP1=aa:55:00:00:00:01

{ set +x
$as_echo "$at_srcdir/system-interface.at:37: ip tuntap add name p1-0 mode tap"
at_fn_check_prepare_trace "system-interface.at:37"
( $at_check_trace; ip tuntap add name p1-0 mode tap
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:37"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
$as_echo "$at_srcdir/system-interface.at:38: ip link set p1-0 up"
at_fn_check_prepare_trace "system-interface.at:38"
( $at_check_trace; ip link set p1-0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:38"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

on_exit 'ip link del p1-0'

{ set +x
$as_echo "$at_srcdir/system-interface.at:41:
    ovs-vsctl add-br br-p1 -- \\
        set bridge br-p1 datapath_type=netdev fail-mode=standalone other-config:hwaddr=\$HWADDR_BRP1

    ovs-vsctl add-port br-p1 p1-0

    ovs-ofctl del-flows br-p1
"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:41"
( $at_check_trace;
    ovs-vsctl add-br br-p1 -- \
        set bridge br-p1 datapath_type=netdev fail-mode=standalone other-config:hwaddr=$HWADDR_BRP1

    ovs-vsctl add-port br-p1 p1-0

    ovs-ofctl del-flows br-p1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:41"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:50:
    ip addr add 10.0.0.1/24 dev br-p1
    ip link set br-p1 up
"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:50"
( $at_check_trace;
    ip addr add 10.0.0.1/24 dev br-p1
    ip link set br-p1 up

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:50"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:55:
    ovs-appctl ovs/route/add 10.0.0.0/24 br-p1
    ovs-appctl tnl/arp/set br-p1 10.0.0.1 \$HWADDR_BRP1
"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:55"
( $at_check_trace;
    ovs-appctl ovs/route/add 10.0.0.0/24 br-p1
    ovs-appctl tnl/arp/set br-p1 10.0.0.1 $HWADDR_BRP1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:55"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:60: check_logs "
at_fn_check_prepare_trace "system-interface.at:60"
( $at_check_trace; check_logs
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
$as_echo "$at_srcdir/system-interface.at:60: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-interface.at:60"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
$as_echo "$at_srcdir/system-interface.at:60: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-interface.at:60"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-interface.at:60" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-interface.at:60: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-interface.at:60"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
$as_echo "$at_srcdir/system-interface.at:60: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-interface.at:60"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-interface.at:60" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
$as_echo "$at_srcdir/system-interface.at:60: :; "
at_fn_check_prepare_trace "system-interface.at:60"
( $at_check_trace; :;
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-interface.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/system-interface.at:61:
    ip link show br-p1"
at_fn_check_prepare_notrace 'an embedded newline' "system-interface.at:61"
( $at_check_trace;
    ip link show br-p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "Device \"br-p1\" does not exist.
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 1 $at_status "$at_srcdir/system-interface.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_135
